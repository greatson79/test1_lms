This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
001/
  plan.md
  spec.md
002/
  plan.md
  spec.md
003/
  plan.md
  spec.md
004/
  spec.md
005/
  spec.md
006/
  spec.md
007/
  spec.md
008/
  spec.md
009/
  spec.md
010/
  spec.md
011/
  spec.md
012/
  spec.md
database.md
plan.md
prd.md
workflow.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="001/plan.md">
# Plan: UC-001 â€” ì—­í•  ì„ íƒ & ì˜¨ë³´ë”©

## ê°œìš”

ë°±ì—”ë“œ ë ˆì´ì–´(`profiles` feature)ëŠ” ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë©°, í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ ì—°ê²°ì´ ë‚¨ì€ ì‘ì—…ì´ë‹¤.

| ëª¨ë“ˆ | ìœ„ì¹˜ | ì„¤ëª… | ìƒíƒœ |
|---|---|---|---|
| error | `src/features/profiles/backend/error.ts` | ì—ëŸ¬ ì½”ë“œ ìƒìˆ˜ ë° union íƒ€ì… | âœ… |
| schema | `src/features/profiles/backend/schema.ts` | SignupRequest / OnboardingRequest / OnboardingResponse zod ìŠ¤í‚¤ë§ˆ | âœ… |
| service | `src/features/profiles/backend/service.ts` | `signupUser`, `onboardUser` ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ | âœ… |
| route | `src/features/profiles/backend/route.ts` | `POST /api/auth/signup`, `POST /api/auth/onboarding` (withAuth) | âœ… |
| dto | `src/features/profiles/lib/dto.ts` | backend schema íƒ€ì… ì¬ë…¸ì¶œ | âœ… |
| useSignupMutation | `src/features/profiles/hooks/useSignupMutation.ts` | íšŒì›ê°€ì… mutation í›… | âœ… |
| useOnboardingMutation | `src/features/profiles/hooks/useOnboardingMutation.ts` | ì˜¨ë³´ë”© mutation í›… (Bearer í† í° ì£¼ì…) | âœ… |
| onboarding-form | `src/features/profiles/components/onboarding-form.tsx` | ì—­í•  ì„ íƒ + í”„ë¡œí•„ ì…ë ¥ í¼ ì»´í¬ë„ŒíŠ¸ | âœ… |
| signup page | `src/app/signup/page.tsx` | ì´ë©”ì¼Â·ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í¼ í˜ì´ì§€ | ğŸ”§ ìˆ˜ì • ì¤‘ |
| onboarding page | `src/app/onboarding/page.tsx` | ì˜¨ë³´ë”© í¼ ë Œë”ë§ + ì—­í• ë³„ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬ | ğŸ†• ì‹ ê·œ |

## Diagram

```mermaid
graph LR
  subgraph Pages
    SP[signup/page.tsx]
    OP[onboarding/page.tsx]
  end

  subgraph profiles feature
    OF[onboarding-form.tsx]
    SM[useSignupMutation]
    OM[useOnboardingMutation]
    DT[lib/dto.ts]

    subgraph backend
      RT[route.ts]
      SV[service.ts]
      SC[schema.ts]
      ER[error.ts]
    end
  end

  subgraph shared
    AC[apiClient]
    WA[withAuth middleware]
    AUTH[constants/auth.ts]
  end

  SP --> SM
  OP --> OF
  OF --> OM
  SM --> AC
  OM --> AC
  AC --> RT
  RT --> WA
  RT --> SC
  RT --> SV
  SV --> ER
  DT --> SC
  SV --> AUTH
  SV --> DB[(Supabase\nauth.users / profiles / terms_agreements)]
```

## Implementation Plan

### service.ts â€” `signupUser` / `onboardUser`

ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ í•µì‹¬. Supabase service-role í´ë¼ì´ì–¸íŠ¸ë¥¼ ì¸ìë¡œ ë°›ì•„ `success / failure`ë¥¼ ë°˜í™˜í•œë‹¤.

**Unit Test**

```typescript
describe('signupUser', () => {
  it('ì‹ ê·œ ì´ë©”ì¼ë¡œ ê°€ì… ì‹œ 201ê³¼ userIdë¥¼ ë°˜í™˜í•œë‹¤')
  it('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ â†’ 409 EMAIL_ALREADY_EXISTS')
  it('Supabase Auth ì˜¤ë¥˜ ë°œìƒ â†’ 500 SIGNUP_FAILED')
})

describe('onboardUser', () => {
  it('learner ì—­í•  ì˜¨ë³´ë”© â†’ profiles + terms_agreements ìƒì„±, redirectTo = /courses')
  it('instructor ì—­í•  ì˜¨ë³´ë”© â†’ redirectTo = /instructor/dashboard')
  it('í”„ë¡œí•„ ì¤‘ë³µ(23505) â†’ 409 PROFILE_ALREADY_EXISTS')
  it('profiles INSERT ì‹¤íŒ¨ â†’ auth ê³„ì • ì‚­ì œ í›„ 500 ONBOARDING_FAILED')
  it('terms_agreements INSERT ì‹¤íŒ¨ â†’ profiles + auth ê³„ì • ì‚­ì œ í›„ 500 ONBOARDING_FAILED')
})
```

---

### signup/page.tsx

`useSignupMutation`ì„ í˜¸ì¶œí•˜ê³ , ì„±ê³µ ì‹œ `userId`ë¥¼ ì„¸ì…˜ì— ì„ì‹œ ë³´ê´€í•˜ì—¬ `/onboarding`ìœ¼ë¡œ ì´ë™í•œë‹¤.
`react-hook-form` + `zod` resolverë¡œ í´ë¼ì´ì–¸íŠ¸ ìœ íš¨ì„± ê²€ì‚¬.

**QA Sheet**

| ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|
| ìœ íš¨í•œ ì´ë©”ì¼Â·ë¹„ë°€ë²ˆí˜¸(8ìâ†‘) ì…ë ¥ í›„ ì œì¶œ | `/onboarding`ìœ¼ë¡œ ì´ë™ |
| ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ ì…ë ¥ í›„ ì œì¶œ | ì´ë©”ì¼ í•„ë“œì— "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤" ì¸ë¼ì¸ ì˜¤ë¥˜ |
| ë¹„ë°€ë²ˆí˜¸ 8ì ë¯¸ë§Œ ì…ë ¥ | ë¹„ë°€ë²ˆí˜¸ í•„ë“œì— ìœ íš¨ì„± ì˜¤ë¥˜, ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™” |
| ì´ë©”ì¼ í˜•ì‹ ì˜¤ë¥˜ | ì´ë©”ì¼ í•„ë“œì— ìœ íš¨ì„± ì˜¤ë¥˜ |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | í† ìŠ¤íŠ¸ ì˜¤ë¥˜ ë©”ì‹œì§€ + ì¬ì‹œë„ ìœ ë„ |
| ì œì¶œ ì¤‘ ë²„íŠ¼ ìƒíƒœ | ë¡œë”© ìŠ¤í”¼ë„ˆ í‘œì‹œ, ì¤‘ë³µ ì œì¶œ ë°©ì§€ |

---

### onboarding/page.tsx + onboarding-form.tsx

`useOnboardingMutation`ì„ í˜¸ì¶œí•˜ë©° `Authorization: Bearer <token>` í—¤ë”ë¥¼ ì£¼ì…í•œë‹¤.
ì„±ê³µ ì‘ë‹µì˜ `redirectTo`ë¥¼ `router.push()`ë¡œ ì²˜ë¦¬í•œë‹¤.

**QA Sheet**

| ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|
| Learner ì„ íƒ + ìœ íš¨ ì •ë³´ ì…ë ¥ í›„ ì œì¶œ | `/courses`ë¡œ ì´ë™ |
| Instructor ì„ íƒ + ìœ íš¨ ì •ë³´ ì…ë ¥ í›„ ì œì¶œ | `/instructor/dashboard`ë¡œ ì´ë™ |
| ì•½ê´€ ë¯¸ë™ì˜ ìƒíƒœ | ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™” |
| ì´ë¦„ ë¯¸ì…ë ¥ | ì´ë¦„ í•„ë“œì— ì¸ë¼ì¸ ì˜¤ë¥˜ |
| íœ´ëŒ€í°ë²ˆí˜¸ ë¯¸ì…ë ¥ | íœ´ëŒ€í°ë²ˆí˜¸ í•„ë“œì— ì¸ë¼ì¸ ì˜¤ë¥˜ |
| ì—­í•  ë¯¸ì„ íƒ ìƒíƒœ ì œì¶œ ì‹œë„ | ì—­í•  ì„ íƒ í•„ë“œì— ì˜¤ë¥˜ í‘œì‹œ |
| í† í° ë§Œë£Œ í›„ ì˜¨ë³´ë”© ì œì¶œ | 401 ë°˜í™˜ â†’ `/login`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
</file>

<file path="001/spec.md">
# UC-001: ì—­í•  ì„ íƒ & ì˜¨ë³´ë”©

## Primary Actor

ì‹ ê·œ ì‚¬ìš©ì (Learner ë˜ëŠ” Instructor ì§€ë§)

---

## Precondition

- ì„œë¹„ìŠ¤ì— ê³„ì •ì´ ì—†ëŠ” ìƒíƒœ
- ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ë³´ìœ í•˜ê³  ìˆìŒ

---

## Trigger

ì‚¬ìš©ìê°€ `/auth/signup` í˜ì´ì§€ì— ì ‘ê·¼í•˜ì—¬ íšŒì›ê°€ì… í¼ì„ ì œì¶œí•œë‹¤.

---

## Main Scenario

1. ì‚¬ìš©ìê°€ ì´ë©”ì¼ Â· ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  ê°€ì…ì„ ìš”ì²­í•œë‹¤.
2. FEê°€ `POST /api/auth/signup`ì„ í˜¸ì¶œí•œë‹¤.
3. BEê°€ Supabase Auth ê³„ì •ì„ ìƒì„±í•˜ê³  `user_id`ë¥¼ ë°˜í™˜í•œë‹¤.
4. FEê°€ ì˜¨ë³´ë”© í™”ë©´(ì—­í•  ì„ íƒ)ì„ í‘œì‹œí•œë‹¤.
5. ì‚¬ìš©ìê°€ ì—­í• (Learner / Instructor)ì„ ì„ íƒí•˜ê³  ì´ë¦„ Â· íœ´ëŒ€í°ë²ˆí˜¸ Â· ì•½ê´€ë™ì˜ë¥¼ ì…ë ¥í•œë‹¤.
6. FEê°€ `POST /api/auth/onboarding`ì„ í˜¸ì¶œí•œë‹¤.
7. BEê°€ `profiles` ë ˆì½”ë“œì™€ `terms_agreements` ë ˆì½”ë“œë¥¼ ìƒì„±í•˜ê³  í† í°ì„ ë°œê¸‰í•œë‹¤.
8. ì—­í• ì— ë”°ë¼ ë¦¬ë‹¤ì´ë ‰íŠ¸í•œë‹¤.
   - Learner â†’ `/courses` (ì½”ìŠ¤ ì¹´íƒˆë¡œê·¸)
   - Instructor â†’ `/instructor/dashboard`

---

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ | 409 ì¤‘ë³µ ì˜¤ë¥˜ ë°˜í™˜ â†’ FEì—ì„œ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ |
| ë¹„ë°€ë²ˆí˜¸ ì •ì±… ë¶ˆì¼ì¹˜ | 400 ìœ íš¨ì„± ì˜¤ë¥˜ ë°˜í™˜ â†’ ì…ë ¥ í•„ë“œ ì¸ë¼ì¸ ì˜¤ë¥˜ í‘œì‹œ |
| ì•½ê´€ ë¯¸ë™ì˜ | í”„ë¡ íŠ¸ì—”ë“œ ì œì¶œ ì°¨ë‹¨ (ë²„íŠ¼ ë¹„í™œì„±í™”) |
| í•„ìˆ˜ í”„ë¡œí•„ ëˆ„ë½ (ì´ë¦„ Â· íœ´ëŒ€í°ë²ˆí˜¸) | 400 ìœ íš¨ì„± ì˜¤ë¥˜ ë°˜í™˜ â†’ í•„ë“œë³„ ì¸ë¼ì¸ ì˜¤ë¥˜ í‘œì‹œ |
| Supabase Auth ìƒì„± ì„±ê³µ í›„ `profiles` INSERT ì‹¤íŒ¨ | 500 ë°˜í™˜, ìƒì„±ëœ Auth ê³„ì • ì‚­ì œ ì²˜ë¦¬ (ë¡¤ë°±) |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | FEì—ì„œ ì¬ì‹œë„ ìœ ë„ ë©”ì‹œì§€ í‘œì‹œ |

---

## Business Rules

- ì—­í• ì€ `learner` Â· `instructor` ì¤‘ í•˜ë‚˜ë§Œ ì„ íƒ ê°€ëŠ¥í•˜ë©°, ì´í›„ ë³€ê²½ ë¶ˆê°€.
- ì´ë¦„ Â· íœ´ëŒ€í°ë²ˆí˜¸ Â· ì•½ê´€ë™ì˜ëŠ” í•„ìˆ˜ í•­ëª©ì´ë‹¤.
- ì•½ê´€ ë™ì˜ ì´ë ¥ì€ `terms_agreements` í…Œì´ë¸”ì— ë³„ë„ ì €ì¥í•œë‹¤.
- ê°€ì… ì™„ë£Œ í›„ ì—­í• ì— ë”°ë¼ ì²« ì§„ì… í™”ë©´ì´ ë‹¤ë¥´ë‹¤.
- ì¸ì¦ì€ Supabase Auth ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©°, ì„œë²„ ì¸¡ service-role í´ë¼ì´ì–¸íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤.

---

## Sequence Diagram

```plantuml
@startuml

actor User
participant FE
participant BE
database Database

User -> FE: /auth/signup ì ‘ê·¼
User -> FE: ì´ë©”ì¼ Â· ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í›„ ì œì¶œ
FE -> BE: POST /api/auth/signup\n{email, password}
BE -> Database: Supabase Auth ê³„ì • ìƒì„±
Database --> BE: user_id ë°˜í™˜
BE --> FE: 201 {userId}
FE -> User: ì˜¨ë³´ë”© í™”ë©´ í‘œì‹œ (ì—­í•  ì„ íƒ)

User -> FE: ì—­í•  ì„ íƒ + ì´ë¦„ Â· íœ´ëŒ€í°ë²ˆí˜¸ Â· ì•½ê´€ë™ì˜ ì…ë ¥
FE -> BE: POST /api/auth/onboarding\n{role, name, phone, termsAgreed}
BE -> Database: INSERT profiles\n(user_id, role, name, phone)
BE -> Database: INSERT terms_agreements\n(user_id, agreed_at)
Database --> BE: ì €ì¥ ì™„ë£Œ
BE --> FE: 200 {role, redirectTo}

alt role = learner
  FE -> User: ì½”ìŠ¤ ì¹´íƒˆë¡œê·¸ë¡œ ì´ë™ (/courses)
else role = instructor
  FE -> User: Instructor ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ (/instructor/dashboard)
end

@enduml
```
</file>

<file path="002/plan.md">
# Plan: UC-002 â€” ì½”ìŠ¤ íƒìƒ‰ & ìˆ˜ê°•ì‹ ì²­/ì·¨ì†Œ

## ê°œìš”

`courses`ì™€ `enrollments` ë‘ featureë¡œ ë¶„ë¦¬í•œë‹¤.
`courses`ëŠ” ê³µê°œ ì¹´íƒˆë¡œê·¸ ì¡°íšŒ, `enrollments`ëŠ” ì¸ì¦ëœ Learnerì˜ ì‹ ì²­Â·ì·¨ì†Œ ë¡œì§ì„ ë‹´ë‹¹í•œë‹¤.

| ëª¨ë“ˆ | ìœ„ì¹˜ | ì„¤ëª… | ìƒíƒœ |
|---|---|---|---|
| courses/error | `src/features/courses/backend/error.ts` | COURSE_NOT_FOUND, COURSE_NOT_PUBLISHED | ğŸ†• |
| courses/schema | `src/features/courses/backend/schema.ts` | CourseListQuery, CourseListResponse, CourseDetailResponse | ğŸ†• |
| courses/service | `src/features/courses/backend/service.ts` | `listCourses`, `getCourseDetail` (ìˆ˜ê°• ìƒíƒœ í¬í•¨) | ğŸ†• |
| courses/route | `src/features/courses/backend/route.ts` | `GET /api/courses`, `GET /api/courses/:courseId` | ğŸ†• |
| courses/dto | `src/features/courses/lib/dto.ts` | CourseDto, CourseDetailDto íƒ€ì… ì¬ë…¸ì¶œ (UC-003ê³¼ ê³µìœ ) | ğŸ†• |
| useCourseListQuery | `src/features/courses/hooks/useCourseListQuery.ts` | ì½”ìŠ¤ ëª©ë¡ ì¡°íšŒ ì¿¼ë¦¬ í›… | ğŸ†• |
| useCourseDetailQuery | `src/features/courses/hooks/useCourseDetailQuery.ts` | ì½”ìŠ¤ ìƒì„¸ + ìˆ˜ê°• ìƒíƒœ ì¡°íšŒ í›… | ğŸ†• |
| course-card | `src/features/courses/components/course-card.tsx` | ì¹´íƒˆë¡œê·¸ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ | ğŸ†• |
| course-filter | `src/features/courses/components/course-filter.tsx` | ê²€ìƒ‰ì–´Â·ì¹´í…Œê³ ë¦¬Â·ë‚œì´ë„Â·ì •ë ¬ í•„í„°ë°” | ğŸ†• |
| enrollments/error | `src/features/enrollments/backend/error.ts` | ALREADY_ENROLLED, ENROLLMENT_NOT_FOUND, COURSE_NOT_ENROLLABLE | ğŸ†• |
| enrollments/schema | `src/features/enrollments/backend/schema.ts` | EnrollRequest, EnrollResponse, CancelEnrollmentParams | ğŸ†• |
| enrollments/service | `src/features/enrollments/backend/service.ts` | `enrollCourse` (UPSERT), `cancelEnrollment` | ğŸ†• |
| enrollments/route | `src/features/enrollments/backend/route.ts` | `POST /api/enrollments`, `DELETE /api/enrollments/:courseId` (withAuth) | ğŸ†• |
| enrollments/dto | `src/features/enrollments/lib/dto.ts` | EnrollmentDto íƒ€ì… ì¬ë…¸ì¶œ | ğŸ†• |
| useEnrollMutation | `src/features/enrollments/hooks/useEnrollMutation.ts` | ìˆ˜ê°•ì‹ ì²­Â·ì¬ì‹ ì²­ mutation í›… | ğŸ†• |
| useCancelEnrollmentMutation | `src/features/enrollments/hooks/useCancelEnrollmentMutation.ts` | ìˆ˜ê°•ì·¨ì†Œ mutation í›… | ğŸ†• |
| enrollment-button | `src/features/enrollments/components/enrollment-button.tsx` | ìˆ˜ê°•ì‹ ì²­Â·ì·¨ì†Œ í† ê¸€ ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸ | ğŸ†• |
| courses page | `src/app/courses/page.tsx` | ì½”ìŠ¤ ì¹´íƒˆë¡œê·¸ í˜ì´ì§€ | ğŸ†• |
| course detail page | `src/app/courses/[courseId]/page.tsx` | ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€ | ğŸ†• |
| app.ts ë“±ë¡ | `src/backend/hono/app.ts` | `registerCourseRoutes`, `registerEnrollmentRoutes` ì¶”ê°€ | ğŸ”§ |

## Diagram

```mermaid
graph LR
  subgraph Pages
    CP[courses/page.tsx]
    DP[courses/courseId/page.tsx]
  end

  subgraph courses feature
    CC[course-card.tsx]
    CF[course-filter.tsx]
    CLQ[useCourseListQuery]
    CDQ[useCourseDetailQuery]
    CDTO[lib/dto.ts]

    subgraph courses backend
      CR[route.ts]
      CS[service.ts]
    end
  end

  subgraph enrollments feature
    EB[enrollment-button.tsx]
    EM[useEnrollMutation]
    ECM[useCancelEnrollmentMutation]
    EDTO[lib/dto.ts]

    subgraph enrollments backend
      ER[route.ts]
      ES[service.ts]
    end
  end

  subgraph shared
    AC[apiClient]
    WA[withAuth middleware]
  end

  CP --> CF
  CP --> CC
  CP --> CLQ
  DP --> CDQ
  DP --> EB
  EB --> EM
  EB --> ECM
  CLQ --> AC
  CDQ --> AC
  EM --> AC
  ECM --> AC
  AC --> CR
  AC --> ER
  CR --> CS
  ER --> WA
  ER --> ES
  CS --> DB[(Supabase\ncourses / categories / difficulties)]
  ES --> DB2[(Supabase\nenrollments / courses)]
  CDTO -.->|ê³µìœ | UC003[UC-003 dashboard]
```

## Implementation Plan

### courses/service.ts â€” `listCourses` / `getCourseDetail`

`getCourseDetail`ì€ ì„ íƒì  `learnerId`ë¥¼ ë°›ì•„ enrollments í…Œì´ë¸”ì—ì„œ ìˆ˜ê°• ìƒíƒœë¥¼ í•¨ê»˜ ì¡°íšŒí•œë‹¤.

**Unit Test**

```typescript
describe('listCourses', () => {
  it('published ì½”ìŠ¤ ëª©ë¡ë§Œ ë°˜í™˜í•œë‹¤ (draft, archived ì œì™¸)')
  it('search íŒŒë¼ë¯¸í„° â†’ title ILIKE ê²€ìƒ‰')
  it('categoryId í•„í„° ì ìš© ì‹œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ì½”ìŠ¤ë§Œ ë°˜í™˜')
  it('difficultyId í•„í„° ì ìš© ì‹œ í•´ë‹¹ ë‚œì´ë„ ì½”ìŠ¤ë§Œ ë°˜í™˜')
  it('sort=recent â†’ created_at DESC')
  it('sort=popular â†’ enrolled ìˆ˜ DESC (ë˜ëŠ” ê¸°ë³¸ ì •ë ¬)')
  it('ê²°ê³¼ ì—†ì„ ì‹œ ë¹ˆ ë°°ì—´ ë°˜í™˜ (ì—ëŸ¬ ì•„ë‹˜)')
})

describe('getCourseDetail', () => {
  it('published ì½”ìŠ¤ ìƒì„¸ì™€ enrollmentStatus=null(ë¹„ì¸ì¦) ë°˜í™˜')
  it('ì¸ì¦ëœ learner â†’ enrollmentStatus: active | cancelled | null í¬í•¨')
  it('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” courseId â†’ 404 COURSE_NOT_FOUND')
})
```

---

### enrollments/service.ts â€” `enrollCourse` / `cancelEnrollment`

UPSERT ë¡œì§ì˜ í•µì‹¬. `(course_id, learner_id)` UNIQUE ì œì•½ì„ í™œìš©í•´ ì¤‘ë³µ ë°ì´í„° ì—†ì´ ì²˜ë¦¬í•œë‹¤.

**Unit Test**

```typescript
describe('enrollCourse', () => {
  it('ìˆ˜ê°• ì´ë ¥ ì—†ìŒ â†’ INSERT, 201 ë°˜í™˜')
  it('cancelled_at IS NOT NULL (ì·¨ì†Œ ì´ë ¥) â†’ UPDATE SET cancelled_at=NULL, enrolled_at=NOW(), 200 ë°˜í™˜')
  it('cancelled_at IS NULL (ì´ë¯¸ ìˆ˜ê°• ì¤‘) â†’ 409 ALREADY_ENROLLED')
  it('ì½”ìŠ¤ statusê°€ publishedê°€ ì•„ë‹˜ â†’ 400 COURSE_NOT_ENROLLABLE')
  it('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” courseId â†’ 404 COURSE_NOT_FOUND')
})

describe('cancelEnrollment', () => {
  it('í™œì„± ìˆ˜ê°• ì·¨ì†Œ â†’ cancelled_at = NOW() UPDATE, 200 ë°˜í™˜')
  it('ìˆ˜ê°• ì´ë ¥ ì—†ê±°ë‚˜ ì´ë¯¸ ì·¨ì†Œë¨ â†’ 404 ENROLLMENT_NOT_FOUND')
})
```

---

### course-filter.tsx

URL searchParamsì™€ ë™ê¸°í™”í•˜ëŠ” í•„í„° ì»´í¬ë„ŒíŠ¸. ìƒíƒœëŠ” `useSearchParams` + `router.push`ë¡œ ê´€ë¦¬í•œë‹¤.

**QA Sheet**

| ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|
| ê²€ìƒ‰ì–´ ì…ë ¥ í›„ ì—”í„°/ë²„íŠ¼ í´ë¦­ | URLì— `?search=...` ë°˜ì˜, ëª©ë¡ í•„í„°ë§ |
| ì¹´í…Œê³ ë¦¬ ì„ íƒ | URLì— `?category=...` ë°˜ì˜ |
| ë‚œì´ë„ ì„ íƒ | URLì— `?difficulty=...` ë°˜ì˜ |
| ì •ë ¬ ë³€ê²½ | URLì— `?sort=recent\|popular` ë°˜ì˜ |
| í•„í„° ì´ˆê¸°í™” | ëª¨ë“  íŒŒë¼ë¯¸í„° ì œê±°, ì „ì²´ ëª©ë¡ ë³µì› |

---

### courses/page.tsx

**QA Sheet**

| ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|
| í˜ì´ì§€ ì§„ì… | published ì½”ìŠ¤ ì¹´ë“œ ëª©ë¡ í‘œì‹œ |
| ë¡œë”© ì¤‘ | ìŠ¤ì¼ˆë ˆí†¤ ì¹´ë“œ í‘œì‹œ |
| ì½”ìŠ¤ ì—†ìŒ (í•„í„° ê²°ê³¼ 0ê±´) | "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤" ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ |
| ì½”ìŠ¤ ì¹´ë“œ í´ë¦­ | `/courses/[courseId]`ë¡œ ì´ë™ |

---

### courses/[courseId]/page.tsx + enrollment-button.tsx

`useCourseDetailQuery`ë¡œ ì½”ìŠ¤ ì •ë³´ì™€ ìˆ˜ê°• ìƒíƒœë¥¼ ì¡°íšŒí•˜ê³ , `enrollment-button`ì´ ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ì„ í† ê¸€í•œë‹¤.
mutation ì„±ê³µ í›„ `queryClient.invalidateQueries(['course', courseId])`ë¡œ ìˆ˜ê°• ìƒíƒœë¥¼ ê°±ì‹ í•œë‹¤.

**QA Sheet**

| ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|
| ë¹„ì¸ì¦ ì‚¬ìš©ì ì§„ì… | ìˆ˜ê°•ì‹ ì²­ ë²„íŠ¼ ë¯¸í‘œì‹œ ë˜ëŠ” ë¡œê·¸ì¸ ìœ ë„ |
| ì‹ ê·œ ìˆ˜ê°•ì‹ ì²­ ì„±ê³µ | ë²„íŠ¼ â†’ "ìˆ˜ê°•ì·¨ì†Œ"ë¡œ ë³€ê²½, ì„±ê³µ í† ìŠ¤íŠ¸ |
| ì´ë¯¸ ìˆ˜ê°• ì¤‘ì¸ ìƒíƒœ ì§„ì… | "ìˆ˜ê°•ì·¨ì†Œ" ë²„íŠ¼ í‘œì‹œ |
| ìˆ˜ê°•ì·¨ì†Œ ì„±ê³µ | ë²„íŠ¼ â†’ "ìˆ˜ê°•ì‹ ì²­"ìœ¼ë¡œ ë³€ê²½, ì·¨ì†Œ í† ìŠ¤íŠ¸ |
| ì·¨ì†Œí•œ ì½”ìŠ¤ ì¬ì‹ ì²­ ì„±ê³µ | ë²„íŠ¼ â†’ "ìˆ˜ê°•ì·¨ì†Œ"ë¡œ ë³€ê²½, ì„±ê³µ í† ìŠ¤íŠ¸ |
| ì´ë¯¸ ìˆ˜ê°• ì¤‘ ìƒíƒœì—ì„œ API 409 ë°˜í™˜ | "ì´ë¯¸ ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ì…ë‹ˆë‹¤" ì˜¤ë¥˜ í† ìŠ¤íŠ¸ |
| Instructor ì—­í• ë¡œ ì§„ì… | ìˆ˜ê°•ì‹ ì²­ ë²„íŠ¼ ë¯¸í‘œì‹œ |
| ë¡œë”© ì¤‘ | ë²„íŠ¼ ë¹„í™œì„±í™” + ìŠ¤í”¼ë„ˆ |
</file>

<file path="002/spec.md">
# UC-002: ì½”ìŠ¤ íƒìƒ‰ & ìˆ˜ê°•ì‹ ì²­/ì·¨ì†Œ

## Primary Actor

Learner (ì¸ì¦ëœ í•™ìŠµì)

## Precondition

- ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `learner`ì¸ ì‚¬ìš©ì
- ì˜¨ë³´ë”©ì´ ì™„ë£Œëœ ìƒíƒœ

## Trigger

- ì‚¬ìš©ìê°€ `/courses` í˜ì´ì§€ì— ì ‘ê·¼í•˜ì—¬ ì½”ìŠ¤ë¥¼ íƒìƒ‰í•œë‹¤.
- ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€ì—ì„œ "ìˆ˜ê°•ì‹ ì²­" ë˜ëŠ” "ìˆ˜ê°•ì·¨ì†Œ" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.

## Main Scenario

### 2-1. ì½”ìŠ¤ íƒìƒ‰

1. ì‚¬ìš©ìê°€ `/courses`ì— ì ‘ê·¼í•œë‹¤.
2. FEê°€ `GET /api/courses`ë¥¼ í˜¸ì¶œí•œë‹¤ (ê²€ìƒ‰ì–´, ì¹´í…Œê³ ë¦¬, ë‚œì´ë„, ì •ë ¬ íŒŒë¼ë¯¸í„° í¬í•¨).
3. BEê°€ `status = 'published'` ì½”ìŠ¤ ëª©ë¡ì„ í•„í„°Â·ì •ë ¬í•˜ì—¬ ë°˜í™˜í•œë‹¤.
4. FEê°€ ì½”ìŠ¤ ì¹´ë“œ ëª©ë¡ì„ ë Œë”ë§í•œë‹¤.
5. ì‚¬ìš©ìê°€ ì½”ìŠ¤ë¥¼ ì„ íƒí•˜ë©´ ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤.
6. FEê°€ `GET /api/courses/:courseId`ë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒì„¸ ì •ë³´ ë° í˜„ì¬ ìˆ˜ê°• ìƒíƒœë¥¼ í•¨ê»˜ ë°˜í™˜ë°›ëŠ”ë‹¤.

### 2-2. ìˆ˜ê°•ì‹ ì²­ (ì‹ ê·œ / ì¬ì‹ ì²­)

1. ì‚¬ìš©ìê°€ ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€ì—ì„œ "ìˆ˜ê°•ì‹ ì²­" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
2. FEê°€ `POST /api/enrollments`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ courseId }`).
3. BEê°€ ì½”ìŠ¤ `status = 'published'` ì—¬ë¶€ë¥¼ ê²€ì¦í•œë‹¤.
4. BEê°€ `enrollments` í…Œì´ë¸”ì—ì„œ `(course_id, learner_id)` ë¥¼ ì¡°íšŒí•œë‹¤.
   - ê¸°ë¡ ì—†ìŒ â†’ `INSERT` (ì‹ ê·œ ì‹ ì²­)
   - `cancelled_at IS NOT NULL` â†’ `UPDATE SET cancelled_at = NULL, enrolled_at = NOW()` (ì¬ì‹ ì²­)
   - `cancelled_at IS NULL` â†’ 409 ì—ëŸ¬ ë°˜í™˜ (ì´ë¯¸ ìˆ˜ê°• ì¤‘)
5. BEê°€ ì„±ê³µì„ ë°˜í™˜í•œë‹¤.
6. FEê°€ ì„±ê³µ í”¼ë“œë°±ì„ í‘œì‹œí•˜ê³  ë²„íŠ¼ ìƒíƒœë¥¼ ê°±ì‹ í•œë‹¤.

### 2-3. ìˆ˜ê°•ì·¨ì†Œ

1. ì‚¬ìš©ìê°€ ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ì—ì„œ "ìˆ˜ê°•ì·¨ì†Œ" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
2. FEê°€ `DELETE /api/enrollments/:courseId`ë¥¼ í˜¸ì¶œí•œë‹¤.
3. BEê°€ `enrollments` ë ˆì½”ë“œë¥¼ ì¡°íšŒí•˜ê³  `cancelled_at = NOW()`ë¡œ UPDATEí•œë‹¤.
4. FEê°€ ì·¨ì†Œ ì„±ê³µ í”¼ë“œë°±ì„ í‘œì‹œí•˜ê³  ëŒ€ì‹œë³´ë“œì—ì„œ í•´ë‹¹ ì½”ìŠ¤ë¥¼ ì œê±°í•œë‹¤.

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| ì´ë¯¸ ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ ì¬ì‹ ì²­ | 409 ë°˜í™˜ â†’ "ì´ë¯¸ ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ì…ë‹ˆë‹¤" ì•ˆë‚´ ë©”ì‹œì§€ |
| `published` ìƒíƒœê°€ ì•„ë‹Œ ì½”ìŠ¤ ì‹ ì²­ | 400 ë°˜í™˜ â†’ FEì—ì„œ ì‹ ì²­ ë²„íŠ¼ ë¹„í‘œì‹œ ë˜ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€ |
| ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì˜ ì‹ ì²­ ì‹œë„ | 401 ë°˜í™˜ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| Instructor ì—­í• ë¡œ ì‹ ì²­ ì‹œë„ | 403 ë°˜í™˜ â†’ ê¶Œí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ |
| ìˆ˜ê°• ì¤‘ì´ ì•„ë‹Œ ì½”ìŠ¤ ì·¨ì†Œ ì‹œë„ | 404 ë°˜í™˜ â†’ FEì—ì„œ ì·¨ì†Œ ë²„íŠ¼ ë¹„í‘œì‹œ |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | FEì—ì„œ ì¬ì‹œë„ ìœ ë„ ë©”ì‹œì§€ í‘œì‹œ |

## Business Rules

- `published` ìƒíƒœì˜ ì½”ìŠ¤ë§Œ ìˆ˜ê°•ì‹ ì²­ ê°€ëŠ¥í•˜ë‹¤.
- `enrollments` í…Œì´ë¸”ì˜ `(course_id, learner_id)` ìŒì€ UNIQUE â†’ ì¬ì‹ ì²­ ì‹œ ìƒˆ ë ˆì½”ë“œë¥¼ ìƒì„±í•˜ì§€ ì•Šê³  ê¸°ì¡´ ë ˆì½”ë“œë¥¼ UPDATEí•œë‹¤ (ì¤‘ë³µ ë°ì´í„° ë°©ì§€).
- ìˆ˜ê°•ì·¨ì†Œ ì‹œ ë ˆì½”ë“œë¥¼ ì‚­ì œí•˜ì§€ ì•Šê³  `cancelled_at = NOW()`ë¡œ ê°±ì‹ í•œë‹¤.
- ì¬ì‹ ì²­ ì‹œ ê¸°ì¡´ ë ˆì½”ë“œì˜ `cancelled_at = NULL`, `enrolled_at = NOW()`ë¡œ ë³µêµ¬í•œë‹¤.
- ì·¨ì†Œ ìƒíƒœ(`cancelled_at IS NOT NULL`)ì˜ ìˆ˜ê°•ì€ ëŒ€ì‹œë³´ë“œ ëª©ë¡ ë° ì„±ì  ì§‘ê³„ì—ì„œ ì œì™¸ëœë‹¤.

## Sequence Diagram

```plantuml
@startuml

actor User
participant FE
participant BE
database Database

User -> FE: /courses ì ‘ê·¼
FE -> BE: GET /api/courses\n?search=&category=&difficulty=&sort=
BE -> Database: SELECT courses\nWHERE status = 'published'
Database --> BE: ì½”ìŠ¤ ëª©ë¡
BE --> FE: 200 {courses}
FE -> User: ì½”ìŠ¤ ì¹´íƒˆë¡œê·¸ ë Œë”ë§

User -> FE: ì½”ìŠ¤ ì„ íƒ
FE -> BE: GET /api/courses/:courseId
BE -> Database: SELECT course ìƒì„¸\n+ enrollment ìƒíƒœ (learner_id ê¸°ì¤€)
Database --> BE: ì½”ìŠ¤ ìƒì„¸ + ìˆ˜ê°• ìƒíƒœ
BE --> FE: 200 {course, enrollmentStatus}
FE -> User: ì½”ìŠ¤ ìƒì„¸ í‘œì‹œ

User -> FE: "ìˆ˜ê°•ì‹ ì²­" í´ë¦­
FE -> BE: POST /api/enrollments\n{courseId}
BE -> Database: SELECT courses WHERE id = ?\nAND status = 'published'
BE -> Database: SELECT enrollments\nWHERE course_id = ? AND learner_id = ?

alt ê¸°ë¡ ì—†ìŒ (ì‹ ê·œ ì‹ ì²­)
  BE -> Database: INSERT enrollments\n(course_id, learner_id, enrolled_at)
else cancelled_at IS NOT NULL (ì¬ì‹ ì²­)
  BE -> Database: UPDATE enrollments\nSET cancelled_at = NULL, enrolled_at = NOW()
else cancelled_at IS NULL (ì´ë¯¸ ìˆ˜ê°• ì¤‘)
  BE --> FE: 409 {error: "ì´ë¯¸ ìˆ˜ê°• ì¤‘"}
end

Database --> BE: ì €ì¥ ì™„ë£Œ
BE --> FE: 201 {enrollment}
FE -> User: ì‹ ì²­ ì„±ê³µ í”¼ë“œë°± + ë²„íŠ¼ ìƒíƒœ ê°±ì‹ 

User -> FE: "ìˆ˜ê°•ì·¨ì†Œ" í´ë¦­
FE -> BE: DELETE /api/enrollments/:courseId
BE -> Database: UPDATE enrollments\nSET cancelled_at = NOW()\nWHERE course_id = ? AND learner_id = ?
Database --> BE: ì €ì¥ ì™„ë£Œ
BE --> FE: 200 {success}
FE -> User: ì·¨ì†Œ ì„±ê³µ í”¼ë“œë°± + ëŒ€ì‹œë³´ë“œ ê°±ì‹ 

@enduml
```
</file>

<file path="003/plan.md">
# Plan: UC-003 â€” Learner ëŒ€ì‹œë³´ë“œ

## ê°œìš”

`dashboard` featureë¡œ êµ¬í˜„í•œë‹¤.
ë‹¨ì¼ API ì—”ë“œí¬ì¸íŠ¸(`GET /api/dashboard/learner`)ì—ì„œ ì§‘ê³„ ì¿¼ë¦¬ë¥¼ í†µí•´ 4ê°œ ì„¹ì…˜ ë°ì´í„°ë¥¼ ì¼ê´„ ë°˜í™˜í•œë‹¤.
`CourseDto`ëŠ” UC-002 `courses/lib/dto.ts`ì—ì„œ ê³µìœ í•œë‹¤.

| ëª¨ë“ˆ | ìœ„ì¹˜ | ì„¤ëª… | ìƒíƒœ |
|---|---|---|---|
| dashboard/error | `src/features/dashboard/backend/error.ts` | DASHBOARD_FETCH_ERROR ì—ëŸ¬ ì½”ë“œ | ğŸ†• |
| dashboard/schema | `src/features/dashboard/backend/schema.ts` | LearnerDashboardResponse zod ìŠ¤í‚¤ë§ˆ (courses, progress, upcomingAssignments, recentFeedbacks) | ğŸ†• |
| dashboard/service | `src/features/dashboard/backend/service.ts` | `getLearnerDashboard`, `calculateProgress` ì§‘ê³„ ë¡œì§ | ğŸ†• |
| dashboard/route | `src/features/dashboard/backend/route.ts` | `GET /api/dashboard/learner` (withAuth + learner role guard) | ğŸ†• |
| dashboard/dto | `src/features/dashboard/lib/dto.ts` | LearnerDashboardDto íƒ€ì… ì¬ë…¸ì¶œ | ğŸ†• |
| useLearnerDashboardQuery | `src/features/dashboard/hooks/useLearnerDashboardQuery.ts` | ëŒ€ì‹œë³´ë“œ ë°ì´í„° ì¡°íšŒ ì¿¼ë¦¬ í›… | ğŸ†• |
| enrolled-course-card | `src/features/dashboard/components/enrolled-course-card.tsx` | ì§„í–‰ë¥  ë°” í¬í•¨ ìˆ˜ê°• ì½”ìŠ¤ ì¹´ë“œ | ğŸ†• |
| upcoming-assignments-section | `src/features/dashboard/components/upcoming-assignments-section.tsx` | ë§ˆê° ì„ë°• ê³¼ì œ ëª©ë¡ ì„¹ì…˜ | ğŸ†• |
| recent-feedbacks-section | `src/features/dashboard/components/recent-feedbacks-section.tsx` | ìµœê·¼ í”¼ë“œë°± ëª©ë¡ ì„¹ì…˜ | ğŸ†• |
| dashboard page | `src/app/(protected)/dashboard/page.tsx` | Learner ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ (protected route) | ğŸ†• |
| app.ts ë“±ë¡ | `src/backend/hono/app.ts` | `registerDashboardRoutes` ì¶”ê°€ | ğŸ”§ |

### ê³µìœ  ëª¨ë“ˆ (UC-002 ì˜ì¡´)

| ëª¨ë“ˆ | ìœ„ì¹˜ | ìš©ë„ |
|---|---|---|
| CourseDto | `src/features/courses/lib/dto.ts` | ìˆ˜ê°• ì½”ìŠ¤ ì¹´ë“œì—ì„œ ì½”ìŠ¤ ì •ë³´ íƒ€ì…ìœ¼ë¡œ ì¬ì‚¬ìš© |

## Diagram

```mermaid
graph LR
  subgraph Pages
    DP[dashboard/page.tsx\nprotected route]
  end

  subgraph dashboard feature
    ECC[enrolled-course-card.tsx]
    UAS[upcoming-assignments-section.tsx]
    RFS[recent-feedbacks-section.tsx]
    LDQ[useLearnerDashboardQuery]
    DDTO[lib/dto.ts]

    subgraph backend
      DR[route.ts]
      DS[service.ts]
      DSC[schema.ts]
      DE[error.ts]
    end
  end

  subgraph shared
    AC[apiClient]
    WA[withAuth middleware]
    CDTO[courses/lib/dto.ts\nCourseDto]
  end

  DP --> ECC
  DP --> UAS
  DP --> RFS
  DP --> LDQ
  LDQ --> AC
  AC --> DR
  DR --> WA
  DR --> DS
  DS --> DSC
  DS --> DE
  DDTO --> DSC
  ECC --> CDTO
  DS --> DB[(Supabase\nenrollments / courses /\nassignments / submissions)]
```

## Implementation Plan

### dashboard/service.ts â€” `getLearnerDashboard` / `calculateProgress`

`calculateProgress`ëŠ” ìˆœìˆ˜ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•˜ì—¬ ë‹¨ë… í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.

**Unit Test**

```typescript
describe('calculateProgress', () => {
  it('ì œì¶œ 0ê±´, ê³¼ì œ 5ê±´ â†’ 0')
  it('ì œì¶œ 3ê±´(submitted), ê³¼ì œ 5ê±´ â†’ 0.6')
  it('ì œì¶œ 2ê±´(submitted) + 1ê±´(resubmission_required), ê³¼ì œ 5ê±´ â†’ 0.4')
  it('ê³¼ì œ 0ê±´ â†’ 0 (ZeroDivisionError ë°©ì§€)')
  it('ì „ì²´ ì œì¶œ ì™„ë£Œ â†’ 1.0')
})

describe('getLearnerDashboard', () => {
  it('cancelled_at IS NULL ìˆ˜ê°•ë§Œ courses ëª©ë¡ì— í¬í•¨í•œë‹¤')
  it('cancelled_at IS NOT NULL ìˆ˜ê°•ì€ ëª©ë¡ì—ì„œ ì œì™¸ëœë‹¤')
  it('ê° ì½”ìŠ¤ì— ëŒ€í•´ ì§„í–‰ë¥ ì´ ê³„ì‚°ë˜ì–´ í¬í•¨ëœë‹¤')
  it('ë§ˆê° ì„ë°• ê³¼ì œëŠ” due_at ASC ì •ë ¬ë¡œ ë°˜í™˜ëœë‹¤')
  it('ìµœê·¼ í”¼ë“œë°±ì€ graded_at DESC ì •ë ¬ë¡œ ë°˜í™˜ëœë‹¤')
  it('ìµœê·¼ í”¼ë“œë°±ì€ status=graded ì œì¶œë¬¼ë§Œ í¬í•¨í•œë‹¤')
  it('ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ì„ ë°˜í™˜í•œë‹¤ (ì—ëŸ¬ ì•„ë‹˜)')
})
```

---

### dashboard/route.ts

`withAuth()`ë¡œ ì¸ì¦ ê²€ì¦ í›„, `currentUser.role !== 'learner'`ì´ë©´ 403ì„ ë°˜í™˜í•œë‹¤.

**Unit Test**

```typescript
describe('GET /api/dashboard/learner', () => {
  it('ë¯¸ì¸ì¦ ìš”ì²­ â†’ 401 UNAUTHORIZED')
  it('instructor ì—­í•  ìš”ì²­ â†’ 403 FORBIDDEN')
  it('learner ìš”ì²­ â†’ 200 LearnerDashboardResponse')
})
```

---

### enrolled-course-card.tsx

ì§„í–‰ë¥ ì„ `(completedCount / totalCount) * 100`ìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ `shadcn Progress` ì»´í¬ë„ŒíŠ¸ë¡œ ë Œë”ë§í•œë‹¤.

**QA Sheet**

| ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|
| ì§„í–‰ë¥  0% | Progress ë°” ë¹„ì–´ìˆìŒ, "0%" í…ìŠ¤íŠ¸ |
| ì§„í–‰ë¥  60% | Progress ë°” 60% ì±„ì›Œì§ |
| ì§„í–‰ë¥  100% | Progress ë°” ì™„ì „íˆ ì±„ì›Œì§, ì™„ë£Œ í‘œì‹œ |
| ì½”ìŠ¤ í´ë¦­ | `/courses/[courseId]`ë¡œ ì´ë™ |

---

### dashboard/page.tsx

`useLearnerDashboardQuery`ë¡œ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³  4ê°œ ì„¹ì…˜ì„ ë Œë”ë§í•œë‹¤.
`Instructor` ì—­í• ë¡œ ì ‘ê·¼ ì‹œ `useCurrentUser`ë¡œ ì—­í•  í™•ì¸ í›„ `/instructor/dashboard`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•œë‹¤.

**QA Sheet**

| ì‹œë‚˜ë¦¬ì˜¤ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|
| ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ ìˆìŒ | enrolled-course-card ëª©ë¡ + ì§„í–‰ë¥  ë°” í‘œì‹œ |
| ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ ì—†ìŒ | "ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤" + "ì½”ìŠ¤ íƒìƒ‰í•˜ê¸°" ë§í¬ |
| ë§ˆê° ì„ë°• ê³¼ì œ ìˆìŒ | ê³¼ì œëª…Â·ì½”ìŠ¤ëª…Â·due_at ì˜¤ë¦„ì°¨ìˆœ í‘œì‹œ |
| ë§ˆê° ì„ë°• ê³¼ì œ ì—†ìŒ | "ì„ë°•í•œ ê³¼ì œ ì—†ìŠµë‹ˆë‹¤" ë¹ˆ ìƒíƒœ |
| ìµœê·¼ í”¼ë“œë°± ìˆìŒ | ê³¼ì œëª…Â·ì ìˆ˜Â·í”¼ë“œë°± ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ |
| ìµœê·¼ í”¼ë“œë°± ì—†ìŒ | "ì•„ì§ ì±„ì ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤" ë¹ˆ ìƒíƒœ |
| Instructor ì—­í•  ì ‘ê·¼ | `/instructor/dashboard`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| ë¡œë”© ì¤‘ | ê° ì„¹ì…˜ì— ìŠ¤ì¼ˆë ˆí†¤ UI í‘œì‹œ |
| API ì˜¤ë¥˜ | ì˜¤ë¥˜ ë©”ì‹œì§€ + ì¬ì‹œë„ ë²„íŠ¼ í‘œì‹œ |
</file>

<file path="003/spec.md">
# UC-003: Learner ëŒ€ì‹œë³´ë“œ

## Primary Actor

Learner (ì¸ì¦ëœ í•™ìŠµì)

## Precondition

- ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `learner`ì¸ ì‚¬ìš©ì
- ì˜¨ë³´ë”©ì´ ì™„ë£Œëœ ìƒíƒœ

## Trigger

ì‚¬ìš©ìê°€ `/dashboard` ë˜ëŠ” ì˜¨ë³´ë”© ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ Learner ëŒ€ì‹œë³´ë“œì— ì§„ì…í•œë‹¤.

## Main Scenario

1. ì‚¬ìš©ìê°€ ëŒ€ì‹œë³´ë“œì— ì ‘ê·¼í•œë‹¤.
2. FEê°€ `GET /api/dashboard/learner`ë¥¼ í˜¸ì¶œí•œë‹¤.
3. BEê°€ `enrollments WHERE cancelled_at IS NULL`ì„ ê¸°ì¤€ìœ¼ë¡œ í™œì„± ìˆ˜ê°• ëª©ë¡ì„ ì¡°íšŒí•œë‹¤.
4. BEê°€ ê° ì½”ìŠ¤ì— ëŒ€í•´ ì§„í–‰ë¥ ì„ ê³„ì‚°í•œë‹¤.
   - ë¶„ì: `COUNT(submissions WHERE status != 'resubmission_required')`
   - ë¶„ëª¨: `COUNT(assignments WHERE status = 'published' AND course_id = ?)`
5. BEê°€ ë§ˆê° ì„ë°• ê³¼ì œë¥¼ ì¡°íšŒí•œë‹¤ (`due_at ASC ORDER`, ë¯¸ì œì¶œ ê³¼ì œ ìš°ì„ ).
6. BEê°€ ìµœê·¼ í”¼ë“œë°±ì„ ì¡°íšŒí•œë‹¤ (`submissions WHERE status = 'graded'`, ìµœì‹ ìˆœ).
7. BEê°€ ë‚´ ì½”ìŠ¤ ëª©ë¡Â·ì§„í–‰ë¥ Â·ë§ˆê° ì„ë°• ê³¼ì œÂ·ìµœê·¼ í”¼ë“œë°±ì„ ë‹¨ì¼ ì‘ë‹µìœ¼ë¡œ ë°˜í™˜í•œë‹¤.
8. FEê°€ ê° ì„¹ì…˜ì„ ë Œë”ë§í•œë‹¤.

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ê°€ ì—†ìŒ | ë¹ˆ ì½”ìŠ¤ ëª©ë¡ í‘œì‹œ ë° ì½”ìŠ¤ íƒìƒ‰ ìœ ë„ ì•ˆë‚´ |
| ë§ˆê° ì„ë°• ê³¼ì œê°€ ì—†ìŒ | í•´ë‹¹ ì„¹ì…˜ ë¹ˆ ìƒíƒœ í‘œì‹œ |
| ìµœê·¼ í”¼ë“œë°±ì´ ì—†ìŒ | í•´ë‹¹ ì„¹ì…˜ ë¹ˆ ìƒíƒœ í‘œì‹œ |
| ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼ | 401 ë°˜í™˜ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| Instructor ì—­í• ë¡œ ì ‘ê·¼ | 403 ë°˜í™˜ â†’ Instructor ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | FEì—ì„œ ì¬ì‹œë„ ìœ ë„ ë©”ì‹œì§€ í‘œì‹œ |

## Business Rules

- ì·¨ì†Œëœ ìˆ˜ê°•(`cancelled_at IS NOT NULL`)ì€ ëŒ€ì‹œë³´ë“œ ëª©ë¡ì—ì„œ ì œì™¸ëœë‹¤.
- ì§„í–‰ë¥ ì€ `published` ìƒíƒœ ê³¼ì œë§Œ ë¶„ëª¨ë¡œ ì‚°ì •í•˜ë©°, `resubmission_required` ìƒíƒœ ì œì¶œë¬¼ì€ ì™„ë£Œë¡œ ì§‘ê³„í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ë¯¸ì œì¶œÂ·ë¯¸ì±„ì  ê³¼ì œëŠ” ì§„í–‰ë¥  ë¶„ìì— í¬í•¨ë˜ì§€ ì•ŠëŠ”ë‹¤ (0ì  ì²˜ë¦¬ ì—†ìŒ).
- ë§ˆê° ì„ë°• ê³¼ì œëŠ” `due_at` ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ê°€ì¥ ì„ë°•í•œ í•­ëª©ì„ ìš°ì„  í‘œì‹œí•œë‹¤.
- ìµœê·¼ í”¼ë“œë°±ì€ `status = 'graded'`ì¸ ì œì¶œë¬¼ì— í•œí•´ í‘œì‹œí•œë‹¤.

## Sequence Diagram

```plantuml
@startuml

actor User
participant FE
participant BE
database Database

User -> FE: /dashboard ì ‘ê·¼
FE -> BE: GET /api/dashboard/learner
BE -> Database: SELECT enrollments\nWHERE learner_id = ?\nAND cancelled_at IS NULL
Database --> BE: í™œì„± ìˆ˜ê°• ëª©ë¡ (course_id ë°°ì—´)
BE -> Database: SELECT courses\nWHERE id IN (...)
Database --> BE: ì½”ìŠ¤ ì •ë³´
BE -> Database: SELECT COUNT(submissions)\nWHERE status != 'resubmission_required'\nGROUP BY course_id
Database --> BE: ì½”ìŠ¤ë³„ ì™„ë£Œ ì œì¶œ ìˆ˜ (ë¶„ì)
BE -> Database: SELECT COUNT(assignments)\nWHERE status = 'published'\nGROUP BY course_id
Database --> BE: ì½”ìŠ¤ë³„ ê³µê°œ ê³¼ì œ ìˆ˜ (ë¶„ëª¨)
BE -> Database: SELECT assignments\nWHERE course_id IN (...)\nAND status = 'published'\nAND due_at > NOW()\nORDER BY due_at ASC
Database --> BE: ë§ˆê° ì„ë°• ê³¼ì œ ëª©ë¡
BE -> Database: SELECT submissions\nWHERE learner_id = ?\nAND status = 'graded'\nORDER BY graded_at DESC
Database --> BE: ìµœê·¼ í”¼ë“œë°± ëª©ë¡
BE --> FE: 200 {courses, progress, upcomingAssignments, recentFeedbacks}
FE -> User: ëŒ€ì‹œë³´ë“œ ë Œë”ë§\n(ë‚´ ì½”ìŠ¤ + ì§„í–‰ë¥  + ë§ˆê° ì„ë°• ê³¼ì œ + ìµœê·¼ í”¼ë“œë°±)

@enduml
```
</file>

<file path="004/spec.md">
# UC-004: ê³¼ì œ ìƒì„¸ ì—´ëŒ (Learner)

## Primary Actor

Learner (ì¸ì¦ëœ í•™ìŠµì)

## Precondition

- ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `learner`ì¸ ì‚¬ìš©ì
- ì˜¨ë³´ë”©ì´ ì™„ë£Œëœ ìƒíƒœ
- í•´ë‹¹ ì½”ìŠ¤ì— í™œì„± ìˆ˜ê°• ì¤‘ì¸ ìƒíƒœ (`enrollments.cancelled_at IS NULL`)

---

## Trigger

ì‚¬ìš©ìê°€ ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ì˜ ê³¼ì œ ëª©ë¡ ë˜ëŠ” ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì— ì ‘ê·¼í•œë‹¤.

---

## Main Scenario

### 4-1. ê³¼ì œ ëª©ë¡ ì¡°íšŒ

1. ì‚¬ìš©ìê°€ `/my/courses/:courseId/assignments` í˜ì´ì§€ì— ì ‘ê·¼í•œë‹¤.
2. FEê°€ `GET /api/my/courses/:courseId/assignments`ë¥¼ í˜¸ì¶œí•œë‹¤.
3. BEê°€ ìš”ì²­ ì‚¬ìš©ìì˜ `enrollments` ë ˆì½”ë“œë¥¼ ì¡°íšŒí•˜ì—¬ í™œì„± ìˆ˜ê°• ì—¬ë¶€ë¥¼ ê²€ì¦í•œë‹¤.
   - `cancelled_at IS NULL` ì¸ ë ˆì½”ë“œê°€ ì—†ìœ¼ë©´ 403 ë°˜í™˜.
4. BEê°€ í•´ë‹¹ ì½”ìŠ¤ì˜ `status = 'published'` ê³¼ì œ ëª©ë¡ì„ ì¡°íšŒí•œë‹¤.
5. BEê°€ ê° ê³¼ì œì— ëŒ€í•œ ë³¸ì¸ ì œì¶œ ìƒíƒœ(`submissions` ë ˆì½”ë“œ)ë¥¼ í•¨ê»˜ ì¡°íšŒí•œë‹¤.
6. BEê°€ ê³¼ì œ ëª©ë¡ì„ `due_at ASC` ìˆœìœ¼ë¡œ ë°˜í™˜í•œë‹¤.
7. FEê°€ ê³¼ì œ ì¹´ë“œ ëª©ë¡ì„ ë Œë”ë§í•œë‹¤. ê° ì¹´ë“œì— ë§ˆê° ìƒíƒœ(ë§ˆê° ì „/ë§ˆê° í›„)ì™€ ì œì¶œ ìƒíƒœë¥¼ í‘œì‹œí•œë‹¤.

### 4-2. ê³¼ì œ ìƒì„¸ ì¡°íšŒ

1. ì‚¬ìš©ìê°€ ê³¼ì œ ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ `/my/courses/:courseId/assignments/:assignmentId` í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤.
2. FEê°€ `GET /api/my/courses/:courseId/assignments/:assignmentId`ë¥¼ í˜¸ì¶œí•œë‹¤.
3. BEê°€ í™œì„± ìˆ˜ê°• ì—¬ë¶€ë¥¼ ì¬ê²€ì¦í•œë‹¤.
4. BEê°€ `assignments.status = 'published'` ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.
   - `draft` ìƒíƒœì´ë©´ 404 ë°˜í™˜ (ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²ƒìœ¼ë¡œ ì²˜ë¦¬).
5. BEê°€ ê³¼ì œ ìƒì„¸ ì •ë³´ì™€ ë³¸ì¸ ì œì¶œ ë ˆì½”ë“œ(`submissions`)ë¥¼ í•¨ê»˜ ì¡°íšŒí•˜ì—¬ ë°˜í™˜í•œë‹¤.
6. FEê°€ ê³¼ì œ ìƒì„¸ í˜ì´ì§€ë¥¼ ë Œë”ë§í•œë‹¤.
   - í‘œì‹œ í•­ëª©: ì œëª©, ì„¤ëª…, ë§ˆê°ì¼, ì ìˆ˜ ë¹„ì¤‘(`weight`), ì§€ê° í—ˆìš© ì—¬ë¶€(`allow_late`), ì¬ì œì¶œ í—ˆìš© ì—¬ë¶€(`allow_resubmit`), ë³¸ì¸ ì œì¶œ ìƒíƒœ.
   - `assignments.status = 'closed'` ì´ê±°ë‚˜ `NOW() > due_at AND allow_late = false` ì¸ ê²½ìš° ì œì¶œ ë²„íŠ¼ì„ ë¹„í™œì„±í™”í•œë‹¤.
   - ë¯¸ì œì¶œ ìƒíƒœ(`submissions` ë ˆì½”ë“œ ì—†ìŒ)ì´ë©´ "ì œì¶œí•˜ê¸°" ë²„íŠ¼ì„ í‘œì‹œí•œë‹¤.
   - ì´ë¯¸ ì œì¶œëœ ìƒíƒœ(`submissions.status = 'submitted'` ë˜ëŠ” `'graded'`)ì´ë©´ ì œì¶œ ë²„íŠ¼ì„ ìˆ¨ê¸°ê³  ì œì¶œ ë‚´ì—­ì„ í‘œì‹œí•œë‹¤.
   - `submissions.status = 'resubmission_required'`ì´ê³  `allow_resubmit = true`ì´ë©´ "ì¬ì œì¶œí•˜ê¸°" ë²„íŠ¼ì„ í™œì„±í™”í•œë‹¤.

---

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| ìˆ˜ê°•í•˜ì§€ ì•Šì€ ì½”ìŠ¤ì˜ ê³¼ì œ ì ‘ê·¼ | 403 ë°˜í™˜ â†’ "ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ê°€ ì•„ë‹™ë‹ˆë‹¤" ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ |
| ìˆ˜ê°• ì·¨ì†Œëœ ì½”ìŠ¤ì˜ ê³¼ì œ ì ‘ê·¼ | 403 ë°˜í™˜ â†’ ì½”ìŠ¤ ì¹´íƒˆë¡œê·¸ë¡œ ìœ ë„ |
| `draft` ìƒíƒœ ê³¼ì œ ì§ì ‘ URL ì ‘ê·¼ | 404 ë°˜í™˜ â†’ ê³¼ì œ ëª©ë¡ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| `closed` ìƒíƒœ ê³¼ì œ ì—´ëŒ | 200 ë°˜í™˜, ìƒì„¸ ë‚´ìš©ì€ í‘œì‹œí•˜ë‚˜ ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™” |
| ë§ˆê° í›„(`NOW() > due_at`) `allow_late = false` ê³¼ì œ ì ‘ê·¼ | 200 ë°˜í™˜, ìƒì„¸ ë‚´ìš© í‘œì‹œ, ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™” ë° "ë§ˆê°ëœ ê³¼ì œì…ë‹ˆë‹¤" ì•ˆë‚´ |
| ë§ˆê° í›„ `allow_late = true` ê³¼ì œ ì ‘ê·¼ | 200 ë°˜í™˜, ì œì¶œ ë²„íŠ¼ í™œì„±í™”, "ì§€ê° ì œì¶œ ê°€ëŠ¥" ì•ˆë‚´ ë°°ì§€ í‘œì‹œ |
| ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼ | 401 ë°˜í™˜ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| Instructor ì—­í• ë¡œ ì ‘ê·¼ | 403 ë°˜í™˜ â†’ Instructor ì „ìš© ê²½ë¡œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| ì¡´ì¬í•˜ì§€ ì•ŠëŠ” `assignmentId` | 404 ë°˜í™˜ â†’ ê³¼ì œ ëª©ë¡ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |

---

## Business Rules

- `assignments.status = 'published'` ìƒíƒœì˜ ê³¼ì œë§Œ Learnerì—ê²Œ ì—´ëŒ í—ˆìš©ëœë‹¤.
- `assignments.status = 'closed'` ìƒíƒœëŠ” ê°•ì‚¬ê°€ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•œ ê°•ì œ ë§ˆê° ìƒíƒœì´ë©°, ì—´ëŒì€ ê°€ëŠ¥í•˜ë˜ ì‹ ê·œ ì œì¶œì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
- ìë™ ë§ˆê° ì¡°ê±´: `status = 'published'` ì´ê³  `NOW() > due_at` ì¼ ë•Œ `allow_late = false`ì´ë©´ ì œì¶œì´ ì°¨ë‹¨ëœë‹¤.
- ê³¼ì œ ì—´ëŒ ì „ ë°˜ë“œì‹œ í•´ë‹¹ ì½”ìŠ¤ì˜ í™œì„± ìˆ˜ê°• ì—¬ë¶€(`cancelled_at IS NULL`)ë¥¼ ê²€ì¦í•´ì•¼ í•œë‹¤.
- ë³¸ì¸ ì œì¶œ ìƒíƒœëŠ” ê³¼ì œ ìƒì„¸ ì‘ë‹µì— í¬í•¨ë˜ì–´ì•¼ í•˜ë©°, FEëŠ” ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ UI ìƒíƒœë¥¼ ê²°ì •í•œë‹¤.
- `allow_resubmit = false`ì¸ ê²½ìš°, ì œì¶œ ì™„ë£Œ í›„ ì¬ì œì¶œ ë²„íŠ¼ì„ í‘œì‹œí•˜ì§€ ì•ŠëŠ”ë‹¤.

---

## Sequence Diagram

```plantuml
@startuml

actor User
participant FE
participant BE
database Database

User -> FE: /my/courses/:courseId/assignments ì ‘ê·¼

FE -> BE: GET /api/my/courses/:courseId/assignments
BE -> Database: SELECT enrollments\nWHERE course_id = ? AND learner_id = ?\nAND cancelled_at IS NULL
Database --> BE: ìˆ˜ê°• ë ˆì½”ë“œ (ì—†ìœ¼ë©´ 403)
BE -> Database: SELECT assignments\nWHERE course_id = ? AND status = 'published'\nORDER BY due_at ASC
Database --> BE: ê³¼ì œ ëª©ë¡
BE -> Database: SELECT submissions\nWHERE assignment_id IN (...) AND learner_id = ?
Database --> BE: ë³¸ì¸ ì œì¶œ ìƒíƒœ ëª©ë¡
BE --> FE: 200 {assignments: [{...assignment, mySubmission}]}
FE -> User: ê³¼ì œ ëª©ë¡ ë Œë”ë§\n(ë§ˆê° ìƒíƒœ + ì œì¶œ ìƒíƒœ í‘œì‹œ)

User -> FE: ê³¼ì œ ì¹´ë“œ í´ë¦­
FE -> BE: GET /api/my/courses/:courseId/assignments/:assignmentId
BE -> Database: SELECT enrollments\nWHERE course_id = ? AND learner_id = ?\nAND cancelled_at IS NULL
Database --> BE: ìˆ˜ê°• ë ˆì½”ë“œ (ì—†ìœ¼ë©´ 403)
BE -> Database: SELECT assignments\nWHERE id = ? AND status != 'draft'
Database --> BE: ê³¼ì œ ìƒì„¸ (ì—†ìœ¼ë©´ 404)
BE -> Database: SELECT submissions\nWHERE assignment_id = ? AND learner_id = ?
Database --> BE: ë³¸ì¸ ì œì¶œ ë ˆì½”ë“œ (ì—†ìœ¼ë©´ null)
BE --> FE: 200 {assignment, mySubmission}

alt status = 'closed' OR (NOW() > due_at AND allow_late = false)
  FE -> User: ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™” + ë§ˆê° ì•ˆë‚´
else mySubmission IS NULL
  FE -> User: "ì œì¶œí•˜ê¸°" ë²„íŠ¼ í™œì„±í™”
else mySubmission.status = 'resubmission_required' AND allow_resubmit = true
  FE -> User: "ì¬ì œì¶œí•˜ê¸°" ë²„íŠ¼ í™œì„±í™”
else
  FE -> User: ì œì¶œ ë‚´ì—­ í‘œì‹œ (ë²„íŠ¼ ìˆ¨ê¹€)
end

@enduml
```
</file>

<file path="005/spec.md">
# UC-005: ê³¼ì œ ì œì¶œ / ì¬ì œì¶œ (Learner)

## Primary Actor

Learner (ì¸ì¦ëœ í•™ìŠµì)

## Precondition

- ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `learner`ì¸ ì‚¬ìš©ì
- í•´ë‹¹ ì½”ìŠ¤ì— í™œì„± ìˆ˜ê°• ì¤‘ì¸ ìƒíƒœ (`enrollments.cancelled_at IS NULL`)
- ëŒ€ìƒ ê³¼ì œê°€ `assignments.status = 'published'` ìƒíƒœ
- ì‹ ê·œ ì œì¶œ: í•´ë‹¹ ê³¼ì œì— ê¸°ì¡´ ì œì¶œ ë ˆì½”ë“œê°€ ì—†ìŒ
- ì¬ì œì¶œ: ê¸°ì¡´ ì œì¶œ ë ˆì½”ë“œì˜ `status = 'resubmission_required'` ì´ê³  `assignments.allow_resubmit = true`

---

## Trigger

ì‚¬ìš©ìê°€ ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì—ì„œ "ì œì¶œí•˜ê¸°" ë˜ëŠ” "ì¬ì œì¶œí•˜ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ê³  í¼ì„ ì œì¶œí•œë‹¤.

---

## Main Scenario

### 5-1. ì‹ ê·œ ì œì¶œ

1. ì‚¬ìš©ìê°€ ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì—ì„œ "ì œì¶œí•˜ê¸°" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
2. FEê°€ ì œì¶œ í¼ì„ í‘œì‹œí•œë‹¤. (í…ìŠ¤íŠ¸ í•„ë“œ í•„ìˆ˜, ë§í¬ í•„ë“œ ì„ íƒ)
3. ì‚¬ìš©ìê°€ í…ìŠ¤íŠ¸ ë‚´ìš©ì„ ì…ë ¥í•˜ê³  ì„ íƒì ìœ¼ë¡œ URL ë§í¬ë¥¼ ì…ë ¥í•œë‹¤.
4. FEê°€ ì…ë ¥ê°’ì„ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ê²€ì¦í•œë‹¤.
   - `content_text`: í•„ìˆ˜, 1ì ì´ìƒ
   - `content_link`: ì„ íƒ, ì…ë ¥ ì‹œ ìœ íš¨í•œ URL í˜•ì‹ì´ì–´ì•¼ í•¨
5. FEê°€ `POST /api/my/courses/:courseId/assignments/:assignmentId/submissions`ë¥¼ í˜¸ì¶œí•œë‹¤.
6. BEê°€ í™œì„± ìˆ˜ê°• ì—¬ë¶€ë¥¼ ê²€ì¦í•œë‹¤.
7. BEê°€ ê³¼ì œ ìƒíƒœ ë° ì œì¶œ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ê²€ì¦í•œë‹¤.
   - `assignments.status = 'closed'`ì´ë©´ 409 ë°˜í™˜ (ê°•ì œ ë§ˆê°).
   - `NOW() > due_at` ì´ê³  `allow_late = false`ì´ë©´ 409 ë°˜í™˜ (ë§ˆê° ì´ˆê³¼).
   - `NOW() > due_at` ì´ê³  `allow_late = true`ì´ë©´ `is_late = true`ë¡œ ì„¤ì •.
8. BEê°€ `UNIQUE(assignment_id, learner_id)` ì¶©ëŒ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤. ê¸°ì¡´ ë ˆì½”ë“œê°€ ìˆìœ¼ë©´ 409 ë°˜í™˜.
9. BEê°€ `submissions` í…Œì´ë¸”ì— INSERTí•œë‹¤.
   - `status = 'submitted'`
   - `is_late`: ë§ˆê° ì „ì´ë©´ `false`, ë§ˆê° í›„ ì§€ê° í—ˆìš©ì´ë©´ `true`
   - `submitted_at = NOW()`
10. BEê°€ ì„±ê³µ ì‘ë‹µì„ ë°˜í™˜í•œë‹¤.
11. FEê°€ ì„±ê³µ í”¼ë“œë°±ì„ í‘œì‹œí•˜ê³  ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì˜ ì œì¶œ ìƒíƒœë¥¼ ê°±ì‹ í•œë‹¤.

### 5-2. ì¬ì œì¶œ

1. ì‚¬ìš©ìê°€ ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì—ì„œ "ì¬ì œì¶œí•˜ê¸°" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
   - ì´ ë²„íŠ¼ì€ `submissions.status = 'resubmission_required'`ì´ê³  `assignments.allow_resubmit = true`ì¼ ë•Œë§Œ í‘œì‹œëœë‹¤.
2. FEê°€ ê¸°ì¡´ ì œì¶œ ë‚´ìš©ì„ í¼ì— pre-fillí•˜ì—¬ í‘œì‹œí•œë‹¤.
3. ì‚¬ìš©ìê°€ ë‚´ìš©ì„ ìˆ˜ì •í•˜ê³  ì¬ì œì¶œí•œë‹¤.
4. FEê°€ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ì¦ì„ ìˆ˜í–‰í•œë‹¤. (ì‹ ê·œ ì œì¶œê³¼ ë™ì¼)
5. FEê°€ `PUT /api/my/courses/:courseId/assignments/:assignmentId/submissions`ë¥¼ í˜¸ì¶œí•œë‹¤.
6. BEê°€ í™œì„± ìˆ˜ê°• ì—¬ë¶€ë¥¼ ê²€ì¦í•œë‹¤.
7. BEê°€ ì¬ì œì¶œ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ê²€ì¦í•œë‹¤.
   - ê¸°ì¡´ ì œì¶œ ë ˆì½”ë“œê°€ ì—†ìœ¼ë©´ 404 ë°˜í™˜.
   - `submissions.status != 'resubmission_required'`ì´ë©´ 409 ë°˜í™˜.
   - `assignments.allow_resubmit = false`ì´ë©´ 403 ë°˜í™˜.
   - `assignments.status = 'closed'`ì´ë©´ 409 ë°˜í™˜.
   - `NOW() > due_at` ì´ê³  `allow_late = false`ì´ë©´ 409 ë°˜í™˜.
8. BEê°€ ê¸°ì¡´ `submissions` ë ˆì½”ë“œë¥¼ UPDATEí•œë‹¤.
   - `content_text`, `content_link` ê°±ì‹ 
   - `status = 'submitted'` ìœ¼ë¡œ ì´ˆê¸°í™”
   - `score = NULL`, `feedback = NULL` ì´ˆê¸°í™”
   - `graded_at = NULL` ì´ˆê¸°í™”
   - `is_late`: ë§ˆê° ì „ì´ë©´ `false`, ë§ˆê° í›„ ì§€ê° í—ˆìš©ì´ë©´ `true`
   - `submitted_at = NOW()` ê°±ì‹ 
9. BEê°€ ì„±ê³µ ì‘ë‹µì„ ë°˜í™˜í•œë‹¤.
10. FEê°€ ì„±ê³µ í”¼ë“œë°±ì„ í‘œì‹œí•˜ê³  ì œì¶œ ìƒíƒœë¥¼ ê°±ì‹ í•œë‹¤.

---

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| `content_text` ë¯¸ì…ë ¥ | í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ì¦ ì°¨ë‹¨ â†’ í•„ë“œ ì¸ë¼ì¸ ì˜¤ë¥˜ í‘œì‹œ, ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™” |
| `content_link` í˜•ì‹ ì˜¤ë¥˜ (URLì´ ì•„ë‹Œ ê°’) | í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ì¦ ì°¨ë‹¨ â†’ "ìœ íš¨í•œ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤" ì•ˆë‚´ |
| `assignments.status = 'closed'` ìƒíƒœì—ì„œ ì œì¶œ ì‹œë„ | 409 ë°˜í™˜ â†’ "ê°•ì‚¬ì— ì˜í•´ ë§ˆê°ëœ ê³¼ì œì…ë‹ˆë‹¤" ì•ˆë‚´ ë©”ì‹œì§€ |
| ë§ˆê° í›„ `allow_late = false` ê³¼ì œ ì œì¶œ ì‹œë„ | 409 ë°˜í™˜ â†’ "ì œì¶œ ë§ˆê° ì‹œê°„ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤" ì•ˆë‚´ ë©”ì‹œì§€ |
| ë§ˆê° í›„ `allow_late = true` ê³¼ì œ ì œì¶œ | `is_late = true`ë¡œ ì €ì¥, FEì— "ì§€ê° ì œì¶œë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤" ì•ˆë‚´ |
| ì´ë¯¸ `submitted` ë˜ëŠ” `graded` ìƒíƒœ ê³¼ì œì— ì‹ ê·œ ì œì¶œ ì‹œë„ | 409 ë°˜í™˜ â†’ FEì—ì„œ ì œì¶œ ë²„íŠ¼ ë¯¸í‘œì‹œë¡œ ì‚¬ì „ ì°¨ë‹¨ |
| `allow_resubmit = false`ì¸ ê³¼ì œì˜ ì¬ì œì¶œ ì‹œë„ | 403 ë°˜í™˜ â†’ FEì—ì„œ ì¬ì œì¶œ ë²„íŠ¼ ë¯¸í‘œì‹œë¡œ ì‚¬ì „ ì°¨ë‹¨ |
| `resubmission_required` ìƒíƒœê°€ ì•„ë‹Œ ì œì¶œë¬¼ì— ì¬ì œì¶œ ì‹œë„ | 409 ë°˜í™˜ â†’ FEì—ì„œ ì¬ì œì¶œ ë²„íŠ¼ ë¯¸í‘œì‹œë¡œ ì‚¬ì „ ì°¨ë‹¨ |
| ìˆ˜ê°•í•˜ì§€ ì•Šì€ ì½”ìŠ¤ì˜ ê³¼ì œ ì œì¶œ ì‹œë„ | 403 ë°˜í™˜ â†’ "ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ê°€ ì•„ë‹™ë‹ˆë‹¤" ì•ˆë‚´ ë©”ì‹œì§€ |
| ì¸ì¦ë˜ì§€ ì•Šì€ ìš”ì²­ | 401 ë°˜í™˜ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |

---

## Business Rules

- `content_text`ëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì´ë©° 1ì ì´ìƒì´ì–´ì•¼ í•œë‹¤.
- `content_link`ëŠ” ì„ íƒ ì…ë ¥ í•­ëª©ì´ë©°, ì…ë ¥ ì‹œ ìœ íš¨í•œ URL í˜•ì‹ì´ì–´ì•¼ í•œë‹¤.
- `UNIQUE(assignment_id, learner_id)` ì œì•½ìœ¼ë¡œ ì¸í•´ ë™ì¼ ê³¼ì œì— ëŒ€í•´ í•˜ë‚˜ì˜ ì œì¶œ ë ˆì½”ë“œë§Œ ì¡´ì¬í•œë‹¤. ì‹ ê·œ ì œì¶œì€ INSERT, ì¬ì œì¶œì€ UPDATEë¡œ ì²˜ë¦¬í•œë‹¤.
- ë§ˆê° ì „ ì œì¶œ: `is_late = false`, ë§ˆê° í›„ ì§€ê° í—ˆìš© ì œì¶œ: `is_late = true`.
- `assignments.status = 'closed'`ì´ë©´ ì§€ê° í—ˆìš© ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ ì œì¶œì´ ì°¨ë‹¨ëœë‹¤.
- ì¬ì œì¶œ ì‹œ ê¸°ì¡´ ì±„ì  ê²°ê³¼(`score`, `feedback`, `graded_at`)ëŠ” NULLë¡œ ì´ˆê¸°í™”ë˜ë©° `status`ëŠ” `submitted`ë¡œ ë³µì›ëœë‹¤.
- ì¬ì œì¶œì€ `submissions.status = 'resubmission_required'` ì´ê³  `assignments.allow_resubmit = true`ì¸ ê²½ìš°ì—ë§Œ í—ˆìš©ëœë‹¤.
- ë§ˆê°ì¼ ê³„ì‚°ì€ ì„œë²„ ì‹œê°(`NOW()`)ì„ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤. í´ë¼ì´ì–¸íŠ¸ ì‹œê°ì€ ì°¸ì¡°ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•œë‹¤.

---

## Sequence Diagram

```plantuml
@startuml

actor User
participant FE
participant BE
database Database

== ì‹ ê·œ ì œì¶œ ==

User -> FE: "ì œì¶œí•˜ê¸°" í´ë¦­
FE -> User: ì œì¶œ í¼ í‘œì‹œ\n(content_text í•„ìˆ˜, content_link ì„ íƒ)
User -> FE: í…ìŠ¤íŠ¸ ì…ë ¥ + (ì„ íƒ) URL ì…ë ¥ í›„ ì œì¶œ
FE -> FE: í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ì¦\n(content_text í•„ìˆ˜, content_link URL í˜•ì‹)
FE -> BE: POST /api/my/courses/:courseId/assignments/:assignmentId/submissions\n{content_text, content_link?}

BE -> Database: SELECT enrollments\nWHERE course_id = ? AND learner_id = ?\nAND cancelled_at IS NULL
Database --> BE: ìˆ˜ê°• ë ˆì½”ë“œ (ì—†ìœ¼ë©´ 403)

BE -> Database: SELECT assignments\nWHERE id = ? AND status = 'published'
Database --> BE: ê³¼ì œ ë ˆì½”ë“œ (ì—†ìœ¼ë©´ 404)

BE -> BE: ë§ˆê° ì—¬ë¶€ íŒë‹¨\n- status = 'closed' â†’ 409\n- NOW() > due_at AND allow_late = false â†’ 409\n- NOW() > due_at AND allow_late = true â†’ is_late = true

BE -> Database: SELECT submissions\nWHERE assignment_id = ? AND learner_id = ?
Database --> BE: ê¸°ì¡´ ì œì¶œ ë ˆì½”ë“œ (ìˆìœ¼ë©´ 409)

BE -> Database: INSERT submissions\n(assignment_id, learner_id, content_text,\ncontent_link, is_late, status='submitted',\nsubmitted_at=NOW())
Database --> BE: ì €ì¥ ì™„ë£Œ
BE --> FE: 201 {submission}
FE -> User: ì„±ê³µ í”¼ë“œë°± + ì œì¶œ ìƒíƒœ ê°±ì‹ 

== ì¬ì œì¶œ ==

User -> FE: "ì¬ì œì¶œí•˜ê¸°" í´ë¦­
FE -> User: ê¸°ì¡´ ë‚´ìš© pre-fillëœ í¼ í‘œì‹œ
User -> FE: ë‚´ìš© ìˆ˜ì • í›„ ì¬ì œì¶œ
FE -> FE: í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²€ì¦
FE -> BE: PUT /api/my/courses/:courseId/assignments/:assignmentId/submissions\n{content_text, content_link?}

BE -> Database: SELECT enrollments (í™œì„± ìˆ˜ê°• ê²€ì¦)
Database --> BE: ìˆ˜ê°• ë ˆì½”ë“œ (ì—†ìœ¼ë©´ 403)

BE -> Database: SELECT assignments\nWHERE id = ? AND status = 'published'
Database --> BE: ê³¼ì œ ë ˆì½”ë“œ\n(allow_resubmit, allow_late, due_at, status í™•ì¸)

BE -> Database: SELECT submissions\nWHERE assignment_id = ? AND learner_id = ?
Database --> BE: ê¸°ì¡´ ì œì¶œ ë ˆì½”ë“œ (ì—†ìœ¼ë©´ 404)

BE -> BE: ì¬ì œì¶œ ê°€ëŠ¥ ì—¬ë¶€ ê²€ì¦\n- allow_resubmit = false â†’ 403\n- status != 'resubmission_required' â†’ 409\n- assignment.status = 'closed' â†’ 409\n- NOW() > due_at AND allow_late = false â†’ 409

BE -> Database: UPDATE submissions SET\ncontent_text = ?, content_link = ?,\nstatus = 'submitted', score = NULL,\nfeedback = NULL, graded_at = NULL,\nis_late = ?, submitted_at = NOW()\nWHERE assignment_id = ? AND learner_id = ?
Database --> BE: ì €ì¥ ì™„ë£Œ
BE --> FE: 200 {submission}
FE -> User: ì„±ê³µ í”¼ë“œë°± + ì œì¶œ ìƒíƒœ ê°±ì‹ 

@enduml
```
</file>

<file path="006/spec.md">
# UC-006: ì„±ì  & í”¼ë“œë°± ì—´ëŒ (Learner)

## Primary Actor

Learner (ì¸ì¦ëœ í•™ìŠµì)

## Precondition

- ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `learner`ì¸ ì‚¬ìš©ì
- í•´ë‹¹ ì½”ìŠ¤ì— í™œì„± ìˆ˜ê°• ì¤‘ì¸ ìƒíƒœ (`enrollments.cancelled_at IS NULL`)

---

## Trigger

ì‚¬ìš©ìê°€ ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ì˜ ì„±ì  í˜ì´ì§€ (`/my/courses/:courseId/grades`)ì— ì ‘ê·¼í•œë‹¤.

---

## Main Scenario

1. ì‚¬ìš©ìê°€ `/my/courses/:courseId/grades` í˜ì´ì§€ì— ì ‘ê·¼í•œë‹¤.
2. FEê°€ `GET /api/my/courses/:courseId/grades`ë¥¼ í˜¸ì¶œí•œë‹¤.
3. BEê°€ ìš”ì²­ ì‚¬ìš©ìì˜ í™œì„± ìˆ˜ê°• ì—¬ë¶€ë¥¼ ê²€ì¦í•œë‹¤.
   - `enrollments WHERE course_id = ? AND learner_id = ? AND cancelled_at IS NULL` ì´ ì—†ìœ¼ë©´ 403 ë°˜í™˜.
4. BEê°€ í•´ë‹¹ ì½”ìŠ¤ì˜ `status = 'published'` ê³¼ì œ ëª©ë¡ì„ ì¡°íšŒí•œë‹¤.
5. BEê°€ ê° ê³¼ì œì— ëŒ€í•œ ë³¸ì¸ ì œì¶œ ë ˆì½”ë“œ(`submissions WHERE learner_id = ?`)ë¥¼ ì¡°íšŒí•œë‹¤.
6. BEê°€ í˜„ì¬ ì„±ì (í˜„ì¬ê¹Œì§€ ì±„ì ëœ ê³¼ì œ ê¸°ì¤€ ê°€ì¤‘ í‰ê· )ì„ ê³„ì‚°í•œë‹¤.
   - ë¶„ì: `SUM(submissions.score * assignments.weight) WHERE submissions.status = 'graded'`
   - ë¶„ëª¨: `SUM(assignments.weight) WHERE submissions.status = 'graded'`
   - ì±„ì ëœ ì œì¶œë¬¼ì´ ì—†ìœ¼ë©´ í˜„ì¬ ì„±ì ì„ `null`ë¡œ ë°˜í™˜í•œë‹¤ (0ì  ì²˜ë¦¬ ì—†ìŒ).
7. BEê°€ ê³¼ì œ ëª©ë¡, ê° ê³¼ì œë³„ ì œì¶œ ìƒíƒœ, í˜„ì¬ ì„±ì ì„ ë‹¨ì¼ ì‘ë‹µìœ¼ë¡œ ë°˜í™˜í•œë‹¤.
8. FEê°€ ì„±ì  í˜ì´ì§€ë¥¼ ë Œë”ë§í•œë‹¤.
   - ìƒë‹¨: í˜„ì¬ ì„±ì  ìš”ì•½ (ê°€ì¤‘ í‰ê·  ì ìˆ˜ ë˜ëŠ” "ì±„ì ëœ ê³¼ì œ ì—†ìŒ")
   - ê³¼ì œ ëª©ë¡: ê³¼ì œëª…, ë§ˆê°ì¼, ì ìˆ˜ ë¹„ì¤‘(`weight`), ì œì¶œ ìƒíƒœ, ì ìˆ˜(`score`), ì§€ê° ì—¬ë¶€(`is_late`), í”¼ë“œë°±(`feedback`)
   - ë¯¸ì œì¶œ ê³¼ì œëŠ” "ë¯¸ì œì¶œ" ë°°ì§€ë¡œ í‘œì‹œí•˜ê³  ì ìˆ˜Â·í”¼ë“œë°± ì—†ìŒìœ¼ë¡œ í‘œì‹œí•œë‹¤.
   - `status = 'submitted'` ê³¼ì œëŠ” "ì±„ì  ëŒ€ê¸°ì¤‘" ë°°ì§€ë¡œ í‘œì‹œí•œë‹¤.
   - `status = 'resubmission_required'` ê³¼ì œëŠ” "ì¬ì œì¶œ ìš”ì²­" ë°°ì§€ë¡œ í‘œì‹œí•˜ê³  í”¼ë“œë°±ì„ í•¨ê»˜ í‘œì‹œí•œë‹¤.
   - `status = 'graded'` ê³¼ì œëŠ” ì ìˆ˜ì™€ í”¼ë“œë°±ì„ ëª¨ë‘ í‘œì‹œí•œë‹¤.

---

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| ìˆ˜ê°•í•˜ì§€ ì•Šì€ ì½”ìŠ¤ì˜ ì„±ì  ì ‘ê·¼ | 403 ë°˜í™˜ â†’ "ìˆ˜ê°• ì¤‘ì¸ ì½”ìŠ¤ê°€ ì•„ë‹™ë‹ˆë‹¤" ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ |
| ìˆ˜ê°• ì·¨ì†Œëœ ì½”ìŠ¤ì˜ ì„±ì  ì ‘ê·¼ | 403 ë°˜í™˜ â†’ ì½”ìŠ¤ ì¹´íƒˆë¡œê·¸ë¡œ ìœ ë„ |
| ì œì¶œí•œ ê³¼ì œê°€ í•˜ë‚˜ë„ ì—†ëŠ” ê²½ìš° | í˜„ì¬ ì„±ì  `null` ë°˜í™˜ â†’ "ì•„ì§ ì±„ì ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤" ì•ˆë‚´ í‘œì‹œ |
| ì œì¶œí•œ ê³¼ì œê°€ ìˆìœ¼ë‚˜ ì±„ì ëœ ê³¼ì œê°€ ì—†ëŠ” ê²½ìš° | í˜„ì¬ ì„±ì  `null` ë°˜í™˜ â†’ "ì±„ì  ëŒ€ê¸°ì¤‘ì¸ ê³¼ì œê°€ ìˆìŠµë‹ˆë‹¤" ì•ˆë‚´ í‘œì‹œ |
| ì½”ìŠ¤ì— published ê³¼ì œê°€ ì—†ëŠ” ê²½ìš° | ë¹ˆ ê³¼ì œ ëª©ë¡ ë°˜í™˜ â†’ "ë“±ë¡ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤" ì•ˆë‚´ í‘œì‹œ |
| `resubmission_required` ìƒíƒœ ì œì¶œë¬¼ | ì±„ì  ì§‘ê³„ ì œì™¸, "ì¬ì œì¶œ ìš”ì²­" ìƒíƒœ í‘œì‹œ ë° í”¼ë“œë°± í‘œì‹œ |
| ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼ | 401 ë°˜í™˜ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| Instructor ì—­í• ë¡œ ì ‘ê·¼ | 403 ë°˜í™˜ â†’ Instructor ì „ìš© ê²½ë¡œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| `is_late = true`ì¸ ì œì¶œë¬¼ | ì ìˆ˜ ë° í”¼ë“œë°± ì •ìƒ í‘œì‹œ, "ì§€ê° ì œì¶œ" ë°°ì§€ ì¶”ê°€ í‘œì‹œ |

---

## Business Rules

- ë³¸ì¸(`learner_id = ìš”ì²­ ì‚¬ìš©ì ID`) ì œì¶œë¬¼ë§Œ ì¡°íšŒ ê°€ëŠ¥í•˜ë‹¤. íƒ€ì¸ì˜ ì„±ì ì€ ì–´ë– í•œ ê²½ìš°ì—ë„ ì—´ëŒí•  ìˆ˜ ì—†ë‹¤.
- í˜„ì¬ ì„±ì  ê³„ì‚°ì€ `status = 'graded'`ì¸ ì œì¶œë¬¼ë§Œ ì§‘ê³„ ëŒ€ìƒì— í¬í•¨í•œë‹¤.
- ë¯¸ì œì¶œ ê³¼ì œ ë° `status != 'graded'`ì¸ ì œì¶œë¬¼(submitted, resubmission_required)ì€ ì„±ì  ì§‘ê³„ì—ì„œ ì œì™¸ëœë‹¤. 0ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
- í˜„ì¬ ì„±ì  ê³µì‹: `SUM(score Ã— weight) / SUM(weight)` â€” `status = 'graded'`ì¸ ê³¼ì œ ê¸°ì¤€ ê°€ì¤‘ í‰ê· .
- ì±„ì ëœ ê³¼ì œê°€ ë‹¨ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ í˜„ì¬ ì„±ì ì€ `null`ë¡œ ë°˜í™˜í•œë‹¤.
- `is_late = true`ì¸ ì œì¶œë¬¼ë„ ì±„ì  ì™„ë£Œ ì‹œ ì •ìƒì ìœ¼ë¡œ ì„±ì  ì§‘ê³„ì— í¬í•¨ëœë‹¤.
- `status = 'resubmission_required'`ì¸ ì œì¶œë¬¼ì€ í”¼ë“œë°±ì„ ì—´ëŒí•  ìˆ˜ ìˆìœ¼ë‚˜ ì±„ì  ì§‘ê³„ì—ì„œ ì œì™¸ëœë‹¤.
- ì—´ëŒ ëŒ€ìƒ ê³¼ì œëŠ” `assignments.status = 'published'`ì¸ ê³¼ì œì— í•œì •ëœë‹¤ (`draft` ê³¼ì œ ì œì™¸).

---

## Sequence Diagram

```plantuml
@startuml

actor User
participant FE
participant BE
database Database

User -> FE: /my/courses/:courseId/grades ì ‘ê·¼
FE -> BE: GET /api/my/courses/:courseId/grades

BE -> Database: SELECT enrollments\nWHERE course_id = ? AND learner_id = ?\nAND cancelled_at IS NULL
Database --> BE: ìˆ˜ê°• ë ˆì½”ë“œ (ì—†ìœ¼ë©´ 403)

BE -> Database: SELECT assignments\nWHERE course_id = ? AND status = 'published'\nORDER BY due_at ASC
Database --> BE: ê³¼ì œ ëª©ë¡ (id, title, due_at, weight)

BE -> Database: SELECT submissions\nWHERE assignment_id IN (...) AND learner_id = ?
Database --> BE: ë³¸ì¸ ì œì¶œ ë ˆì½”ë“œ ëª©ë¡\n(status, score, is_late, feedback, submitted_at, graded_at)

BE -> BE: í˜„ì¬ ì„±ì  ê³„ì‚°\n- ëŒ€ìƒ: status = 'graded'ì¸ ì œì¶œë¬¼\n- ë¶„ì: SUM(score * weight)\n- ë¶„ëª¨: SUM(weight)\n- ì±„ì ëœ ê³¼ì œ ì—†ìŒ â†’ currentGrade = null

BE --> FE: 200 {\n  currentGrade: number | null,\n  assignments: [{\n    ...assignment,\n    mySubmission: {...} | null\n  }]\n}

FE -> User: ì„±ì  í˜ì´ì§€ ë Œë”ë§

note over FE, User
  í˜„ì¬ ì„±ì  ìš”ì•½ ì„¹ì…˜:
  - currentGrade != null â†’ "{ì ìˆ˜}ì  / 100ì " í‘œì‹œ
  - currentGrade == null â†’ "ì±„ì ëœ ê³¼ì œ ì—†ìŒ" í‘œì‹œ

  ê³¼ì œ ëª©ë¡ ì„¹ì…˜ (ì œì¶œ ìƒíƒœë³„ í‘œì‹œ):
  - mySubmission == null â†’ "ë¯¸ì œì¶œ" ë°°ì§€
  - status = 'submitted' â†’ "ì±„ì  ëŒ€ê¸°ì¤‘" ë°°ì§€
  - status = 'resubmission_required' â†’ "ì¬ì œì¶œ ìš”ì²­" ë°°ì§€ + í”¼ë“œë°±
  - status = 'graded' â†’ ì ìˆ˜ + í”¼ë“œë°± + (is_late=trueë©´ "ì§€ê° ì œì¶œ" ë°°ì§€)
end note

@enduml
```
</file>

<file path="007/spec.md">
# UC-007: Instructor ëŒ€ì‹œë³´ë“œ

## Primary Actor

Instructor (ì¸ì¦ëœ ê°•ì‚¬)

---

## Precondition

- ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `instructor`ì¸ ì‚¬ìš©ì
- ì˜¨ë³´ë”©ì´ ì™„ë£Œëœ ìƒíƒœ

---

## Trigger

ê°•ì‚¬ê°€ `/instructor/dashboard` í˜ì´ì§€ì— ì ‘ê·¼í•˜ê±°ë‚˜ ì˜¨ë³´ë”© ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ ëŒ€ì‹œë³´ë“œì— ì§„ì…í•œë‹¤.

---

## Main Scenario

1. ê°•ì‚¬ê°€ `/instructor/dashboard`ì— ì ‘ê·¼í•œë‹¤.
2. FEê°€ `GET /api/instructor/dashboard`ë¥¼ í˜¸ì¶œí•œë‹¤.
3. BEê°€ ìš”ì²­ìì˜ `instructor_id`ë¥¼ ì„¸ì…˜ì—ì„œ ì¶”ì¶œí•œë‹¤.
4. BEê°€ `courses WHERE instructor_id = ?`ë¥¼ ì¡°íšŒí•˜ì—¬ ë‚´ ì½”ìŠ¤ ëª©ë¡(draft/published/archived ì „ì²´)ì„ ê°€ì ¸ì˜¨ë‹¤.
5. BEê°€ ê° ì½”ìŠ¤ì— ì†í•œ `assignments`ì˜ `submissions WHERE status = 'submitted'` ê±´ìˆ˜ë¥¼ ì§‘ê³„í•˜ì—¬ ì½”ìŠ¤ë³„ ì±„ì  ëŒ€ê¸° ìˆ˜ë¥¼ ì‚°ì¶œí•œë‹¤.
6. BEê°€ ì±„ì  ëŒ€ê¸° ìˆ˜ì˜ í•©ì‚°(ì „ì²´ ì±„ì  ëŒ€ê¸° ìˆ˜)ì„ ê³„ì‚°í•œë‹¤.
7. BEê°€ ë‚´ ì½”ìŠ¤ ì „ì²´ì— ëŒ€í•œ ìµœê·¼ ì œì¶œë¬¼ì„ `submitted_at DESC` ê¸°ì¤€ìœ¼ë¡œ ì¡°íšŒí•œë‹¤ (ìµœëŒ€ 10ê±´).
8. BEê°€ ë‚´ ì½”ìŠ¤ ëª©ë¡, ì „ì²´ ì±„ì  ëŒ€ê¸° ìˆ˜, ìµœê·¼ ì œì¶œë¬¼ì„ ë‹¨ì¼ ì‘ë‹µìœ¼ë¡œ ë°˜í™˜í•œë‹¤.
9. FEê°€ ê° ì„¹ì…˜ì„ ë Œë”ë§í•œë‹¤.
   - ë‚´ ì½”ìŠ¤ ëª©ë¡: ì½”ìŠ¤ ì œëª©, ìƒíƒœ(draft/published/archived), ì±„ì  ëŒ€ê¸° ìˆ˜ ë°°ì§€
   - ì „ì²´ ì±„ì  ëŒ€ê¸° ìˆ˜ ìš”ì•½ ì¹´ë“œ
   - ìµœê·¼ ì œì¶œë¬¼: í•™ìŠµìëª…, ê³¼ì œ ì œëª©, ì½”ìŠ¤ ì œëª©, ì œì¶œ ì‹œê°

---

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| ê°œì„¤í•œ ì½”ìŠ¤ê°€ ì—†ìŒ | ë¹ˆ ì½”ìŠ¤ ëª©ë¡ í‘œì‹œ ë° "ì½”ìŠ¤ ë§Œë“¤ê¸°" ìœ ë„ ë²„íŠ¼ í‘œì‹œ |
| ì±„ì  ëŒ€ê¸° ì œì¶œë¬¼ì´ ì—†ìŒ | ì±„ì  ëŒ€ê¸° ìˆ˜ 0 í‘œì‹œ, ìµœê·¼ ì œì¶œë¬¼ ì„¹ì…˜ ë¹ˆ ìƒíƒœ í‘œì‹œ |
| ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì ì ‘ê·¼ | 401 ë°˜í™˜ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| Learner ì—­í• ë¡œ ì ‘ê·¼ | 403 ë°˜í™˜ â†’ Learner ëŒ€ì‹œë³´ë“œ(`/dashboard`)ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| ì½”ìŠ¤ëŠ” ìˆìœ¼ë‚˜ ê³¼ì œê°€ ì—†ëŠ” ê²½ìš° | í•´ë‹¹ ì½”ìŠ¤ì˜ ì±„ì  ëŒ€ê¸° ìˆ˜ 0ìœ¼ë¡œ í‘œì‹œ |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | FEì—ì„œ ì¬ì‹œë„ ìœ ë„ ë©”ì‹œì§€ í‘œì‹œ |
| ì„¸ì…˜ ë§Œë£Œ | 401 ë°˜í™˜ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |

---

## Business Rules

- ë‚´ ì½”ìŠ¤ ëª©ë¡ì€ `instructor_id = í˜„ì¬ ì‚¬ìš©ì`ì¸ ì½”ìŠ¤ë§Œ í‘œì‹œí•˜ë©°, status ë¬´ê´€í•˜ê²Œ ëª¨ë‘ í¬í•¨í•œë‹¤ (draft/published/archived).
- ì±„ì  ëŒ€ê¸° ìˆ˜ëŠ” `submissions.status = 'submitted'`ì¸ ê±´ìˆ˜ë§Œ ì§‘ê³„í•œë‹¤ (`graded`, `resubmission_required`ëŠ” ì œì™¸).
- ìµœê·¼ ì œì¶œë¬¼ì€ `submitted_at DESC` ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ë©°, ë‚´ ì½”ìŠ¤ì— ì†í•œ ì œì¶œë¬¼ë§Œ í‘œì‹œí•œë‹¤.
- ë‹¤ë¥¸ ê°•ì‚¬ì˜ ì½”ìŠ¤ ë°ì´í„°ëŠ” ì ˆëŒ€ ë…¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤ (BEì—ì„œ `instructor_id` í•„í„° í•„ìˆ˜).

---

## Sequence Diagram

```plantuml
@startuml

actor Instructor
participant FE
participant BE
database Database

Instructor -> FE: /instructor/dashboard ì ‘ê·¼
FE -> BE: GET /api/instructor/dashboard
BE -> Database: SELECT courses\nWHERE instructor_id = ?\nORDER BY created_at DESC
Database --> BE: ë‚´ ì½”ìŠ¤ ëª©ë¡ (ì „ì²´ status)

BE -> Database: SELECT assignment_id, COUNT(*) AS pending_count\nFROM submissions\nJOIN assignments ON submissions.assignment_id = assignments.id\nJOIN courses ON assignments.course_id = courses.id\nWHERE courses.instructor_id = ?\nAND submissions.status = 'submitted'\nGROUP BY courses.id
Database --> BE: ì½”ìŠ¤ë³„ ì±„ì  ëŒ€ê¸° ìˆ˜

BE -> Database: SELECT submissions.*, assignments.title, courses.title,\nprofiles.name AS learner_name\nFROM submissions\nJOIN assignments ON submissions.assignment_id = assignments.id\nJOIN courses ON assignments.course_id = courses.id\nJOIN profiles ON submissions.learner_id = profiles.id\nWHERE courses.instructor_id = ?\nORDER BY submitted_at DESC\nLIMIT 10
Database --> BE: ìµœê·¼ ì œì¶œë¬¼ ëª©ë¡

BE --> FE: 200 {courses, totalPendingCount, recentSubmissions}
FE -> Instructor: ëŒ€ì‹œë³´ë“œ ë Œë”ë§\n(ë‚´ ì½”ìŠ¤ + ì±„ì  ëŒ€ê¸° + ìµœê·¼ ì œì¶œë¬¼)

@enduml
```
</file>

<file path="008/spec.md">
# UC-008: ì½”ìŠ¤ ê´€ë¦¬ (Instructor)

## Primary Actor

Instructor (ì¸ì¦ëœ ê°•ì‚¬)

---

## Precondition

- ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `instructor`ì¸ ì‚¬ìš©ì
- ì˜¨ë³´ë”©ì´ ì™„ë£Œëœ ìƒíƒœ
- ì½”ìŠ¤ ìˆ˜ì •Â·ìƒíƒœ ì „í™˜ì˜ ê²½ìš°, í•´ë‹¹ ì½”ìŠ¤ì˜ `instructor_id`ê°€ í˜„ì¬ ì‚¬ìš©ìì™€ ì¼ì¹˜í•´ì•¼ í•œë‹¤

---

## Trigger

- ê°•ì‚¬ê°€ `/instructor/dashboard`ì—ì„œ "ì½”ìŠ¤ ë§Œë“¤ê¸°" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
- ê°•ì‚¬ê°€ ì½”ìŠ¤ ëª©ë¡ì—ì„œ íŠ¹ì • ì½”ìŠ¤ë¥¼ ì„ íƒí•˜ì—¬ ìˆ˜ì • í˜ì´ì§€ì— ì§„ì…í•œë‹¤.
- ê°•ì‚¬ê°€ ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€ì—ì„œ "ê³µê°œ" ë˜ëŠ” "ë³´ê´€" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.

---

## Main Scenario

### 8-1. ì½”ìŠ¤ ìƒì„±

1. ê°•ì‚¬ê°€ ì½”ìŠ¤ ìƒì„± í¼ì— ì ‘ê·¼í•œë‹¤ (`/instructor/courses/new`).
2. ê°•ì‚¬ê°€ ì œëª©(í•„ìˆ˜), ì†Œê°œ, ì¹´í…Œê³ ë¦¬, ë‚œì´ë„, ì»¤ë¦¬í˜ëŸ¼ì„ ì…ë ¥í•˜ê³  "ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
3. FEê°€ ì…ë ¥ê°’ì„ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ìœ íš¨ì„± ê²€ì‚¬í•œë‹¤ (ì œëª© í•„ìˆ˜ ì—¬ë¶€ ë“±).
4. FEê°€ `POST /api/instructor/courses`ë¥¼ í˜¸ì¶œí•œë‹¤.
5. BEê°€ ìš”ì²­ìì˜ `instructor_id`ë¥¼ ì„¸ì…˜ì—ì„œ ì¶”ì¶œí•˜ê³  ìš”ì²­ ë°”ë””ë¥¼ zod ìŠ¤í‚¤ë§ˆë¡œ ê²€ì¦í•œë‹¤.
6. BEê°€ `courses` í…Œì´ë¸”ì— `status = 'draft'`ë¡œ ë ˆì½”ë“œë¥¼ INSERTí•œë‹¤.
7. BEê°€ ìƒì„±ëœ ì½”ìŠ¤ ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤.
8. FEê°€ ì„±ê³µ í”¼ë“œë°±ì„ í‘œì‹œí•˜ê³  ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€(`/instructor/courses/:courseId`)ë¡œ ì´ë™í•œë‹¤.

### 8-2. ì½”ìŠ¤ ìˆ˜ì •

1. ê°•ì‚¬ê°€ ì½”ìŠ¤ ìƒì„¸ í¸ì§‘ í˜ì´ì§€ì— ì ‘ê·¼í•œë‹¤ (`/instructor/courses/:courseId/edit`).
2. FEê°€ í˜„ì¬ ì½”ìŠ¤ ì •ë³´ë¥¼ í¼ì— ì±„ì›Œ ë Œë”ë§í•œë‹¤.
3. ê°•ì‚¬ê°€ ìˆ˜ì •í•  í•„ë“œë¥¼ ë³€ê²½í•˜ê³  "ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
4. FEê°€ `PUT /api/instructor/courses/:courseId`ë¥¼ í˜¸ì¶œí•œë‹¤.
5. BEê°€ ì„¸ì…˜ì˜ `instructor_id`ì™€ ì½”ìŠ¤ì˜ `instructor_id`ë¥¼ ëŒ€ì¡°í•˜ì—¬ ì†Œìœ ê¶Œì„ ê²€ì¦í•œë‹¤.
6. ì†Œìœ ê¶Œ ê²€ì¦ ì‹¤íŒ¨ ì‹œ 403ì„ ë°˜í™˜í•œë‹¤.
7. BEê°€ ìš”ì²­ ë°”ë””ë¥¼ zod ìŠ¤í‚¤ë§ˆë¡œ ê²€ì¦í•œë‹¤.
8. BEê°€ `courses` í…Œì´ë¸”ì˜ í•´ë‹¹ ë ˆì½”ë“œë¥¼ UPDATEí•œë‹¤ (`updated_at`ì€ íŠ¸ë¦¬ê±°ë¡œ ìë™ ê°±ì‹ ).
9. BEê°€ ìˆ˜ì •ëœ ì½”ìŠ¤ ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤.
10. FEê°€ ì„±ê³µ í”¼ë“œë°±ì„ í‘œì‹œí•œë‹¤.

### 8-3. ì½”ìŠ¤ ìƒíƒœ ì „í™˜

1. ê°•ì‚¬ê°€ ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€ì—ì„œ ìƒíƒœ ì „í™˜ ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
   - `draft` ìƒíƒœ â†’ "ê³µê°œí•˜ê¸°" ë²„íŠ¼ â†’ `published` ì „í™˜
   - `published` ìƒíƒœ â†’ "ë³´ê´€í•˜ê¸°" ë²„íŠ¼ â†’ `archived` ì „í™˜
2. FEê°€ `PATCH /api/instructor/courses/:courseId/status`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ status: 'published' | 'archived' }`).
3. BEê°€ ì†Œìœ ê¶Œì„ ê²€ì¦í•œë‹¤ (403 ë°˜í™˜ ì¡°ê±´ ë™ì¼).
4. BEê°€ í˜„ì¬ ì½”ìŠ¤ statusë¥¼ ì¡°íšŒí•˜ì—¬ ì „í™˜ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ê²€ì¦í•œë‹¤.
   - í—ˆìš©: `draft â†’ published`, `published â†’ archived`
   - ë¶ˆí—ˆ: `archived â†’ *`, `published â†’ draft`, `draft â†’ archived`
5. ì „í™˜ ë¶ˆê°€ ìƒíƒœì˜ ê²½ìš° 400ì„ ë°˜í™˜í•œë‹¤.
6. BEê°€ `courses.status`ë¥¼ UPDATEí•œë‹¤.
7. BEê°€ ê°±ì‹ ëœ ì½”ìŠ¤ ìƒíƒœë¥¼ ë°˜í™˜í•œë‹¤.
8. FEê°€ ë²„íŠ¼ ìƒíƒœ ë° ë°°ì§€ë¥¼ ì¦‰ì‹œ ê°±ì‹ í•œë‹¤.

---

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| ì œëª© ëˆ„ë½ (í•„ìˆ˜ í•„ë“œ ë¯¸ì…ë ¥) | 400 ìœ íš¨ì„± ì˜¤ë¥˜ ë°˜í™˜ â†’ ì¸ë¼ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ |
| ë‹¤ë¥¸ ê°•ì‚¬ ì†Œìœ  ì½”ìŠ¤ì— ì ‘ê·¼ | 403 ë°˜í™˜ â†’ "ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤" ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ |
| ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì½”ìŠ¤ ID ì ‘ê·¼ | 404 ë°˜í™˜ â†’ ì˜¤ë¥˜ í˜ì´ì§€ í‘œì‹œ |
| `archived â†’ published` ë“± í—ˆìš©ë˜ì§€ ì•ŠëŠ” ìƒíƒœ ì „í™˜ ì‹œë„ | 400 ë°˜í™˜ â†’ "ì „í™˜í•  ìˆ˜ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤" ì•ˆë‚´ ë©”ì‹œì§€ |
| `published` ìƒíƒœ ì½”ìŠ¤ë¥¼ `draft`ë¡œ ë˜ëŒë¦¬ë ¤ëŠ” ì‹œë„ | 400 ë°˜í™˜ â†’ í—ˆìš©ë˜ì§€ ì•ŠëŠ” ì—­ë°©í–¥ ì „í™˜ì„ì„ ì•ˆë‚´ |
| ë¹„í™œì„±í™”ëœ `category_id` ë˜ëŠ” `difficulty_id` ì‚¬ìš© | 400 ë°˜í™˜ â†’ "ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì¹´í…Œê³ ë¦¬/ë‚œì´ë„ì…ë‹ˆë‹¤" ì•ˆë‚´ |
| ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì ì ‘ê·¼ | 401 ë°˜í™˜ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | FEì—ì„œ ì¬ì‹œë„ ìœ ë„ ë©”ì‹œì§€ í‘œì‹œ |

---

## Business Rules

- ì½”ìŠ¤ ìƒì„± ì‹œ ì´ˆê¸° statusëŠ” í•­ìƒ `draft`ì´ë‹¤.
- ìƒíƒœ ì „í™˜ì€ ë‹¨ë°©í–¥ì´ë‹¤: `draft â†’ published â†’ archived`. ì—­ë°©í–¥ ë˜ëŠ” ë‹¨ê³„ ê±´ë„ˆëœ€ì€ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `published` ìƒíƒœë¡œ ì „í™˜ ì‹œ í•™ìŠµìê°€ ì½”ìŠ¤ë¥¼ íƒìƒ‰í•˜ê³  ìˆ˜ê°•ì‹ ì²­í•  ìˆ˜ ìˆê²Œ ëœë‹¤.
- `archived` ìƒíƒœë¡œ ì „í™˜ ì‹œ ì‹ ê·œ ìˆ˜ê°•ì‹ ì²­ì´ ì°¨ë‹¨ë˜ë‚˜, ê¸°ì¡´ ìˆ˜ê°•ìì˜ ì ‘ê·¼ì€ ìœ ì§€ëœë‹¤.
- ì½”ìŠ¤ì˜ `instructor_id`ëŠ” ìƒì„± í›„ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤.
- `category_id`, `difficulty_id`ëŠ” ì„ íƒ í•­ëª©ì´ë©° NULLì„ í—ˆìš©í•œë‹¤.
- ì†Œìœ ê¶Œ ê²€ì¦ì€ BEì—ì„œ ë°˜ë“œì‹œ ìˆ˜í–‰í•˜ë©°, FE ë‹¨ë… ê²€ì¦ìœ¼ë¡œ ëŒ€ì²´í•  ìˆ˜ ì—†ë‹¤.

---

## Sequence Diagram

```plantuml
@startuml

actor Instructor
participant FE
participant BE
database Database

== ì½”ìŠ¤ ìƒì„± ==
Instructor -> FE: ì½”ìŠ¤ ìƒì„± í¼ ì œì¶œ\n(ì œëª©, ì†Œê°œ, ì¹´í…Œê³ ë¦¬, ë‚œì´ë„, ì»¤ë¦¬í˜ëŸ¼)
FE -> BE: POST /api/instructor/courses\n{title, description, categoryId, difficultyId, curriculum}
BE -> BE: ì„¸ì…˜ì—ì„œ instructor_id ì¶”ì¶œ\n+ zod ìŠ¤í‚¤ë§ˆ ìœ íš¨ì„± ê²€ì‚¬
BE -> Database: INSERT courses\n(instructor_id, title, ..., status='draft')
Database --> BE: ìƒì„±ëœ ì½”ìŠ¤ ë ˆì½”ë“œ
BE --> FE: 201 {course}
FE -> Instructor: ì„±ê³µ í”¼ë“œë°± + ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€ ì´ë™

== ì½”ìŠ¤ ìˆ˜ì • ==
Instructor -> FE: ìˆ˜ì • í¼ ì œì¶œ\n(ë³€ê²½ëœ í•„ë“œ)
FE -> BE: PUT /api/instructor/courses/:courseId\n{title, description, ...}
BE -> Database: SELECT courses WHERE id = ?
Database --> BE: ì½”ìŠ¤ ë ˆì½”ë“œ (instructor_id í¬í•¨)
BE -> BE: instructor_id ì†Œìœ ê¶Œ ê²€ì¦
alt ì†Œìœ ê¶Œ ë¶ˆì¼ì¹˜
  BE --> FE: 403 {error: "ê¶Œí•œ ì—†ìŒ"}
else ì†Œìœ ê¶Œ ì¼ì¹˜
  BE -> Database: UPDATE courses\nSET title=?, ..., updated_at=NOW()\nWHERE id = ?
  Database --> BE: ìˆ˜ì •ëœ ì½”ìŠ¤ ë ˆì½”ë“œ
  BE --> FE: 200 {course}
  FE -> Instructor: ì„±ê³µ í”¼ë“œë°± í‘œì‹œ
end

== ìƒíƒœ ì „í™˜ ==
Instructor -> FE: "ê³µê°œí•˜ê¸°" ë˜ëŠ” "ë³´ê´€í•˜ê¸°" í´ë¦­
FE -> BE: PATCH /api/instructor/courses/:courseId/status\n{status: 'published' | 'archived'}
BE -> Database: SELECT courses WHERE id = ?
Database --> BE: í˜„ì¬ ì½”ìŠ¤ (status, instructor_id í¬í•¨)
BE -> BE: ì†Œìœ ê¶Œ ê²€ì¦ + í—ˆìš© ìƒíƒœ ì „í™˜ ê²€ì¦
alt ê²€ì¦ ì‹¤íŒ¨
  BE --> FE: 400 ë˜ëŠ” 403 {error}
else ê²€ì¦ ì„±ê³µ
  BE -> Database: UPDATE courses SET status = ?\nWHERE id = ?
  Database --> BE: ê°±ì‹ ëœ ì½”ìŠ¤
  BE --> FE: 200 {course}
  FE -> Instructor: ë²„íŠ¼ ìƒíƒœ ë° ë°°ì§€ ê°±ì‹ 
end

@enduml
```
</file>

<file path="009/spec.md">
# UC-009: ê³¼ì œ ê´€ë¦¬ (Instructor)

## Primary Actor

Instructor (ì¸ì¦ëœ ê°•ì‚¬)

---

## Precondition

- ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `instructor`ì¸ ì‚¬ìš©ì
- ì˜¨ë³´ë”©ì´ ì™„ë£Œëœ ìƒíƒœ
- ê³¼ì œë¥¼ ìƒì„±Â·ìˆ˜ì •í•˜ë ¤ëŠ” ì½”ìŠ¤ì˜ `instructor_id`ê°€ í˜„ì¬ ì‚¬ìš©ìì™€ ì¼ì¹˜í•´ì•¼ í•œë‹¤

---

## Trigger

- ê°•ì‚¬ê°€ ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€ì—ì„œ "ê³¼ì œ ì¶”ê°€" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
- ê°•ì‚¬ê°€ ê³¼ì œ ëª©ë¡ì—ì„œ íŠ¹ì • ê³¼ì œë¥¼ ì„ íƒí•˜ì—¬ ìˆ˜ì • í˜ì´ì§€ì— ì§„ì…í•œë‹¤.
- ê°•ì‚¬ê°€ ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì—ì„œ "ê²Œì‹œ" ë˜ëŠ” "ë§ˆê°" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
- ê°•ì‚¬ê°€ ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì œì¶œë¬¼ ëª©ë¡ì„ ì¡°íšŒí•œë‹¤.

---

## Main Scenario

### 9-1. ê³¼ì œ ìƒì„±

1. ê°•ì‚¬ê°€ ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€ì—ì„œ "ê³¼ì œ ì¶”ê°€" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
2. ê°•ì‚¬ê°€ ê³¼ì œ ìƒì„± í¼ì— ì œëª©(í•„ìˆ˜), ì„¤ëª…, ë§ˆê°ì¼(í•„ìˆ˜), ì ìˆ˜ ë¹„ì¤‘(í•„ìˆ˜, >0), ì§€ê° í—ˆìš© ì—¬ë¶€, ì¬ì œì¶œ í—ˆìš© ì—¬ë¶€ë¥¼ ì…ë ¥í•œë‹¤.
3. FEê°€ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•œë‹¤.
4. FEê°€ `POST /api/instructor/courses/:courseId/assignments`ë¥¼ í˜¸ì¶œí•œë‹¤.
5. BEê°€ ì„¸ì…˜ì˜ `instructor_id`ì™€ í•´ë‹¹ ì½”ìŠ¤ì˜ `instructor_id`ë¥¼ ëŒ€ì¡°í•˜ì—¬ ì†Œìœ ê¶Œì„ ê²€ì¦í•œë‹¤.
6. ì†Œìœ ê¶Œ ê²€ì¦ ì‹¤íŒ¨ ì‹œ 403ì„ ë°˜í™˜í•œë‹¤.
7. BEê°€ ìš”ì²­ ë°”ë””ë¥¼ zod ìŠ¤í‚¤ë§ˆë¡œ ê²€ì¦í•œë‹¤ (`title` í•„ìˆ˜, `due_at` í•„ìˆ˜, `weight > 0` í•„ìˆ˜).
8. BEê°€ `assignments` í…Œì´ë¸”ì— `status = 'draft'`ë¡œ ë ˆì½”ë“œë¥¼ INSERTí•œë‹¤.
9. BEê°€ ìƒì„±ëœ ê³¼ì œ ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤.
10. FEê°€ ì„±ê³µ í”¼ë“œë°±ì„ í‘œì‹œí•˜ê³  ê³¼ì œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤.

### 9-2. ê³¼ì œ ìˆ˜ì •

1. ê°•ì‚¬ê°€ ê³¼ì œ ìˆ˜ì • í˜ì´ì§€ì— ì ‘ê·¼í•œë‹¤ (`/instructor/assignments/:assignmentId/edit`).
2. FEê°€ í˜„ì¬ ê³¼ì œ ì •ë³´ë¥¼ í¼ì— ì±„ì›Œ ë Œë”ë§í•œë‹¤.
3. ê°•ì‚¬ê°€ ìˆ˜ì •í•  í•„ë“œë¥¼ ë³€ê²½í•˜ê³  "ì €ì¥" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
4. FEê°€ `PUT /api/instructor/assignments/:assignmentId`ë¥¼ í˜¸ì¶œí•œë‹¤.
5. BEê°€ í•´ë‹¹ ê³¼ì œë¥¼ ì¡°íšŒí•˜ê³ , ê³¼ì œê°€ ì†í•œ ì½”ìŠ¤ì˜ `instructor_id`ì™€ ì„¸ì…˜ ì‚¬ìš©ìë¥¼ ëŒ€ì¡°í•˜ì—¬ ì†Œìœ ê¶Œì„ ê²€ì¦í•œë‹¤.
6. ì†Œìœ ê¶Œ ê²€ì¦ ì‹¤íŒ¨ ì‹œ 403ì„ ë°˜í™˜í•œë‹¤.
7. BEê°€ ìš”ì²­ ë°”ë””ë¥¼ zod ìŠ¤í‚¤ë§ˆë¡œ ê²€ì¦í•œë‹¤.
8. BEê°€ `assignments` í…Œì´ë¸”ì˜ í•´ë‹¹ ë ˆì½”ë“œë¥¼ UPDATEí•œë‹¤ (`updated_at`ì€ íŠ¸ë¦¬ê±°ë¡œ ìë™ ê°±ì‹ ).
9. BEê°€ ìˆ˜ì •ëœ ê³¼ì œ ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤.
10. FEê°€ ì„±ê³µ í”¼ë“œë°±ì„ í‘œì‹œí•œë‹¤.

### 9-3. ê³¼ì œ ìƒíƒœ ì „í™˜

1. ê°•ì‚¬ê°€ ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì—ì„œ ìƒíƒœ ì „í™˜ ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
   - `draft` ìƒíƒœ â†’ "ê²Œì‹œí•˜ê¸°" ë²„íŠ¼ â†’ `published` ì „í™˜ (í•™ìŠµìì—ê²Œ ë…¸ì¶œ)
   - `published` ìƒíƒœ â†’ "ìˆ˜ë™ ë§ˆê°" ë²„íŠ¼ â†’ `closed` ì „í™˜
2. FEê°€ `PATCH /api/instructor/assignments/:assignmentId/status`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ status: 'published' | 'closed' }`).
3. BEê°€ ì†Œìœ ê¶Œì„ ê²€ì¦í•˜ê³  í—ˆìš© ìƒíƒœ ì „í™˜ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.
   - í—ˆìš©: `draft â†’ published`, `published â†’ closed`
   - ë¶ˆí—ˆ: `closed â†’ *`, `published â†’ draft`, `draft â†’ closed`
4. ì „í™˜ ë¶ˆê°€ ìƒíƒœì˜ ê²½ìš° 400ì„ ë°˜í™˜í•œë‹¤.
5. BEê°€ `assignments.status`ë¥¼ UPDATEí•œë‹¤.
6. FEê°€ ë²„íŠ¼ ìƒíƒœë¥¼ ì¦‰ì‹œ ê°±ì‹ í•œë‹¤.

### 9-4. ì œì¶œë¬¼ ëª©ë¡ ì¡°íšŒ ë° í•„í„°ë§

1. ê°•ì‚¬ê°€ ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì—ì„œ "ì œì¶œë¬¼" íƒ­ì— ì ‘ê·¼í•œë‹¤.
2. FEê°€ `GET /api/instructor/assignments/:assignmentId/submissions`ë¥¼ í˜¸ì¶œí•œë‹¤ (í•„í„° íŒŒë¼ë¯¸í„° í¬í•¨).
3. BEê°€ ì†Œìœ ê¶Œì„ ê²€ì¦í•œë‹¤ (ê³¼ì œê°€ ì†í•œ ì½”ìŠ¤ì˜ `instructor_id` ëŒ€ì¡°).
4. BEê°€ í•„í„° íŒŒë¼ë¯¸í„°ì— ë”°ë¼ ì¿¼ë¦¬ë¥¼ êµ¬ì„±í•œë‹¤.
   - í•„í„° ì—†ìŒ: ì „ì²´ ì œì¶œë¬¼ ë°˜í™˜
   - `filter=pending`: `status = 'submitted'` (ë¯¸ì±„ì )
   - `filter=late`: `is_late = true`
   - `filter=resubmission`: `status = 'resubmission_required'`
5. BEê°€ í•„í„°ë§ëœ ì œì¶œë¬¼ ëª©ë¡ì„ `submitted_at DESC` ê¸°ì¤€ìœ¼ë¡œ ë°˜í™˜í•œë‹¤.
6. FEê°€ ì œì¶œë¬¼ í…Œì´ë¸”ì„ ë Œë”ë§í•œë‹¤ (í•™ìŠµìëª…, ì œì¶œ ì‹œê°, ì§€ê° ì—¬ë¶€, ìƒíƒœ, ì ìˆ˜).

---

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| ì œëª©Â·ë§ˆê°ì¼Â·ì ìˆ˜ ë¹„ì¤‘ ë“± í•„ìˆ˜ í•„ë“œ ëˆ„ë½ | 400 ìœ íš¨ì„± ì˜¤ë¥˜ ë°˜í™˜ â†’ ì¸ë¼ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ |
| `weight <= 0` ì…ë ¥ | 400 ë°˜í™˜ â†’ "ì ìˆ˜ ë¹„ì¤‘ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤" ì•ˆë‚´ |
| ë‹¤ë¥¸ ê°•ì‚¬ ì†Œìœ  ì½”ìŠ¤ì˜ ê³¼ì œì— ì ‘ê·¼ | 403 ë°˜í™˜ â†’ "ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤" ì•ˆë‚´ |
| ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³¼ì œ ID ì ‘ê·¼ | 404 ë°˜í™˜ â†’ ì˜¤ë¥˜ í˜ì´ì§€ í‘œì‹œ |
| `closed â†’ published` ë“± í—ˆìš©ë˜ì§€ ì•ŠëŠ” ìƒíƒœ ì „í™˜ ì‹œë„ | 400 ë°˜í™˜ â†’ "ì „í™˜í•  ìˆ˜ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤" ì•ˆë‚´ |
| `published` ìƒíƒœì—ì„œ ë§ˆê°ì¼ì´ ì´ë¯¸ ì§€ë‚œ ê²½ìš° (ìœ íš¨ ë§ˆê°) | BEì—ì„œ `NOW() > due_at` ì¡°ê±´ì„ ìœ íš¨ ë§ˆê°ìœ¼ë¡œ íŒë³„, FEì—ì„œ ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™” |
| ì œì¶œë¬¼ ëª©ë¡ì—ì„œ ìœ íš¨í•˜ì§€ ì•Šì€ í•„í„° íŒŒë¼ë¯¸í„° | 400 ë°˜í™˜ â†’ í—ˆìš© í•„í„°ê°’ ëª©ë¡ ì•ˆë‚´ |
| ê³¼ì œì— ì œì¶œë¬¼ì´ ì—†ëŠ” ê²½ìš° | ë¹ˆ ëª©ë¡ ë°˜í™˜ ë° "ì œì¶œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤" ë¹ˆ ìƒíƒœ í‘œì‹œ |
| ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì ì ‘ê·¼ | 401 ë°˜í™˜ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |

---

## Business Rules

- ê³¼ì œ ìƒì„± ì‹œ ì´ˆê¸° statusëŠ” í•­ìƒ `draft`ì´ë‹¤.
- ìƒíƒœ ì „í™˜ì€ ë‹¨ë°©í–¥ì´ë‹¤: `draft â†’ published â†’ closed`. ì—­ë°©í–¥ ë˜ëŠ” ë‹¨ê³„ ê±´ë„ˆëœ€ì€ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `published` ìƒíƒœë¡œ ì „í™˜ ì‹œ í•™ìŠµìê°€ ê³¼ì œë¥¼ ì—´ëŒí•˜ê³  ì œì¶œí•  ìˆ˜ ìˆê²Œ ëœë‹¤.
- ìœ íš¨ ë§ˆê° íŒë³„ ë¡œì§: `status = 'closed'` OR (`status = 'published'` AND `NOW() > due_at`). DB `status = 'closed'`ëŠ” ê°•ì‚¬ ìˆ˜ë™ ê°•ì œ ë§ˆê° ì „ìš©ì´ë©°, ì¼ë°˜ ë§ˆê°ì€ `due_at` ë¹„êµë¡œ íŒë³„í•œë‹¤.
- `weight`ëŠ” ì–‘ìˆ˜(> 0)ì—¬ì•¼ í•˜ë©°, ì„±ì  ê³„ì‚° ì‹œ ë¹„ì¤‘ìœ¼ë¡œ í™œìš©ëœë‹¤.
- ê³¼ì œ ì†Œìœ ê¶Œ ê²€ì¦ì€ ê³¼ì œ â†’ ì½”ìŠ¤ â†’ `instructor_id` ì²´ì¸ìœ¼ë¡œ ë°˜ë“œì‹œ BEì—ì„œ ìˆ˜í–‰í•œë‹¤.
- ì œì¶œë¬¼ ì¡°íšŒ í•„í„°: `pending`(ë¯¸ì±„ì ), `late`(ì§€ê°), `resubmission`(ì¬ì œì¶œ ìš”ì²­) ì„¸ ê°€ì§€ë¥¼ ì§€ì›í•˜ë©° ë³µìˆ˜ ì ìš©ì€ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì±„ì ì´ ì™„ë£Œëœ(`status = 'graded'`) ê³¼ì œì— ì¬ì œì¶œì´ í•„ìš”í•œ ê²½ìš° `status = 'resubmission_required'`ë¡œ ì „í™˜í•˜ë©°, í•™ìŠµìëŠ” ì¬ì œì¶œ í›„ `status = 'submitted'`ë¡œ ë˜ëŒì•„ê°„ë‹¤.

---

## Sequence Diagram

```plantuml
@startuml

actor Instructor
participant FE
participant BE
database Database

== ê³¼ì œ ìƒì„± ==
Instructor -> FE: ê³¼ì œ ìƒì„± í¼ ì œì¶œ\n(ì œëª©, ì„¤ëª…, ë§ˆê°ì¼, ì ìˆ˜ ë¹„ì¤‘, ì •ì±…)
FE -> BE: POST /api/instructor/courses/:courseId/assignments\n{title, description, dueAt, weight, allowLate, allowResubmit}
BE -> Database: SELECT courses WHERE id = ?
Database --> BE: ì½”ìŠ¤ ë ˆì½”ë“œ (instructor_id í¬í•¨)
BE -> BE: instructor_id ì†Œìœ ê¶Œ ê²€ì¦\n+ zod ìŠ¤í‚¤ë§ˆ ìœ íš¨ì„± ê²€ì‚¬
alt ê²€ì¦ ì‹¤íŒ¨
  BE --> FE: 400 ë˜ëŠ” 403 {error}
else ê²€ì¦ ì„±ê³µ
  BE -> Database: INSERT assignments\n(course_id, title, ..., status='draft')
  Database --> BE: ìƒì„±ëœ ê³¼ì œ ë ˆì½”ë“œ
  BE --> FE: 201 {assignment}
  FE -> Instructor: ì„±ê³µ í”¼ë“œë°± + ê³¼ì œ ìƒì„¸ ì´ë™
end

== ê³¼ì œ ìˆ˜ì • ==
Instructor -> FE: ìˆ˜ì • í¼ ì œì¶œ
FE -> BE: PUT /api/instructor/assignments/:assignmentId\n{title, description, dueAt, weight, ...}
BE -> Database: SELECT assignments JOIN courses\nWHERE assignments.id = ?
Database --> BE: ê³¼ì œ + ì½”ìŠ¤ ë ˆì½”ë“œ
BE -> BE: instructor_id ì†Œìœ ê¶Œ ê²€ì¦
alt ì†Œìœ ê¶Œ ë¶ˆì¼ì¹˜
  BE --> FE: 403 {error: "ê¶Œí•œ ì—†ìŒ"}
else ì†Œìœ ê¶Œ ì¼ì¹˜
  BE -> Database: UPDATE assignments\nSET title=?, ..., updated_at=NOW()
  Database --> BE: ìˆ˜ì •ëœ ê³¼ì œ ë ˆì½”ë“œ
  BE --> FE: 200 {assignment}
  FE -> Instructor: ì„±ê³µ í”¼ë“œë°± í‘œì‹œ
end

== ê³¼ì œ ìƒíƒœ ì „í™˜ ==
Instructor -> FE: "ê²Œì‹œí•˜ê¸°" ë˜ëŠ” "ìˆ˜ë™ ë§ˆê°" í´ë¦­
FE -> BE: PATCH /api/instructor/assignments/:assignmentId/status\n{status: 'published' | 'closed'}
BE -> Database: SELECT assignments JOIN courses\nWHERE assignments.id = ?
Database --> BE: ê³¼ì œ + ì½”ìŠ¤ (í˜„ì¬ status í¬í•¨)
BE -> BE: ì†Œìœ ê¶Œ ê²€ì¦ + í—ˆìš© ìƒíƒœ ì „í™˜ ê²€ì¦
alt ê²€ì¦ ì‹¤íŒ¨
  BE --> FE: 400 ë˜ëŠ” 403 {error}
else ê²€ì¦ ì„±ê³µ
  BE -> Database: UPDATE assignments SET status = ?\nWHERE id = ?
  Database --> BE: ê°±ì‹ ëœ ê³¼ì œ
  BE --> FE: 200 {assignment}
  FE -> Instructor: ë²„íŠ¼ ìƒíƒœ ê°±ì‹ 
end

== ì œì¶œë¬¼ ëª©ë¡ ì¡°íšŒ ==
Instructor -> FE: ì œì¶œë¬¼ íƒ­ ì ‘ê·¼\n(í•„í„°: pending | late | resubmission)
FE -> BE: GET /api/instructor/assignments/:assignmentId/submissions\n?filter=pending
BE -> Database: SELECT assignments JOIN courses\nWHERE assignments.id = ?
Database --> BE: ì†Œìœ ê¶Œ í™•ì¸ìš© ì½”ìŠ¤ ë ˆì½”ë“œ
BE -> BE: instructor_id ì†Œìœ ê¶Œ ê²€ì¦
BE -> Database: SELECT submissions JOIN profiles\nWHERE assignment_id = ?\nAND status = 'submitted' (í•„í„° ì ìš©)\nORDER BY submitted_at DESC
Database --> BE: í•„í„°ë§ëœ ì œì¶œë¬¼ ëª©ë¡
BE --> FE: 200 {submissions, totalCount}
FE -> Instructor: ì œì¶œë¬¼ í…Œì´ë¸” ë Œë”ë§\n(í•™ìŠµìëª…, ì œì¶œ ì‹œê°, ì§€ê° ì—¬ë¶€, ìƒíƒœ, ì ìˆ˜)

@enduml
```
</file>

<file path="010/spec.md">
# UC-010: ì œì¶œë¬¼ ì±„ì  & í”¼ë“œë°±

## Primary Actor

Instructor (ì¸ì¦ëœ ê°•ì‚¬)

---

## Precondition

- ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `instructor`ì¸ ì‚¬ìš©ì
- ì±„ì  ëŒ€ìƒ ê³¼ì œ(`assignments`)ê°€ ìì‹ ì´ ì†Œìœ í•œ ì½”ìŠ¤ì— ì†í•´ ìˆìŒ
- ì±„ì  ëŒ€ìƒ ì œì¶œë¬¼(`submissions`)ì˜ `status`ê°€ `submitted` ë˜ëŠ” `resubmission_required` ìƒíƒœ

---

## Trigger

ê°•ì‚¬ê°€ Instructor ëŒ€ì‹œë³´ë“œ ë˜ëŠ” ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì—ì„œ íŠ¹ì • ì œì¶œë¬¼ì„ ì„ íƒí•˜ì—¬ ì±„ì  í™”ë©´ì— ì§„ì…í•œë‹¤.

---

## Main Scenario

1. ê°•ì‚¬ê°€ ê³¼ì œ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì œì¶œë¬¼ ëª©ë¡ì„ í™•ì¸í•œë‹¤.
2. FEê°€ `GET /api/instructor/assignments/:assignmentId/submissions`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì œì¶œë¬¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¨ë‹¤.
3. BEê°€ í•´ë‹¹ ê³¼ì œì— ì†í•œ ì œì¶œë¬¼ ëª©ë¡ (learner ì •ë³´, ì œì¶œ ì‹œê°, í˜„ì¬ status í¬í•¨)ì„ ë°˜í™˜í•œë‹¤.
4. ê°•ì‚¬ê°€ íŠ¹ì • ì œì¶œë¬¼ì„ ì„ íƒí•œë‹¤.
5. FEê°€ ì œì¶œë¬¼ ìƒì„¸(content_text, content_link, submitted_at, ê¸°ì¡´ í”¼ë“œë°± ë“±)ë¥¼ ë Œë”ë§í•œë‹¤.

### 10-1. ì ìˆ˜ ì±„ì  (graded)

6a. ê°•ì‚¬ê°€ ì ìˆ˜(0~100)ì™€ í”¼ë“œë°± í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•œ í›„ "ì±„ì  ì™„ë£Œ" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
7a. FEê°€ `PATCH /api/instructor/submissions/:submissionId/grade`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ score, feedback }`).
8a. BEê°€ ìš”ì²­ì„ ê²€ì¦í•œë‹¤.
   - `score`ê°€ 0~100 ì •ìˆ˜ ë²”ìœ„ì¸ì§€ í™•ì¸
   - `feedback`ì´ ë¹„ì–´ ìˆì§€ ì•Šì€ì§€ í™•ì¸
   - `submission.assignment.course`ê°€ ìš”ì²­ ê°•ì‚¬ ì†Œìœ ì¸ì§€ í™•ì¸
9a. BEê°€ `submissions` ë ˆì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤ (`status = 'graded'`, `score = score`, `feedback = feedback`, `graded_at = NOW()`).
10a. BEê°€ ì„±ê³µ ì‘ë‹µì„ ë°˜í™˜í•œë‹¤.
11a. FEê°€ ì„±ê³µ í† ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•˜ê³  ì œì¶œë¬¼ ëª©ë¡ì˜ statusë¥¼ ê°±ì‹ í•œë‹¤.

### 10-2. ì¬ì œì¶œ ìš”ì²­ (resubmission_required)

6b. ê°•ì‚¬ê°€ í”¼ë“œë°± í…ìŠ¤íŠ¸ë§Œ ì…ë ¥í•œ í›„ "ì¬ì œì¶œ ìš”ì²­" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
7b. FEê°€ `PATCH /api/instructor/submissions/:submissionId/request-resubmission`ì„ í˜¸ì¶œí•œë‹¤ (`{ feedback }`).
8b. BEê°€ ìš”ì²­ì„ ê²€ì¦í•œë‹¤.
   - `feedback`ì´ ë¹„ì–´ ìˆì§€ ì•Šì€ì§€ í™•ì¸
   - `submission.assignment.course`ê°€ ìš”ì²­ ê°•ì‚¬ ì†Œìœ ì¸ì§€ í™•ì¸
   - ê³¼ì œì˜ `allow_resubmit = true` ì—¬ë¶€ í™•ì¸
9b. BEê°€ `submissions` ë ˆì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤ (`status = 'resubmission_required'`, `feedback = feedback`, `score = NULL`).
10b. BEê°€ ì„±ê³µ ì‘ë‹µì„ ë°˜í™˜í•œë‹¤.
11b. FEê°€ ì„±ê³µ í† ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•˜ê³  ì œì¶œë¬¼ ëª©ë¡ì˜ statusë¥¼ ê°±ì‹ í•œë‹¤.
12b. Learner ëŒ€ì‹œë³´ë“œì˜ í•´ë‹¹ ê³¼ì œ ìƒíƒœê°€ `resubmission_required`ë¡œ ë°˜ì˜ëœë‹¤.

---

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| ì ìˆ˜ê°€ 0~100 ë²”ìœ„ë¥¼ ë²—ì–´ë‚¨ | 400 ë°˜í™˜ â†’ FE ì…ë ¥ í•„ë“œ ì¸ë¼ì¸ ì˜¤ë¥˜ í‘œì‹œ |
| í”¼ë“œë°±ì´ ë¹ˆ ë¬¸ìì—´ | 400 ë°˜í™˜ â†’ "í”¼ë“œë°±ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”" ì•ˆë‚´ ë©”ì‹œì§€ |
| ìš”ì²­ ê°•ì‚¬ê°€ í•´ë‹¹ ì½”ìŠ¤ ì†Œìœ ìê°€ ì•„ë‹˜ | 403 ë°˜í™˜ â†’ ê¶Œí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ |
| ì´ë¯¸ `graded` ìƒíƒœì¸ ì œì¶œë¬¼ì— ì¬ì±„ì  ì‹œë„ | 200 í—ˆìš© (ë®ì–´ì“°ê¸°) â€” graded_atì„ ìµœì‹ ìœ¼ë¡œ ê°±ì‹  |
| `allow_resubmit = false` ê³¼ì œì— ì¬ì œì¶œ ìš”ì²­ ì‹œë„ | 400 ë°˜í™˜ â†’ "ì¬ì œì¶œì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ” ê³¼ì œì…ë‹ˆë‹¤" ë©”ì‹œì§€ |
| ì œì¶œë¬¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ | 404 ë°˜í™˜ â†’ FEì—ì„œ ì˜¤ë¥˜ í˜ì´ì§€ í‘œì‹œ |
| ê³¼ì œê°€ `closed` ë˜ëŠ” ìë™ ë§ˆê° ìƒíƒœì—ì„œ ì±„ì  ì‹œë„ | ì±„ì ì€ í—ˆìš© (ë§ˆê° í›„ ì±„ì  ê°€ëŠ¥), ì œì¶œë§Œ ë¶ˆê°€ |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | FEì—ì„œ ì¬ì‹œë„ ìœ ë„ ë©”ì‹œì§€ í‘œì‹œ |

---

## Business Rules

- ì±„ì  ì‹œ `score`(0~100 ì •ìˆ˜)ì™€ `feedback`ì€ ëª¨ë‘ í•„ìˆ˜ì´ë‹¤.
- ì¬ì œì¶œ ìš”ì²­ ì‹œ `score`ëŠ” ì €ì¥í•˜ì§€ ì•Šìœ¼ë©° (`score = NULL`), `feedback`ë§Œ í•„ìˆ˜ì´ë‹¤.
- ì±„ì  ì™„ë£Œ ì‹œ `graded_at = NOW()`ë¡œ ì±„ì  ì‹œê°ì„ ê¸°ë¡í•œë‹¤.
- ì¬ì œì¶œ ìš”ì²­ì€ ê³¼ì œì˜ `allow_resubmit = true`ì¸ ê²½ìš°ì—ë§Œ í—ˆìš©í•œë‹¤.
- ê°•ì‚¬ëŠ” ìì‹ ì´ ì†Œìœ í•œ ì½”ìŠ¤ì˜ ê³¼ì œ ì œì¶œë¬¼ë§Œ ì±„ì í•  ìˆ˜ ìˆë‹¤.
- ì´ë¯¸ ì±„ì ëœ(`graded`) ì œì¶œë¬¼ì„ ì¬ì±„ì í•˜ëŠ” ê²ƒì€ í—ˆìš©í•˜ë©°, ì´ì „ ì ìˆ˜ì™€ í”¼ë“œë°±ì€ ë®ì–´ì“´ë‹¤.
- ì±„ì  ê²°ê³¼ëŠ” Learner ëŒ€ì‹œë³´ë“œì˜ ê³¼ì œ ìƒíƒœ ë° ìµœê·¼ í”¼ë“œë°± ì„¹ì…˜ì— ì¦‰ì‹œ ë°˜ì˜ëœë‹¤.

---

## Sequence Diagram

```plantuml
@startuml

actor Instructor
participant FE
participant BE
database Database

Instructor -> FE: ê³¼ì œ ì œì¶œë¬¼ ëª©ë¡ ì ‘ê·¼
FE -> BE: GET /api/instructor/assignments/:assignmentId/submissions
BE -> Database: SELECT submissions\nJOIN profiles (learner)\nWHERE assignment_id = ?
Database --> BE: ì œì¶œë¬¼ ëª©ë¡ (status, submitted_at í¬í•¨)
BE --> FE: 200 {submissions}
FE -> Instructor: ì œì¶œë¬¼ ëª©ë¡ ë Œë”ë§

Instructor -> FE: ì œì¶œë¬¼ ì„ íƒ

group 10-1. ì ìˆ˜ ì±„ì 
  Instructor -> FE: score + feedback ì…ë ¥ í›„ "ì±„ì  ì™„ë£Œ" í´ë¦­
  FE -> BE: PATCH /api/instructor/submissions/:submissionId/grade\n{score, feedback}
  BE -> Database: SELECT submissions\nJOIN assignments JOIN courses\nWHERE id = :submissionId
  Database --> BE: ì œì¶œë¬¼ + ê³¼ì œ + ì½”ìŠ¤ ì†Œìœ ì ì •ë³´
  BE -> BE: ê¶Œí•œ í™•ì¸ (course.instructor_id == ìš”ì²­ì)
  BE -> BE: ìœ íš¨ì„± ê²€ì¦ (score ë²”ìœ„, feedback í•„ìˆ˜)
  BE -> Database: UPDATE submissions\nSET status='graded', score=?, feedback=?,\ngraded_at=NOW()\nWHERE id = :submissionId
  Database --> BE: ì—…ë°ì´íŠ¸ ì™„ë£Œ
  BE --> FE: 200 {submission}
  FE -> Instructor: ì±„ì  ì™„ë£Œ í† ìŠ¤íŠ¸ + ëª©ë¡ status ê°±ì‹ 
end

group 10-2. ì¬ì œì¶œ ìš”ì²­
  Instructor -> FE: feedback ì…ë ¥ í›„ "ì¬ì œì¶œ ìš”ì²­" í´ë¦­
  FE -> BE: PATCH /api/instructor/submissions/:submissionId/request-resubmission\n{feedback}
  BE -> Database: SELECT submissions\nJOIN assignments JOIN courses\nWHERE id = :submissionId
  Database --> BE: ì œì¶œë¬¼ + ê³¼ì œ (allow_resubmit í¬í•¨) + ì½”ìŠ¤ ì •ë³´
  BE -> BE: ê¶Œí•œ í™•ì¸ (course.instructor_id == ìš”ì²­ì)
  BE -> BE: allow_resubmit = true í™•ì¸
  BE -> BE: feedback í•„ìˆ˜ ê²€ì¦
  BE -> Database: UPDATE submissions\nSET status='resubmission_required',\nfeedback=?, score=NULL\nWHERE id = :submissionId
  Database --> BE: ì—…ë°ì´íŠ¸ ì™„ë£Œ
  BE --> FE: 200 {submission}
  FE -> Instructor: ì¬ì œì¶œ ìš”ì²­ ì™„ë£Œ í† ìŠ¤íŠ¸ + ëª©ë¡ status ê°±ì‹ 
end

@enduml
```
</file>

<file path="011/spec.md">
# UC-011: Assignment ê²Œì‹œ/ë§ˆê°

## Primary Actor

Instructor (ì¸ì¦ëœ ê°•ì‚¬)

---

## Precondition

- ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `instructor`ì¸ ì‚¬ìš©ì
- ëŒ€ìƒ ê³¼ì œ(`assignments`)ê°€ ìì‹ ì´ ì†Œìœ í•œ ì½”ìŠ¤ì— ì†í•´ ìˆìŒ
- ê²Œì‹œ ì „í™˜ ì‹œ: ê³¼ì œì˜ í˜„ì¬ `status`ê°€ `draft`
- ìˆ˜ë™ ë§ˆê° ì‹œ: ê³¼ì œì˜ í˜„ì¬ `status`ê°€ `published`

---

## Trigger

ê°•ì‚¬ê°€ Instructor ëŒ€ì‹œë³´ë“œ ë˜ëŠ” ê³¼ì œ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ê³¼ì œì˜ ìƒíƒœë¥¼ ë³€ê²½í•œë‹¤.

---

## ìœ íš¨ ìƒíƒœ (Effective Status) ì •ì˜

DBì˜ `status` ì»¬ëŸ¼ ê°’ê³¼ ë³„ë„ë¡œ, í´ë¼ì´ì–¸íŠ¸ ë° API ì‘ë‹µì—ì„œ `effective_status`ë¥¼ ê³„ì‚°í•˜ì—¬ ì‚¬ìš©í•œë‹¤.

| DB status | ì¡°ê±´ | effective_status | ì„¤ëª… |
|---|---|---|---|
| `closed` | (ë¬´ì¡°ê±´) | `closed` | ê°•ì‚¬ ìˆ˜ë™ ë§ˆê°, ì œì¶œ ë¶ˆê°€ |
| `published` | `NOW() > due_at` AND `allow_late = false` | `closed` | ìë™ ë§ˆê°, ì œì¶œ ë¶ˆê°€ |
| `published` | `NOW() > due_at` AND `allow_late = true` | `overdue` | ì§€ê° ì œì¶œ í—ˆìš© ì¤‘, ì œì¶œ ê°€ëŠ¥ (`is_late = true` ì²˜ë¦¬) |
| `published` | `NOW() <= due_at` | `published` | ì§„í–‰ ì¤‘, ì œì¶œ ê°€ëŠ¥ |
| `draft` | (ë¬´ì¡°ê±´) | `draft` | ë¯¸ê²Œì‹œ, í•™ìŠµì ë¹„ë…¸ì¶œ |

- `effective_status = 'closed'`ì´ë©´ í•™ìŠµìì˜ ì‹ ê·œ ì œì¶œì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
- `effective_status = 'overdue'`ì´ë©´ ì œì¶œì€ ê°€ëŠ¥í•˜ë˜ `is_late = true`ë¡œ ê¸°ë¡ëœë‹¤.
- `effective_status = 'closed'` ë˜ëŠ” `overdue`ì´ë”ë¼ë„ ê°•ì‚¬ì˜ ì±„ì ì€ í—ˆìš©ëœë‹¤.

---

## Main Scenario

### 11-1. ê³¼ì œ ê²Œì‹œ (draft â†’ published)

1. ê°•ì‚¬ê°€ ê³¼ì œ ëª©ë¡ì—ì„œ `draft` ìƒíƒœì¸ ê³¼ì œë¥¼ ì„ íƒí•œë‹¤.
2. FEê°€ `GET /api/instructor/assignments/:assignmentId`ë¥¼ í˜¸ì¶œí•˜ì—¬ ê³¼ì œ ìƒì„¸ ë° `effective_status`ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.
3. BEê°€ `effective_status`ë¥¼ ê³„ì‚°í•˜ì—¬ ì‘ë‹µì— í¬í•¨ì‹œí‚¨ë‹¤.
4. ê°•ì‚¬ê°€ "ê²Œì‹œ" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
5. FEê°€ `PATCH /api/instructor/assignments/:assignmentId/status`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ status: 'published' }`).
6. BEê°€ ìš”ì²­ì„ ê²€ì¦í•œë‹¤.
   - ìš”ì²­ ê°•ì‚¬ê°€ í•´ë‹¹ ì½”ìŠ¤ì˜ ì†Œìœ ìì¸ì§€ í™•ì¸
   - í˜„ì¬ DB `status`ê°€ `draft`ì¸ì§€ í™•ì¸ (`published` ë˜ëŠ” `closed`ë¡œì˜ ì¤‘ë³µ ê²Œì‹œ ì°¨ë‹¨)
7. BEê°€ `assignments` ë ˆì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤ (`status = 'published'`).
8. BEê°€ ì„±ê³µ ì‘ë‹µì„ ë°˜í™˜í•œë‹¤ (`effective_status` í¬í•¨).
9. FEê°€ ì„±ê³µ í† ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•˜ê³  ê³¼ì œ ìƒíƒœ ë±ƒì§€ë¥¼ `published`ë¡œ ê°±ì‹ í•œë‹¤.
10. í•™ìŠµìì˜ ì½”ìŠ¤ ìƒì„¸ ë° ëŒ€ì‹œë³´ë“œì— í•´ë‹¹ ê³¼ì œê°€ ë…¸ì¶œëœë‹¤.

### 11-2. ê³¼ì œ ìˆ˜ë™ ë§ˆê° (published â†’ closed)

1. ê°•ì‚¬ê°€ ê³¼ì œ ëª©ë¡ì—ì„œ `published` ìƒíƒœì¸ ê³¼ì œë¥¼ ì„ íƒí•œë‹¤.
2. FEê°€ `GET /api/instructor/assignments/:assignmentId`ë¥¼ í˜¸ì¶œí•˜ì—¬ ê³¼ì œ ìƒì„¸ ë° `effective_status`ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.
3. ê°•ì‚¬ê°€ "ë§ˆê°" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
4. FEê°€ ë§ˆê° í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ í‘œì‹œí•œë‹¤ ("ë§ˆê° í›„ í•™ìŠµì ì œì¶œì´ ë¶ˆê°€í•©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?").
5. ê°•ì‚¬ê°€ í™•ì¸ì„ í´ë¦­í•œë‹¤.
6. FEê°€ `PATCH /api/instructor/assignments/:assignmentId/status`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ status: 'closed' }`).
7. BEê°€ ìš”ì²­ì„ ê²€ì¦í•œë‹¤.
   - ìš”ì²­ ê°•ì‚¬ê°€ í•´ë‹¹ ì½”ìŠ¤ì˜ ì†Œìœ ìì¸ì§€ í™•ì¸
   - í˜„ì¬ DB `status`ê°€ `published`ì¸ì§€ í™•ì¸
8. BEê°€ `assignments` ë ˆì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤ (`status = 'closed'`).
9. BEê°€ ì„±ê³µ ì‘ë‹µì„ ë°˜í™˜í•œë‹¤ (`effective_status = 'closed'` í¬í•¨).
10. FEê°€ ì„±ê³µ í† ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•˜ê³  ê³¼ì œ ìƒíƒœ ë±ƒì§€ë¥¼ `closed`ë¡œ ê°±ì‹ í•œë‹¤.
11. ì´í›„ í•™ìŠµìì˜ ì œì¶œ ì‹œë„ëŠ” ì°¨ë‹¨ë˜ë©°, ê°•ì‚¬ì˜ ì±„ì ì€ ê³„ì† í—ˆìš©ëœë‹¤.

---

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| ì´ë¯¸ `published` ìƒíƒœì¸ ê³¼ì œì— ê²Œì‹œ ìš”ì²­ | 400 ë°˜í™˜ â†’ "ì´ë¯¸ ê²Œì‹œëœ ê³¼ì œì…ë‹ˆë‹¤" ë©”ì‹œì§€ |
| `draft` ìƒíƒœì¸ ê³¼ì œì— ë§ˆê° ìš”ì²­ | 400 ë°˜í™˜ â†’ "ê²Œì‹œëœ ê³¼ì œë§Œ ë§ˆê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€ |
| ìš”ì²­ ê°•ì‚¬ê°€ í•´ë‹¹ ì½”ìŠ¤ ì†Œìœ ìê°€ ì•„ë‹˜ | 403 ë°˜í™˜ â†’ ê¶Œí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ |
| ê³¼ì œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŒ | 404 ë°˜í™˜ â†’ FEì—ì„œ ì˜¤ë¥˜ í˜ì´ì§€ í‘œì‹œ |
| ìë™ ë§ˆê°(`due_at` ì´ˆê³¼) ìƒíƒœì—ì„œ ìˆ˜ë™ ë§ˆê° ì¬ì‹œë„ | DB `status`ëŠ” ì—¬ì „íˆ `published`ì´ë¯€ë¡œ ìˆ˜ë™ ë§ˆê° í—ˆìš© â†’ `closed`ë¡œ ê°±ì‹  |
| ë§ˆê°ëœ ê³¼ì œì— í•™ìŠµìê°€ ì œì¶œ ì‹œë„ | ì œì¶œ APIì—ì„œ `effective_status` í™•ì¸ í›„ 400 ë°˜í™˜ â†’ "ë§ˆê°ëœ ê³¼ì œì…ë‹ˆë‹¤" ë©”ì‹œì§€ |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | FEì—ì„œ ì¬ì‹œë„ ìœ ë„ ë©”ì‹œì§€ í‘œì‹œ |

---

## Business Rules

- ê³¼ì œì˜ ìƒíƒœ ì „í™˜ì€ `draft â†’ published â†’ closed` ë‹¨ë°©í–¥ì´ë‹¤. ì—­ë°©í–¥ ì „í™˜(`closed â†’ published` ë“±)ì€ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `effective_status`ëŠ” DB `status`ì™€ `due_at`ì„ ì¡°í•©í•˜ì—¬ ì„œë²„ì—ì„œ ê³„ì‚°í•˜ë©°, í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ UIë¥¼ ë Œë”ë§í•œë‹¤.
- `effective_status = 'closed'`ì¸ ê³¼ì œëŠ” í•™ìŠµìì˜ ì‹ ê·œ ì œì¶œì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
- `effective_status = 'overdue'`ì¸ ê³¼ì œëŠ” ì§€ê° ì œì¶œì´ í—ˆìš©(`allow_late = true`)ë˜ë©°, ì œì¶œ ì‹œ `is_late = true`ë¡œ ê¸°ë¡ëœë‹¤.
- `effective_status = 'closed'` ë˜ëŠ” `overdue`ì´ë”ë¼ë„ ê°•ì‚¬ëŠ” ê¸°ì¡´ ì œì¶œë¬¼ì— ëŒ€í•œ ì±„ì  ë° í”¼ë“œë°±ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
- `published` ìƒíƒœì˜ ê³¼ì œë§Œ í•™ìŠµì ëŒ€ì‹œë³´ë“œ ë° ì½”ìŠ¤ ìƒì„¸ì— ë…¸ì¶œëœë‹¤.
- ê°•ì‚¬ëŠ” ìì‹ ì´ ì†Œìœ í•œ ì½”ìŠ¤ì˜ ê³¼ì œë§Œ ìƒíƒœë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
- ìˆ˜ë™ ë§ˆê°(`closed`)ì€ `due_at` ë„ë‹¬ ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ ì¦‰ì‹œ ì ìš©ëœë‹¤.

---

## Sequence Diagram

```plantuml
@startuml

actor Instructor
participant FE
participant BE
database Database

Instructor -> FE: ê³¼ì œ ê´€ë¦¬ í˜ì´ì§€ ì ‘ê·¼
FE -> BE: GET /api/instructor/assignments/:assignmentId
BE -> Database: SELECT assignments\nWHERE id = :assignmentId
Database --> BE: ê³¼ì œ ì •ë³´ (status, due_at í¬í•¨)
BE -> BE: effective_status ê³„ì‚°\n(status='closed' OR\n(status='published' AND NOW()>due_at)\nâ†’ 'closed', ê·¸ ì™¸ status ê°’)
BE --> FE: 200 {assignment, effective_status}
FE -> Instructor: ê³¼ì œ ìƒì„¸ + ìƒíƒœ ë±ƒì§€ ë Œë”ë§

group 11-1. ê³¼ì œ ê²Œì‹œ (draft â†’ published)
  Instructor -> FE: "ê²Œì‹œ" ë²„íŠ¼ í´ë¦­
  FE -> BE: PATCH /api/instructor/assignments/:assignmentId/status\n{status: 'published'}
  BE -> Database: SELECT assignments JOIN courses\nWHERE id = :assignmentId
  Database --> BE: ê³¼ì œ + ì½”ìŠ¤ ì†Œìœ ì ì •ë³´
  BE -> BE: ê¶Œí•œ í™•ì¸ (course.instructor_id == ìš”ì²­ì)
  BE -> BE: í˜„ì¬ DB status = 'draft' ê²€ì¦
  BE -> Database: UPDATE assignments\nSET status = 'published'\nWHERE id = :assignmentId
  Database --> BE: ì—…ë°ì´íŠ¸ ì™„ë£Œ
  BE -> BE: effective_status ì¬ê³„ì‚°
  BE --> FE: 200 {assignment, effective_status: 'published'}
  FE -> Instructor: ê²Œì‹œ ì™„ë£Œ í† ìŠ¤íŠ¸ + ìƒíƒœ ë±ƒì§€ ê°±ì‹ 
end

group 11-2. ê³¼ì œ ìˆ˜ë™ ë§ˆê° (published â†’ closed)
  Instructor -> FE: "ë§ˆê°" ë²„íŠ¼ í´ë¦­
  FE -> Instructor: ë§ˆê° í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
  Instructor -> FE: í™•ì¸ í´ë¦­
  FE -> BE: PATCH /api/instructor/assignments/:assignmentId/status\n{status: 'closed'}
  BE -> Database: SELECT assignments JOIN courses\nWHERE id = :assignmentId
  Database --> BE: ê³¼ì œ + ì½”ìŠ¤ ì†Œìœ ì ì •ë³´
  BE -> BE: ê¶Œí•œ í™•ì¸ (course.instructor_id == ìš”ì²­ì)
  BE -> BE: í˜„ì¬ DB status = 'published' ê²€ì¦
  BE -> Database: UPDATE assignments\nSET status = 'closed'\nWHERE id = :assignmentId
  Database --> BE: ì—…ë°ì´íŠ¸ ì™„ë£Œ
  BE --> FE: 200 {assignment, effective_status: 'closed'}
  FE -> Instructor: ë§ˆê° ì™„ë£Œ í† ìŠ¤íŠ¸ + ìƒíƒœ ë±ƒì§€ ê°±ì‹ 
end

@enduml
```
</file>

<file path="012/spec.md">
# UC-012: ìš´ì˜ (Operator)

## Primary Actor

- ì‹ ê³  ì ‘ìˆ˜(12-1): Learner ë˜ëŠ” Instructor (ì¸ì¦ëœ ëª¨ë“  ì‚¬ìš©ì)
- ì‹ ê³  ì²˜ë¦¬(12-2): Operator (ìš´ì˜ì)
- ë©”íƒ€ë°ì´í„° ê´€ë¦¬(12-3): Operator (ìš´ì˜ì)

---

## Precondition

- 12-1 ì‹ ê³  ì ‘ìˆ˜: ë¡œê·¸ì¸ ìƒíƒœì¸ ì‚¬ìš©ì (ì—­í•  ë¬´ê´€)
- 12-2 ì‹ ê³  ì²˜ë¦¬: ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `operator`ì¸ ì‚¬ìš©ì
- 12-3 ë©”íƒ€ë°ì´í„° ê´€ë¦¬: ë¡œê·¸ì¸ ìƒíƒœì´ë©° ì—­í• ì´ `operator`ì¸ ì‚¬ìš©ì

---

## Trigger

- 12-1: ì‚¬ìš©ìê°€ ì½”ìŠ¤/ê³¼ì œ/ì œì¶œë¬¼/ë‹¤ë¥¸ ì‚¬ìš©ìì— ëŒ€í•´ ì‹ ê³  ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
- 12-2: ìš´ì˜ìê°€ ì‹ ê³  ê´€ë¦¬ ëŒ€ì‹œë³´ë“œì—ì„œ ì‹ ê³  ëª©ë¡ì„ í™•ì¸í•˜ê³  ì²˜ë¦¬í•œë‹¤.
- 12-3: ìš´ì˜ìê°€ ë©”íƒ€ë°ì´í„° ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ì¹´í…Œê³ ë¦¬ ë˜ëŠ” ë‚œì´ë„ë¥¼ ìƒì„±Â·ìˆ˜ì •Â·ë¹„í™œì„±í™”í•œë‹¤.

---

## Main Scenario

### 12-1. ì‹ ê³  ì ‘ìˆ˜

1. ì‚¬ìš©ìê°€ ì½”ìŠ¤/ê³¼ì œ/ì œì¶œë¬¼/ì‚¬ìš©ì ìƒì„¸ í˜ì´ì§€ì—ì„œ "ì‹ ê³ " ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
2. FEê°€ ì‹ ê³  ëª¨ë‹¬ì„ í‘œì‹œí•œë‹¤ (ì‹ ê³  ì‚¬ìœ  ì„ íƒ + ìƒì„¸ ë‚´ìš© ì…ë ¥).
3. ì‚¬ìš©ìê°€ `reason`(ì‹ ê³  ìœ í˜•)ê³¼ `content`(ìƒì„¸ ë‚´ìš©)ë¥¼ ì…ë ¥í•˜ê³  ì œì¶œí•œë‹¤.
4. FEê°€ `POST /api/reports`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ target_type, target_id, reason, content }`).
5. BEê°€ ìš”ì²­ì„ ê²€ì¦í•œë‹¤.
   - `target_type`ì´ `course | assignment | submission | user` ì¤‘ í•˜ë‚˜ì¸ì§€ í™•ì¸
   - `reason`ê³¼ `content`ê°€ ë¹„ì–´ ìˆì§€ ì•Šì€ì§€ í™•ì¸
   - `target_id`ì— í•´ë‹¹í•˜ëŠ” ëŒ€ìƒì´ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
6. BEê°€ `reports` ë ˆì½”ë“œë¥¼ ìƒì„±í•œë‹¤ (`status = 'received'`, `reporter_id = ìš”ì²­ ì‚¬ìš©ì id`).
7. BEê°€ ì„±ê³µ ì‘ë‹µì„ ë°˜í™˜í•œë‹¤.
8. FEê°€ "ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤" í† ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•˜ê³  ëª¨ë‹¬ì„ ë‹«ëŠ”ë‹¤.

### 12-2. ì‹ ê³  ì²˜ë¦¬

1. ìš´ì˜ìê°€ ì‹ ê³  ê´€ë¦¬ ëŒ€ì‹œë³´ë“œì— ì ‘ê·¼í•œë‹¤.
2. FEê°€ `GET /api/operator/reports`ë¥¼ í˜¸ì¶œí•œë‹¤ (status í•„í„°, ì •ë ¬ íŒŒë¼ë¯¸í„° í¬í•¨).
3. BEê°€ ìš´ì˜ì ê¶Œí•œì„ í™•ì¸í•œ í›„ ì‹ ê³  ëª©ë¡ì„ ë°˜í™˜í•œë‹¤.
4. ìš´ì˜ìê°€ íŠ¹ì • ì‹ ê³ ë¥¼ ì„ íƒí•˜ì—¬ ìƒì„¸ ë‚´ìš©ì„ í™•ì¸í•œë‹¤.
5. ìš´ì˜ìê°€ ì‹ ê³  ì²˜ë¦¬ ìƒíƒœë¥¼ `investigating`ìœ¼ë¡œ ë³€ê²½í•œë‹¤.
6. FEê°€ `PATCH /api/operator/reports/:reportId`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ status: 'investigating' }`).
7. BEê°€ `reports` ë ˆì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.
8. ìš´ì˜ìê°€ ì¡°ì‚¬ë¥¼ ì™„ë£Œí•˜ê³  ì²˜ë¦¬ ì•¡ì…˜ì„ ê²°ì •í•œë‹¤.
9. ìš´ì˜ìê°€ ì²˜ë¦¬ ë‚´ìš©(`status: 'resolved'`, `action`)ì„ ì…ë ¥í•˜ê³  "ì²˜ë¦¬ ì™„ë£Œ" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
10. FEê°€ `PATCH /api/operator/reports/:reportId`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ status: 'resolved', action }`).
11. BEê°€ `reports` ë ˆì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤ (`status = 'resolved'`, `action = action`).
12. ì„ íƒëœ ì•¡ì…˜ì— ë”°ë¼ í›„ì† ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•œë‹¤.
    - `warning`: ëŒ€ìƒ ì‚¬ìš©ìì—ê²Œ ê²½ê³  ì²˜ë¦¬ (profiles ë˜ëŠ” ë³„ë„ ê²½ê³  ë¡œê·¸)
    - `invalidate_submission`: í•´ë‹¹ `submission`ì˜ `status`ë¥¼ ë¬´íš¨í™” ì²˜ë¦¬
    - `restrict_account`: í•´ë‹¹ ì‚¬ìš©ì ê³„ì • ì ‘ê·¼ ì œí•œ ì²˜ë¦¬
13. BEê°€ ì„±ê³µ ì‘ë‹µì„ ë°˜í™˜í•œë‹¤.
14. FEê°€ ì‹ ê³  ëª©ë¡ì˜ ìƒíƒœë¥¼ ê°±ì‹ í•œë‹¤.

### 12-3. ë©”íƒ€ë°ì´í„° ê´€ë¦¬ (ì¹´í…Œê³ ë¦¬ & ë‚œì´ë„ CRUD)

1. ìš´ì˜ìê°€ ë©”íƒ€ë°ì´í„° ê´€ë¦¬ í˜ì´ì§€ì— ì ‘ê·¼í•œë‹¤.
2. FEê°€ `GET /api/operator/categories`ì™€ `GET /api/operator/difficulties`ë¥¼ ë³‘ë ¬ë¡œ í˜¸ì¶œí•œë‹¤.
3. BEê°€ ìš´ì˜ì ê¶Œí•œì„ í™•ì¸í•œ í›„ ì „ì²´ ëª©ë¡(`is_active` í¬í•¨)ì„ ë°˜í™˜í•œë‹¤.
4. FEê°€ ì¹´í…Œê³ ë¦¬/ë‚œì´ë„ ëª©ë¡ì„ í…Œì´ë¸”ë¡œ ë Œë”ë§í•œë‹¤.

**ìƒì„±:**
5a. ìš´ì˜ìê°€ ìƒˆ ì´ë¦„ì„ ì…ë ¥í•˜ê³  "ì¶”ê°€" ë²„íŠ¼ì„ í´ë¦­í•œë‹¤.
6a. FEê°€ `POST /api/operator/categories` ë˜ëŠ” `POST /api/operator/difficulties`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ name }`).
7a. BEê°€ ì´ë¦„ ì¤‘ë³µ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤.
8a. BEê°€ ìƒˆ ë ˆì½”ë“œë¥¼ ìƒì„±í•œë‹¤ (`is_active = true`).
9a. FEê°€ ëª©ë¡ì„ ê°±ì‹ í•œë‹¤.

**ìˆ˜ì • (ì´ë¦„ ë³€ê²½ ë˜ëŠ” í™œì„±í™” ìƒíƒœ ë³€ê²½):**
5b. ìš´ì˜ìê°€ í•­ëª©ì„ ì„ íƒí•˜ê³  ì´ë¦„ì„ ìˆ˜ì •í•˜ê±°ë‚˜ `is_active` í† ê¸€ì„ ë³€ê²½í•œë‹¤.
6b. FEê°€ `PATCH /api/operator/categories/:id` ë˜ëŠ” `PATCH /api/operator/difficulties/:id`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ name?, is_active? }`).
7b. BEê°€ ì´ë¦„ ì¤‘ë³µ ì—¬ë¶€ë¥¼ í™•ì¸í•œë‹¤(ì´ë¦„ ë³€ê²½ ì‹œ).
8b. BEê°€ ë ˆì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤.
9b. FEê°€ ëª©ë¡ì„ ê°±ì‹ í•œë‹¤.

**ë¹„í™œì„±í™” (ì‚­ì œ ëŒ€ì‹ ):**
5c. ìš´ì˜ìê°€ í˜„ì¬ ì½”ìŠ¤ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ì¹´í…Œê³ ë¦¬/ë‚œì´ë„ì˜ `is_active` í† ê¸€ì„ ëˆë‹¤.
6c. FEê°€ ë¹„í™œì„±í™” í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ í‘œì‹œí•œë‹¤ ("ì‚¬ìš© ì¤‘ì¸ í•­ëª©ì…ë‹ˆë‹¤. ì‹ ê·œ ì½”ìŠ¤ì—ì„œ ì„ íƒ ë¶ˆê°€í•©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?").
7c. FEê°€ `PATCH /api/operator/categories/:id`ë¥¼ í˜¸ì¶œí•œë‹¤ (`{ is_active: false }`).
8c. BEê°€ ë ˆì½”ë“œë¥¼ ì—…ë°ì´íŠ¸í•œë‹¤ (`is_active = false`).
9c. ê¸°ì¡´ì— í•´ë‹¹ ê°’ì„ ì‚¬ìš©í•˜ëŠ” ì½”ìŠ¤ì—ëŠ” ì˜í–¥ ì—†ìŒ. ì‹ ê·œ ì½”ìŠ¤ ìƒì„± ì‹œ ì„ íƒ ëª©ë¡ì—ì„œ ì œì™¸ëœë‹¤.

---

## Edge Cases

| ìƒí™© | ì²˜ë¦¬ |
|---|---|
| ì‹ ê³  ëŒ€ìƒ(`target_id`)ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ | 404 ë°˜í™˜ â†’ "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ëŒ€ìƒì…ë‹ˆë‹¤" ë©”ì‹œì§€ |
| `reason` ë˜ëŠ” `content`ê°€ ë¹ˆ ê°’ìœ¼ë¡œ ì‹ ê³  ì œì¶œ | 400 ë°˜í™˜ â†’ FE ì…ë ¥ í•„ë“œ ì¸ë¼ì¸ ì˜¤ë¥˜ í‘œì‹œ |
| ë™ì¼í•œ ì‚¬ìš©ìê°€ ë™ì¼ ëŒ€ìƒì„ ì¤‘ë³µ ì‹ ê³  | í—ˆìš© (ì¤‘ë³µ ì‹ ê³  ìì²´ë¥¼ ì°¨ë‹¨í•˜ì§€ ì•ŠìŒ â€” ìš´ì˜ìê°€ íŒë‹¨) |
| Operatorê°€ ì•„ë‹Œ ì—­í• ë¡œ ì‹ ê³  ì²˜ë¦¬ API ì ‘ê·¼ | 403 ë°˜í™˜ â†’ ê¶Œí•œ ì˜¤ë¥˜ ë©”ì‹œì§€ |
| `received` ìƒíƒœ ì‹ ê³ ë¥¼ `investigating` ê±´ë„ˆë›°ê³  `resolved`ë¡œ ì§ì ‘ ë³€ê²½ | í—ˆìš© (ë‹¨ê³„ ê°•ì œ ì—†ìŒ, ìš´ì˜ì ì¬ëŸ‰) |
| ì´ë¯¸ `resolved`ëœ ì‹ ê³ ì— ì¬ì²˜ë¦¬ ì‹œë„ | 400 ë°˜í™˜ â†’ "ì´ë¯¸ ì²˜ë¦¬ ì™„ë£Œëœ ì‹ ê³ ì…ë‹ˆë‹¤" ë©”ì‹œì§€ |
| ì¹´í…Œê³ ë¦¬/ë‚œì´ë„ ì´ë¦„ ì¤‘ë³µ ìƒì„± ì‹œë„ | 409 ë°˜í™˜ â†’ "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë¦„ì…ë‹ˆë‹¤" ë©”ì‹œì§€ |
| ì‚¬ìš© ì¤‘ì¸ ì¹´í…Œê³ ë¦¬/ë‚œì´ë„ ë¹„í™œì„±í™” | ë¹„í™œì„±í™” í—ˆìš© (ê¸°ì¡´ ì½”ìŠ¤ ë°ì´í„° ë³´ì¡´), FEì—ì„œ ê²½ê³  ì•ˆë‚´ í›„ ì§„í–‰ |
| `invalidate_submission` ì•¡ì…˜ ëŒ€ìƒ ì œì¶œë¬¼ì´ ì´ë¯¸ ë¬´íš¨í™” ìƒíƒœ | ë©±ë“± ì²˜ë¦¬ (ì¬ì²˜ë¦¬ ì‹œ ë™ì¼ ê²°ê³¼, ì˜¤ë¥˜ ì—†ìŒ) |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | FEì—ì„œ ì¬ì‹œë„ ìœ ë„ ë©”ì‹œì§€ í‘œì‹œ |

---

## Business Rules

- ì‹ ê³  ì ‘ìˆ˜ëŠ” ì¸ì¦ëœ ëª¨ë“  ì—­í• (Learner, Instructor, Operator)ì´ ê°€ëŠ¥í•˜ë‹¤.
- ì‹ ê³  ì²˜ë¦¬(`GET/PATCH /api/operator/*`) ë° ë©”íƒ€ë°ì´í„° ê´€ë¦¬ëŠ” `operator` ì—­í• ë§Œ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
- ì‹ ê³  ìƒíƒœëŠ” `received â†’ investigating â†’ resolved` ìˆœì„œë¥¼ ê¶Œì¥í•˜ë‚˜ ë‹¨ê³„ ê°•ì œëŠ” ì—†ë‹¤.
- ì‹ ê³  ì²˜ë¦¬ ì•¡ì…˜ì€ `warning | invalidate_submission | restrict_account` ì¤‘ í•˜ë‚˜ì´ë©°, `resolved` ìƒíƒœì¼ ë•Œë§Œ ì•¡ì…˜ì„ ê¸°ë¡í•œë‹¤.
- `action = null`ì¸ `resolved` ìƒíƒœë„ í—ˆìš©í•œë‹¤ (ì¡°ì‚¬ ê²°ê³¼ ë¬´í˜ì˜ ì²˜ë¦¬ ê°€ëŠ¥).
- ì¹´í…Œê³ ë¦¬/ë‚œì´ë„ëŠ” ë¬¼ë¦¬ì ìœ¼ë¡œ ì‚­ì œí•˜ì§€ ì•Šìœ¼ë©° `is_active = false`ë¡œ ë¹„í™œì„±í™”í•œë‹¤.
- `is_active = false`ì¸ í•­ëª©ì€ ì½”ìŠ¤ ìƒì„±/ìˆ˜ì • ì‹œ ì„ íƒ ë¶ˆê°€í•˜ì§€ë§Œ, ê¸°ì¡´ ì½”ìŠ¤ì˜ ë°ì´í„°ëŠ” ìœ ì§€ëœë‹¤.
- ì¹´í…Œê³ ë¦¬/ë‚œì´ë„ì˜ `name`ì€ UNIQUE ì œì•½ì´ ìˆì–´ ì¤‘ë³µ ì´ë¦„ ìƒì„±/ìˆ˜ì •ì´ ë¶ˆê°€í•˜ë‹¤.

> **ìŠ¤í‚¤ë§ˆ ì¶”ê°€ í•„ìš” (êµ¬í˜„ ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”):**
> - `warning` ì•¡ì…˜ ì²˜ë¦¬ë¥¼ ìœ„í•œ `warnings` í…Œì´ë¸” (user_id, report_id, warned_at) â€” í˜„ì¬ DB ìŠ¤í‚¤ë§ˆ ë¯¸í¬í•¨
> - `restrict_account` ì•¡ì…˜ ì²˜ë¦¬ë¥¼ ìœ„í•œ `profiles.is_active` ì»¬ëŸ¼ â€” í˜„ì¬ DB ìŠ¤í‚¤ë§ˆ ë¯¸í¬í•¨
> - `invalidate_submission` ì•¡ì…˜ì€ í˜„ì¬ `submission_status` ENUMì— ë³„ë„ `invalidated` ê°’ì´ ì—†ìœ¼ë¯€ë¡œ, `score = NULL`, `status = 'submitted'`ë¡œ ì´ˆê¸°í™”í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜ ENUM í™•ì¥ì´ í•„ìš”í•˜ë‹¤.

---

## Sequence Diagram

```plantuml
@startuml

actor User as "User\n(Learner/Instructor)"
actor Operator
participant FE
participant BE
database Database

group 12-1. ì‹ ê³  ì ‘ìˆ˜
  User -> FE: "ì‹ ê³ " ë²„íŠ¼ í´ë¦­
  FE -> User: ì‹ ê³  ëª¨ë‹¬ í‘œì‹œ\n(target_type, reason, content ì…ë ¥)
  User -> FE: ì‹ ê³  ë‚´ìš© ì…ë ¥ í›„ ì œì¶œ
  FE -> BE: POST /api/reports\n{target_type, target_id, reason, content}
  BE -> BE: ì…ë ¥ê°’ ìœ íš¨ì„± ê²€ì¦\n(target_type enum, reason/content í•„ìˆ˜)
  BE -> Database: SELECT [target í…Œì´ë¸”]\nWHERE id = :target_id
  Database --> BE: ëŒ€ìƒ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
  BE -> Database: INSERT reports\n(reporter_id, target_type, target_id,\nreason, content, status='received')
  Database --> BE: ì €ì¥ ì™„ë£Œ
  BE --> FE: 201 {reportId}
  FE -> User: "ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤" í† ìŠ¤íŠ¸
end

group 12-2. ì‹ ê³  ì²˜ë¦¬
  Operator -> FE: ì‹ ê³  ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ ì ‘ê·¼
  FE -> BE: GET /api/operator/reports\n?status=&sort=
  BE -> BE: operator ê¶Œí•œ í™•ì¸
  BE -> Database: SELECT reports\nORDER BY created_at DESC
  Database --> BE: ì‹ ê³  ëª©ë¡
  BE --> FE: 200 {reports}
  FE -> Operator: ì‹ ê³  ëª©ë¡ ë Œë”ë§

  Operator -> FE: ì‹ ê³  ì„ íƒ + "ì¡°ì‚¬ ì¤‘" ìƒíƒœë¡œ ë³€ê²½
  FE -> BE: PATCH /api/operator/reports/:reportId\n{status: 'investigating'}
  BE -> Database: UPDATE reports\nSET status='investigating'
  Database --> BE: ì—…ë°ì´íŠ¸ ì™„ë£Œ
  BE --> FE: 200 {report}

  Operator -> FE: ì²˜ë¦¬ ì™„ë£Œ + action ì„ íƒ
  FE -> BE: PATCH /api/operator/reports/:reportId\n{status: 'resolved', action}
  BE -> Database: UPDATE reports\nSET status='resolved', action=?
  Database --> BE: ì—…ë°ì´íŠ¸ ì™„ë£Œ

  alt action = 'invalidate_submission'
    note over BE: score=NULL, status='submitted' ì´ˆê¸°í™”\n(ë³„ë„ invalidated ìƒíƒœ ë¯¸ì§€ì› â€” ì¶”í›„ ENUM í™•ì¥ í•„ìš”)
    BE -> Database: UPDATE submissions\nSET status='submitted', score=NULL, feedback=NULL\nWHERE id = report.target_id
  else action = 'restrict_account'
    note over BE: profiles.is_active ì»¬ëŸ¼ ì¶”ê°€ ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”
    BE -> Database: UPDATE profiles\nSET is_active=false\nWHERE id = report.target_id
  else action = 'warning'
    note over BE: warnings í…Œì´ë¸” ì¶”ê°€ ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”
    BE -> Database: INSERT warnings\n(user_id, report_id, warned_at)
  end

  Database --> BE: ì²˜ë¦¬ ì™„ë£Œ
  BE --> FE: 200 {report}
  FE -> Operator: ì²˜ë¦¬ ì™„ë£Œ í† ìŠ¤íŠ¸ + ëª©ë¡ ê°±ì‹ 
end

group 12-3. ë©”íƒ€ë°ì´í„° ê´€ë¦¬
  Operator -> FE: ë©”íƒ€ë°ì´í„° ê´€ë¦¬ í˜ì´ì§€ ì ‘ê·¼
  FE -> BE: GET /api/operator/categories
  FE -> BE: GET /api/operator/difficulties
  BE -> BE: operator ê¶Œí•œ í™•ì¸
  BE -> Database: SELECT categories\nSELECT difficulties
  Database --> BE: ì „ì²´ ëª©ë¡ (is_active í¬í•¨)
  BE --> FE: 200 {categories}\n200 {difficulties}
  FE -> Operator: ëª©ë¡ í…Œì´ë¸” ë Œë”ë§

  alt ìƒì„±
    Operator -> FE: ìƒˆ ì´ë¦„ ì…ë ¥ + "ì¶”ê°€" í´ë¦­
    FE -> BE: POST /api/operator/categories\n{name}
    BE -> Database: INSERT categories\n(name, is_active=true)
    Database --> BE: ì €ì¥ ì™„ë£Œ
    BE --> FE: 201 {category}
  else ìˆ˜ì • / ë¹„í™œì„±í™”
    Operator -> FE: í•­ëª© ì´ë¦„ ìˆ˜ì • ë˜ëŠ” is_active í† ê¸€
    FE -> BE: PATCH /api/operator/categories/:id\n{name?, is_active?}
    BE -> Database: UPDATE categories\nSET name=?, is_active=?\nWHERE id = :id
    Database --> BE: ì—…ë°ì´íŠ¸ ì™„ë£Œ
    BE --> FE: 200 {category}
  end

  FE -> Operator: ëª©ë¡ ê°±ì‹ 
end

@enduml
```
</file>

<file path="database.md">
# Database Design

> ê¸°ë°˜ ë¬¸ì„œ: `prd.md`, `workflow.md`
> ìœ ì €í”Œë¡œìš°ì— ëª…ì‹œì ìœ¼ë¡œ í¬í•¨ëœ ë°ì´í„°ë§Œ í¬í•¨í•œë‹¤.
> DBMS: PostgreSQL (via Supabase)

---

## 1. ë°ì´í„° í”Œë¡œìš° (Database ê´€ì )

```
[1. ì˜¨ë³´ë”©]
  Supabase auth.users (INSERT)
    â†’ profiles     (INSERT: name, phone, role)
    â†’ terms_agreements (INSERT: user_id, agreed_at)

[2. ì½”ìŠ¤ íƒìƒ‰]
  courses (READ: status = 'published')
    â† categories  JOIN (ì¹´í…Œê³ ë¦¬ í•„í„°)
    â† difficulties JOIN (ë‚œì´ë„ í•„í„°)

[3. ìˆ˜ê°•ì‹ ì²­ / ìˆ˜ê°•ì·¨ì†Œ]
  courses     (READ: status ê²€ì¦)
    â†’ enrollments (UPSERT: ON CONFLICT(course_id, learner_id)
                    ê¸°ë¡ ì—†ìŒ          â†’ INSERT
                    cancelled_at IS NOT NULL â†’ UPDATE SET cancelled_at = NULL, enrolled_at = NOW()
                    cancelled_at IS NULL     â†’ ì—ëŸ¬ (ì´ë¯¸ ìˆ˜ê°• ì¤‘))  â† ì‹ ì²­/ì¬ì‹ ì²­
    â†’ enrollments (UPDATE: cancelled_at = NOW())                    â† ì·¨ì†Œ

[4. Learner ëŒ€ì‹œë³´ë“œ]
  enrollments (WHERE cancelled_at IS NULL)
    â†’ courses     (ë‚´ ì½”ìŠ¤ ëª©ë¡)
    â†’ assignments (ë§ˆê° ì„ë°•, ORDER BY due_at ASC)
    â†’ submissions (ìµœê·¼ í”¼ë“œë°±, WHERE status = 'graded')
  COMPUTE ì§„í–‰ë¥ :
    - ë¶„ì: COUNT(submissions WHERE status != 'resubmission_required')
    - ë¶„ëª¨: COUNT(assignments WHERE status = 'published' AND course_id = ?)

[5. ê³¼ì œ ì—´ëŒ]
  enrollments (READ: ìˆ˜ê°• ì—¬ë¶€ ê²€ì¦)
  assignments (READ: status = 'published')

[6. ê³¼ì œ ì œì¶œ / ì¬ì œì¶œ]
  assignments (READ: due_at, allow_late, allow_resubmit, status ê²€ì¦)
    â†’ submissions (INSERT: content_text, content_link, is_late, status = 'submitted')
    â†’ submissions (UPDATE: content ê°±ì‹ , status = 'submitted')  â† ì¬ì œì¶œ

[7. ì„±ì  & í”¼ë“œë°±]
  submissions JOIN assignments (READ: WHERE learner_id = ?)
  COMPUTE í˜„ì¬ ì„±ì  (ì±„ì ëœ ê³¼ì œë§Œ):
    - ë¶„ì: SUM(score Ã— weight) WHERE status = 'graded'
    - ë¶„ëª¨: SUM(weight)         WHERE status = 'graded'
    - â€» ë¯¸ì œì¶œ/ë¯¸ì±„ì  ê³¼ì œëŠ” ì§‘ê³„ì—ì„œ ì œì™¸ (0ì  ì²˜ë¦¬ ì•ˆ í•¨)

[8. Instructor ëŒ€ì‹œë³´ë“œ]
  courses     (READ: WHERE instructor_id = ?)
  submissions (READ: COUNT WHERE status = 'submitted')           â† ì±„ì  ëŒ€ê¸° ìˆ˜
  submissions (READ: ORDER BY submitted_at DESC)                 â† ìµœê·¼ ì œì¶œë¬¼

[9. ì½”ìŠ¤ / ê³¼ì œ ê´€ë¦¬]
  courses     (INSERT / UPDATE / status ì „í™˜: draft â†’ published â†’ archived)
  assignments (INSERT / UPDATE / status ì „í™˜: draft â†’ published â†’ closed)

[10. ì±„ì ]
  submissions (UPDATE: score, feedback, status = 'graded',            graded_at = NOW())
  submissions (UPDATE: feedback,          status = 'resubmission_required')

[11. ìš´ì˜]
  reports      (INSERT: reporter_id, target_type, target_id, reason, content)
  reports      (UPDATE: status, action)
  categories   (INSERT / UPDATE: is_active)
  difficulties (INSERT / UPDATE: is_active)
```

---

## 2. ERD (ê°œìš”)

```
auth.users (Supabase)
  â””â”€ profiles (1:1)
       â””â”€ terms_agreements (1:N)
       â””â”€ courses [instructor] (1:N)
            â””â”€ assignments (1:N)
                 â””â”€ submissions (1:N) â†â”€ profiles [learner]
       â””â”€ enrollments (N:M) â”€â”€ courses
       â””â”€ reports [reporter] (1:N)

categories  â”€â”€< courses
difficulties â”€â”€< courses
```

---

## 3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### 3.1 ENUM íƒ€ì…

```sql
CREATE TYPE user_role AS ENUM ('learner', 'instructor', 'operator');

CREATE TYPE course_status AS ENUM ('draft', 'published', 'archived');

CREATE TYPE assignment_status AS ENUM ('draft', 'published', 'closed');

CREATE TYPE submission_status AS ENUM (
  'submitted',
  'graded',
  'resubmission_required'
);

CREATE TYPE report_target_type AS ENUM (
  'course',
  'assignment',
  'submission',
  'user'
);

CREATE TYPE report_status AS ENUM ('received', 'investigating', 'resolved');

CREATE TYPE report_action AS ENUM (
  'warning',
  'invalidate_submission',
  'restrict_account'
);
```

---

### 3.2 í…Œì´ë¸”

#### `profiles`

Supabase `auth.users` ì™€ 1:1 ë§¤í•‘. ì—­í•  ë° ìµœì†Œ í”„ë¡œí•„ ì €ì¥.

| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ | ì„¤ëª… |
|---|---|---|---|
| id | UUID | PK, FK auth.users | Supabase Auth UID |
| name | TEXT | NOT NULL | ì´ë¦„ |
| phone | TEXT | NOT NULL | íœ´ëŒ€í°ë²ˆí˜¸ |
| role | user_role | NOT NULL | learner \| instructor \| operator |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |

```sql
CREATE TABLE IF NOT EXISTS profiles (
  id         UUID      PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  name       TEXT      NOT NULL,
  phone      TEXT      NOT NULL,
  role       user_role NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

---

#### `terms_agreements`

ì˜¨ë³´ë”© ì‹œ ì•½ê´€ ë™ì˜ ì´ë ¥.

| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ | ì„¤ëª… |
|---|---|---|---|
| id | UUID | PK | |
| user_id | UUID | NOT NULL, FK profiles | |
| agreed_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | ë™ì˜ ì‹œê° |

```sql
CREATE TABLE IF NOT EXISTS terms_agreements (
  id       UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id  UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  agreed_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

---

#### `categories`

ì½”ìŠ¤ ì¹´í…Œê³ ë¦¬ ë©”íƒ€ë°ì´í„°. ìš´ì˜ìê°€ CRUD ê´€ë¦¬.

| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ | ì„¤ëª… |
|---|---|---|---|
| id | UUID | PK | |
| name | TEXT | NOT NULL, UNIQUE | ì¹´í…Œê³ ë¦¬ëª… |
| is_active | BOOLEAN | NOT NULL DEFAULT TRUE | ë¹„í™œì„±í™” ì‹œ ì‹ ê·œ ì½”ìŠ¤ ì„ íƒ ë¶ˆê°€ |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |

```sql
CREATE TABLE IF NOT EXISTS categories (
  id         UUID    PRIMARY KEY DEFAULT gen_random_uuid(),
  name       TEXT    NOT NULL UNIQUE,
  is_active  BOOLEAN NOT NULL DEFAULT TRUE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

---

#### `difficulties`

ì½”ìŠ¤ ë‚œì´ë„ ë©”íƒ€ë°ì´í„°. ìš´ì˜ìê°€ CRUD ê´€ë¦¬.

| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ | ì„¤ëª… |
|---|---|---|---|
| id | UUID | PK | |
| name | TEXT | NOT NULL, UNIQUE | ë‚œì´ë„ëª… (ì˜ˆ: ì…ë¬¸, ì´ˆê¸‰, ì¤‘ê¸‰) |
| is_active | BOOLEAN | NOT NULL DEFAULT TRUE | ë¹„í™œì„±í™” ì‹œ ì‹ ê·œ ì½”ìŠ¤ ì„ íƒ ë¶ˆê°€ |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |

```sql
CREATE TABLE IF NOT EXISTS difficulties (
  id         UUID    PRIMARY KEY DEFAULT gen_random_uuid(),
  name       TEXT    NOT NULL UNIQUE,
  is_active  BOOLEAN NOT NULL DEFAULT TRUE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

---

#### `courses`

ê°•ì‚¬ê°€ ê°œì„¤í•˜ëŠ” ì½”ìŠ¤.

| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ | ì„¤ëª… |
|---|---|---|---|
| id | UUID | PK | |
| instructor_id | UUID | NOT NULL, FK profiles | ì†Œìœ  ê°•ì‚¬ |
| title | TEXT | NOT NULL | ì½”ìŠ¤ ì œëª© |
| description | TEXT | | ì½”ìŠ¤ ì†Œê°œ |
| category_id | UUID | FK categories, NULL í—ˆìš© | |
| difficulty_id | UUID | FK difficulties, NULL í—ˆìš© | |
| curriculum | TEXT | | ì»¤ë¦¬í˜ëŸ¼ (í…ìŠ¤íŠ¸) |
| status | course_status | NOT NULL DEFAULT 'draft' | draft \| published \| archived |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |

```sql
CREATE TABLE IF NOT EXISTS courses (
  id            UUID         PRIMARY KEY DEFAULT gen_random_uuid(),
  instructor_id UUID         NOT NULL REFERENCES profiles(id) ON DELETE RESTRICT,
  title         TEXT         NOT NULL,
  description   TEXT,
  category_id   UUID         REFERENCES categories(id) ON DELETE SET NULL,
  difficulty_id UUID         REFERENCES difficulties(id) ON DELETE SET NULL,
  curriculum    TEXT,
  status        course_status NOT NULL DEFAULT 'draft',
  created_at    TIMESTAMPTZ  NOT NULL DEFAULT NOW(),
  updated_at    TIMESTAMPTZ  NOT NULL DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_courses_instructor_id ON courses(instructor_id);
CREATE INDEX IF NOT EXISTS idx_courses_status        ON courses(status);
CREATE INDEX IF NOT EXISTS idx_courses_category_id   ON courses(category_id);
```

---

#### `enrollments`

í•™ìŠµìì˜ ì½”ìŠ¤ ìˆ˜ê°•ì‹ ì²­ ê¸°ë¡.

| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ | ì„¤ëª… |
|---|---|---|---|
| id | UUID | PK | |
| course_id | UUID | NOT NULL, FK courses | |
| learner_id | UUID | NOT NULL, FK profiles | |
| enrolled_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | ì‹ ì²­ ì‹œê° |
| cancelled_at | TIMESTAMPTZ | NULL í—ˆìš© | ì·¨ì†Œ ì‹œê°, NULL = í™œì„± ìˆ˜ê°• |

- `(course_id, learner_id)` UNIQUE â†’ ì¤‘ë³µ ì‹ ì²­ ë°©ì§€ ë° UPSERT(ON CONFLICT) ì§€ì›ì— í•„ìˆ˜
- `cancelled_at IS NULL` ì¡°ê±´ìœ¼ë¡œ í™œì„± ìˆ˜ê°• ì—¬ë¶€ íŒë³„
- ì¬ì‹ ì²­ ì‹œ ìƒˆ row INSERT ì—†ì´ ê¸°ì¡´ row UPDATE â†’ ì¤‘ë³µ ë°ì´í„° ìƒì„± ë°©ì§€

```sql
CREATE TABLE IF NOT EXISTS enrollments (
  id           UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  course_id    UUID NOT NULL REFERENCES courses(id) ON DELETE CASCADE,
  learner_id   UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  enrolled_at  TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  cancelled_at TIMESTAMPTZ,
  -- UPSERT ì¿¼ë¦¬(ON CONFLICT)ë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ ì•„ë˜ ë³µí•© ìœ ë‹ˆí¬ í‚¤ í•„ìˆ˜
  UNIQUE(course_id, learner_id)
);

CREATE INDEX IF NOT EXISTS idx_enrollments_learner_id ON enrollments(learner_id);
CREATE INDEX IF NOT EXISTS idx_enrollments_course_id  ON enrollments(course_id);
```

---

#### `assignments`

ì½”ìŠ¤ì— ì†í•˜ëŠ” ê³¼ì œ.

| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ | ì„¤ëª… |
|---|---|---|---|
| id | UUID | PK | |
| course_id | UUID | NOT NULL, FK courses | |
| title | TEXT | NOT NULL | ê³¼ì œ ì œëª© |
| description | TEXT | | ê³¼ì œ ì„¤ëª… ë° ìš”êµ¬ì‚¬í•­ |
| due_at | TIMESTAMPTZ | NOT NULL | ë§ˆê°ì¼ |
| weight | NUMERIC(5,2) | NOT NULL, CHECK > 0 | ì ìˆ˜ ë¹„ì¤‘ |
| allow_late | BOOLEAN | NOT NULL DEFAULT FALSE | ì§€ê° ì œì¶œ í—ˆìš© ì—¬ë¶€ |
| allow_resubmit | BOOLEAN | NOT NULL DEFAULT FALSE | ì¬ì œì¶œ í—ˆìš© ì—¬ë¶€ |
| status | assignment_status | NOT NULL DEFAULT 'draft' | draft \| published \| closed. â€» closedëŠ” ê°•ì‚¬ ìˆ˜ë™ ê°•ì œ ë§ˆê° ì „ìš©. ì¼ë°˜ ë§ˆê°ì€ `status='published' AND NOW() > due_at` ìœ¼ë¡œ íŒë³„ |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |

```sql
CREATE TABLE IF NOT EXISTS assignments (
  id             UUID              PRIMARY KEY DEFAULT gen_random_uuid(),
  course_id      UUID              NOT NULL REFERENCES courses(id) ON DELETE CASCADE,
  title          TEXT              NOT NULL,
  description    TEXT,
  due_at         TIMESTAMPTZ       NOT NULL,
  weight         NUMERIC(5,2)      NOT NULL CHECK (weight > 0),
  allow_late     BOOLEAN           NOT NULL DEFAULT FALSE,
  allow_resubmit BOOLEAN           NOT NULL DEFAULT FALSE,
  -- 'closed'ëŠ” ê°•ì‚¬ê°€ ìˆ˜ë™ìœ¼ë¡œ ì¡°ê¸° ì¢…ë£Œí–ˆì„ ë•Œë§Œ ì‚¬ìš©.
  -- ì¼ë°˜ì ì¸ ë§ˆê°ì€ (status='published' AND due_at < NOW()) ë¡œ íŒë‹¨í•¨.
  status         assignment_status NOT NULL DEFAULT 'draft', -- draft | published | closed
  created_at     TIMESTAMPTZ       NOT NULL DEFAULT NOW(),
  updated_at     TIMESTAMPTZ       NOT NULL DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_assignments_course_id ON assignments(course_id);
CREATE INDEX IF NOT EXISTS idx_assignments_status    ON assignments(status);
CREATE INDEX IF NOT EXISTS idx_assignments_due_at    ON assignments(due_at);
```

---

#### `submissions`

í•™ìŠµìì˜ ê³¼ì œ ì œì¶œë¬¼.

| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ | ì„¤ëª… |
|---|---|---|---|
| id | UUID | PK | |
| assignment_id | UUID | NOT NULL, FK assignments | |
| learner_id | UUID | NOT NULL, FK profiles | |
| content_text | TEXT | NOT NULL | ì œì¶œ í…ìŠ¤íŠ¸ (í•„ìˆ˜) |
| content_link | TEXT | NULL í—ˆìš© | ì œì¶œ ë§í¬ (ì„ íƒ, URL) |
| is_late | BOOLEAN | NOT NULL DEFAULT FALSE | ì§€ê° ì œì¶œ ì—¬ë¶€ |
| status | submission_status | NOT NULL DEFAULT 'submitted' | submitted \| graded \| resubmission_required |
| score | INTEGER | NULL í—ˆìš©, CHECK 0~100 | ì±„ì  ì ìˆ˜ |
| feedback | TEXT | NULL í—ˆìš© | ê°•ì‚¬ í”¼ë“œë°± |
| submitted_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | ìµœì¢… ì œì¶œ ì‹œê° |
| graded_at | TIMESTAMPTZ | NULL í—ˆìš© | ì±„ì  ì‹œê° |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |

- `(assignment_id, learner_id)` UNIQUE â†’ ê³¼ì œë‹¹ 1ê±´, ì¬ì œì¶œì€ UPDATE
- ì¬ì œì¶œ ì‹œ: `content_text`, `content_link`, `is_late`, `status`, `submitted_at` ê°±ì‹ 

```sql
CREATE TABLE IF NOT EXISTS submissions (
  id            UUID              PRIMARY KEY DEFAULT gen_random_uuid(),
  assignment_id UUID              NOT NULL REFERENCES assignments(id) ON DELETE CASCADE,
  learner_id    UUID              NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  content_text  TEXT              NOT NULL,
  content_link  TEXT,
  is_late       BOOLEAN           NOT NULL DEFAULT FALSE,
  status        submission_status NOT NULL DEFAULT 'submitted',
  score         INTEGER           CHECK (score >= 0 AND score <= 100),
  feedback      TEXT,
  submitted_at  TIMESTAMPTZ       NOT NULL DEFAULT NOW(),
  graded_at     TIMESTAMPTZ,
  created_at    TIMESTAMPTZ       NOT NULL DEFAULT NOW(),
  updated_at    TIMESTAMPTZ       NOT NULL DEFAULT NOW(),
  UNIQUE(assignment_id, learner_id)
);

CREATE INDEX IF NOT EXISTS idx_submissions_assignment_id ON submissions(assignment_id);
CREATE INDEX IF NOT EXISTS idx_submissions_learner_id    ON submissions(learner_id);
CREATE INDEX IF NOT EXISTS idx_submissions_status        ON submissions(status);
```

---

#### `reports`

ìš´ì˜ì ì‹ ê³  ì ‘ìˆ˜ ë° ì²˜ë¦¬ ì´ë ¥.

| ì»¬ëŸ¼ | íƒ€ì… | ì œì•½ | ì„¤ëª… |
|---|---|---|---|
| id | UUID | PK | |
| reporter_id | UUID | NOT NULL, FK profiles | ì‹ ê³ ì |
| target_type | report_target_type | NOT NULL | course \| assignment \| submission \| user |
| target_id | UUID | NOT NULL | ì‹ ê³  ëŒ€ìƒ ë ˆì½”ë“œ ID |
| reason | TEXT | NOT NULL | ì‹ ê³  ì‚¬ìœ  |
| content | TEXT | NOT NULL | ì‹ ê³  ë‚´ìš© |
| status | report_status | NOT NULL DEFAULT 'received' | received \| investigating \| resolved |
| action | report_action | NULL í—ˆìš© | ì²˜ë¦¬ ì•¡ì…˜ (ê²½ê³ /ë¬´íš¨í™”/ê³„ì •ì œí•œ) |
| created_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |
| updated_at | TIMESTAMPTZ | NOT NULL DEFAULT NOW() | |

```sql
CREATE TABLE IF NOT EXISTS reports (
  id          UUID               PRIMARY KEY DEFAULT gen_random_uuid(),
  reporter_id UUID               NOT NULL REFERENCES profiles(id) ON DELETE RESTRICT,
  target_type report_target_type NOT NULL,
  target_id   UUID               NOT NULL,
  reason      TEXT               NOT NULL,
  content     TEXT               NOT NULL,
  status      report_status      NOT NULL DEFAULT 'received',
  action      report_action,
  created_at  TIMESTAMPTZ        NOT NULL DEFAULT NOW(),
  updated_at  TIMESTAMPTZ        NOT NULL DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_reports_status ON reports(status);
```

---

## 4. updated_at ìë™ ê°±ì‹  íŠ¸ë¦¬ê±°

```sql
CREATE OR REPLACE FUNCTION set_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_profiles_updated_at
  BEFORE UPDATE ON profiles
  FOR EACH ROW EXECUTE FUNCTION set_updated_at();

CREATE TRIGGER trg_categories_updated_at
  BEFORE UPDATE ON categories
  FOR EACH ROW EXECUTE FUNCTION set_updated_at();

CREATE TRIGGER trg_difficulties_updated_at
  BEFORE UPDATE ON difficulties
  FOR EACH ROW EXECUTE FUNCTION set_updated_at();

CREATE TRIGGER trg_courses_updated_at
  BEFORE UPDATE ON courses
  FOR EACH ROW EXECUTE FUNCTION set_updated_at();

CREATE TRIGGER trg_assignments_updated_at
  BEFORE UPDATE ON assignments
  FOR EACH ROW EXECUTE FUNCTION set_updated_at();

CREATE TRIGGER trg_submissions_updated_at
  BEFORE UPDATE ON submissions
  FOR EACH ROW EXECUTE FUNCTION set_updated_at();

CREATE TRIGGER trg_reports_updated_at
  BEFORE UPDATE ON reports
  FOR EACH ROW EXECUTE FUNCTION set_updated_at();
```

---

## 5. í…Œì´ë¸” ìš”ì•½

| í…Œì´ë¸” | ì—­í•  |
|---|---|
| `profiles` | ìœ ì € ì—­í•  ë° ìµœì†Œ í”„ë¡œí•„ |
| `terms_agreements` | ì˜¨ë³´ë”© ì•½ê´€ ë™ì˜ ì´ë ¥ |
| `categories` | ì½”ìŠ¤ ì¹´í…Œê³ ë¦¬ ë©”íƒ€ë°ì´í„° (ìš´ì˜ì ê´€ë¦¬) |
| `difficulties` | ì½”ìŠ¤ ë‚œì´ë„ ë©”íƒ€ë°ì´í„° (ìš´ì˜ì ê´€ë¦¬) |
| `courses` | ê°•ì‚¬ ê°œì„¤ ì½”ìŠ¤ |
| `enrollments` | í•™ìŠµì ìˆ˜ê°•ì‹ ì²­ ê¸°ë¡ |
| `assignments` | ì½”ìŠ¤ë³„ ê³¼ì œ |
| `submissions` | í•™ìŠµì ì œì¶œë¬¼ ë° ì±„ì  ê²°ê³¼ |
| `reports` | ìš´ì˜ì ì‹ ê³  ì ‘ìˆ˜/ì²˜ë¦¬ |
</file>

<file path="plan.md">
# Implementation Plan

> ê¸°ë°˜ ë¬¸ì„œ: `prd.md`, `workflow.md`, `database.md`
> ì½”ë“œë² ì´ìŠ¤ ì»¨ë²¤ì…˜: `.ruler/AGENTS.md`

---

## 1. ê°œìš”

### ê³µí†µ(Shared) ëª¨ë“ˆ

| ëª¨ë“ˆ | ìœ„ì¹˜ | ì„¤ëª… |
|---|---|---|
| `withAuth` | `src/backend/middleware/auth.ts` | ì¿ í‚¤ JWT ê²€ì¦ â†’ `currentUser`(id, role)ë¥¼ Hono contextì— ì£¼ì…í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ |
| `requireRole` | `src/backend/guards/role.ts` | Hono ë¼ìš°íŠ¸ ë ˆë²¨ ì—­í•  ê°€ë“œ íŒ©í† ë¦¬. ì˜ˆ: `requireRole('instructor')` |
| `useRoleGuard` | `src/hooks/useRoleGuard.ts` | í´ë¼ì´ì–¸íŠ¸ ì—­í•  ë¶ˆì¼ì¹˜ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ëŠ” ë²”ìš© í›… |
| `StatusBadge` | `src/components/status-badge.tsx` | course/assignment/submission ìƒíƒœ enumì„ ë°°ì§€ë¡œ ë Œë”ë§í•˜ëŠ” ë²”ìš© UI |

### Feature ëª¨ë“ˆ (ì‹ ê·œ, src/features/)

| ëª¨ë“ˆ | ìœ„ì¹˜ | API Prefix | ë‹´ë‹¹ ìœ ì €í”Œë¡œìš° |
|---|---|---|---|
| `profiles` | `src/features/profiles/` | `/api/profiles` | Â§1 ì—­í•  ì„ íƒ & ì˜¨ë³´ë”© |
| `courses` | `src/features/courses/` | `/api/courses` | Â§2 ì½”ìŠ¤ íƒìƒ‰, Â§8 ì½”ìŠ¤ ê´€ë¦¬ |
| `enrollments` | `src/features/enrollments/` | `/api/enrollments` | Â§2 ìˆ˜ê°•ì‹ ì²­/ì·¨ì†Œ/ì¬ì‹ ì²­ |
| `assignments` | `src/features/assignments/` | `/api/assignments` | Â§4 ê³¼ì œ ì—´ëŒ, Â§9 ê³¼ì œ ê´€ë¦¬, Â§11 ë§ˆê° |
| `submissions` | `src/features/submissions/` | `/api/submissions` | Â§5 ì œì¶œ/ì¬ì œì¶œ, Â§10 ì±„ì /í”¼ë“œë°± |
| `learner` | `src/features/learner/` | `/api/learner` | Â§3 ëŒ€ì‹œë³´ë“œ, Â§6 ì„±ì /í”¼ë“œë°± |
| `instructor` | `src/features/instructor/` | `/api/instructor` | Â§7 ê°•ì‚¬ ëŒ€ì‹œë³´ë“œ |
| `reports` | `src/features/reports/` | `/api/reports` | Â§12 ì‹ ê³  ì ‘ìˆ˜Â·ì²˜ë¦¬ |
| `metadata` | `src/features/metadata/` | `/api/metadata` | Â§12 ì¹´í…Œê³ ë¦¬Â·ë‚œì´ë„ ê´€ë¦¬ |

### ì‹ ê·œ í˜ì´ì§€ (src/app/)

| ê²½ë¡œ | íŒŒì¼ ìœ„ì¹˜ | ì£¼ìš” feature |
|---|---|---|
| `/onboarding` | `src/app/onboarding/page.tsx` | profiles |
| `/courses` | `src/app/courses/page.tsx` | courses |
| `/courses/[courseId]/about` | `src/app/courses/[courseId]/about/page.tsx` | courses |
| `/courses/[courseId]/curriculum` | `src/app/courses/[courseId]/curriculum/page.tsx` | courses |
| `/courses/[courseId]/enroll` | `src/app/courses/[courseId]/enroll/page.tsx` | enrollments |
| `/courses/my` | `src/app/courses/my/page.tsx` | learner |
| `/courses/my/[courseId]/assignments/[assignmentId]` | `src/app/courses/my/[courseId]/assignments/[assignmentId]/page.tsx` | assignments |
| `/courses/my/[courseId]/assignments/[assignmentId]/submit` | `.../submit/page.tsx` | submissions |
| `/courses/my/[courseId]/assignments/[assignmentId]/feedback` | `.../feedback/page.tsx` | submissions |
| `/courses/my/[courseId]/grades` | `src/app/courses/my/[courseId]/grades/page.tsx` | learner |
| `/instructor/dashboard` | `src/app/instructor/dashboard/page.tsx` | instructor |
| `/instructor/courses/new` | `src/app/instructor/courses/new/page.tsx` | courses |
| `/instructor/courses/[courseId]/edit` | `src/app/instructor/courses/[courseId]/edit/page.tsx` | courses |
| `/instructor/assignments/new` | `src/app/instructor/assignments/new/page.tsx` | assignments |
| `/instructor/assignments/[assignmentId]/submissions` | `.../submissions/page.tsx` | submissions |

---

## 2. Diagram

### 2.1 ì „ì²´ ì•„í‚¤í…ì²˜

```mermaid
flowchart TD
    subgraph client["Client (Browser)"]
        direction TB
        PAGES["Pages\n(src/app/)"]
        HOOKS["Feature Hooks\n(React Query)"]
        COMP["Feature Components\n('use client')"]
        PAGES --> COMP --> HOOKS
    end

    subgraph server["Server (Hono via Next.js Route Handler)"]
        direction TB
        MW["Middleware Pipeline\nerrorBoundary â†’ withAppContext\nâ†’ withSupabase â†’ withAuth"]
        ROUTES["Feature Routes\n/api/profiles, /api/courses, ..."]
        SERVICES["Feature Services\n(Supabase queries + ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)"]
        MW --> ROUTES --> SERVICES
    end

    subgraph database["Supabase DB"]
        direction LR
        T1[(profiles\nterms_agreements)]
        T2[(courses\ncategories\ndifficulties)]
        T3[(enrollments)]
        T4[(assignments)]
        T5[(submissions)]
        T6[(reports)]
    end

    HOOKS -- "HTTP (apiClient)" --> MW
    SERVICES -- "SQL" --> T1
    SERVICES -- "SQL" --> T2
    SERVICES -- "SQL" --> T3
    SERVICES -- "SQL" --> T4
    SERVICES -- "SQL" --> T5
    SERVICES -- "SQL" --> T6
```

### 2.2 Feature ì˜ì¡´ì„±

```mermaid
graph LR
    subgraph shared["ê³µí†µ ëª¨ë“ˆ"]
        AUTH_MW["withAuth\nmiddleware"]
        REQ_ROLE["requireRole\nguard"]
        ROLE_GUARD["useRoleGuard\nhook"]
    end

    subgraph features["Feature Modules"]
        PROFILES["profiles"]
        META["metadata"]
        COURSES["courses"]
        ENROLL["enrollments"]
        ASSIGN["assignments"]
        SUBMIT["submissions"]
        LEARNER["learner"]
        INSTRUCTOR["instructor"]
        REPORTS["reports"]
    end

    META -->|ì¹´í…Œê³ ë¦¬Â·ë‚œì´ë„ ì œê³µ| COURSES
    PROFILES -->|instructor_id ì œê³µ| COURSES
    COURSES -->|course_id ì œê³µ| ENROLL
    COURSES -->|course_id ì œê³µ| ASSIGN
    ASSIGN -->|assignment_id ì œê³µ| SUBMIT

    ENROLL -->|ìˆ˜ê°• ëª©ë¡| LEARNER
    ASSIGN -->|ê³¼ì œ ëª©ë¡| LEARNER
    SUBMIT -->|ì„±ì Â·í”¼ë“œë°±| LEARNER

    COURSES -->|ì½”ìŠ¤ ëª©ë¡| INSTRUCTOR
    SUBMIT -->|ì œì¶œë¬¼ ëª©ë¡| INSTRUCTOR

    AUTH_MW -.->|currentUser ì£¼ì…| PROFILES
    AUTH_MW -.->|currentUser ì£¼ì…| COURSES
    AUTH_MW -.->|currentUser ì£¼ì…| ENROLL
    AUTH_MW -.->|currentUser ì£¼ì…| ASSIGN
    AUTH_MW -.->|currentUser ì£¼ì…| SUBMIT
    AUTH_MW -.->|currentUser ì£¼ì…| LEARNER
    AUTH_MW -.->|currentUser ì£¼ì…| INSTRUCTOR
    AUTH_MW -.->|currentUser ì£¼ì…| REPORTS
    AUTH_MW -.->|currentUser ì£¼ì…| META

    REQ_ROLE -.->|ì—­í•  ê°€ë“œ| COURSES
    REQ_ROLE -.->|ì—­í•  ê°€ë“œ| ASSIGN
    REQ_ROLE -.->|ì—­í•  ê°€ë“œ| SUBMIT
    REQ_ROLE -.->|ì—­í•  ê°€ë“œ| INSTRUCTOR
    REQ_ROLE -.->|ì—­í•  ê°€ë“œ| REPORTS
    REQ_ROLE -.->|ì—­í•  ê°€ë“œ| META
```

### 2.3 API ë¼ìš°íŠ¸ ë§µ

```mermaid
graph LR
    subgraph profiles_api["/api/profiles"]
        P1["POST /api/profiles/onboarding"]
        P2["GET /api/profiles/me"]
    end
    subgraph courses_api["/api/courses"]
        C1["GET /api/courses"]
        C2["GET /api/courses/:id"]
        C3["POST /api/courses"]
        C4["PUT /api/courses/:id"]
        C5["PATCH /api/courses/:id/status"]
    end
    subgraph enrollments_api["/api/enrollments"]
        E1["POST /api/enrollments"]
        E2["DELETE /api/enrollments/:courseId"]
    end
    subgraph assignments_api["/api/assignments"]
        A1["GET /api/assignments?courseId="]
        A2["GET /api/assignments/:id"]
        A3["POST /api/assignments"]
        A4["PUT /api/assignments/:id"]
        A5["PATCH /api/assignments/:id/status"]
    end
    subgraph submissions_api["/api/submissions"]
        S1["POST /api/submissions"]
        S2["PUT /api/submissions/:id"]
        S3["PATCH /api/submissions/:id/grade"]
        S4["GET /api/assignments/:id/submissions"]
    end
    subgraph learner_api["/api/learner"]
        L1["GET /api/learner/dashboard"]
        L2["GET /api/learner/courses/:id/grades"]
    end
    subgraph instructor_api["/api/instructor"]
        I1["GET /api/instructor/dashboard"]
    end
    subgraph reports_api["/api/reports"]
        R1["POST /api/reports"]
        R2["GET /api/reports"]
        R3["PATCH /api/reports/:id"]
    end
    subgraph metadata_api["/api/metadata"]
        M1["GET /api/metadata/categories"]
        M2["POST /api/metadata/categories"]
        M3["PATCH /api/metadata/categories/:id"]
        M4["GET /api/metadata/difficulties"]
        M5["POST /api/metadata/difficulties"]
        M6["PATCH /api/metadata/difficulties/:id"]
    end
```

---

## 3. Implementation Plan

---

### [Shared] withAuth + requireRole

> ëª¨ë“  ë³´í˜¸ ë¼ìš°íŠ¸ì˜ ì „ì œ ì¡°ê±´

**íŒŒì¼ êµ¬ì¡°:**
```
src/backend/
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.ts              â† ì‹ ê·œ: JWT ê²€ì¦ + currentUser ì£¼ì…
â”œâ”€â”€ guards/
â”‚   â””â”€â”€ role.ts              â† ì‹ ê·œ: requireRole() íŒ©í† ë¦¬
â””â”€â”€ hono/
    â””â”€â”€ context.ts           â† ìˆ˜ì •: AppVariablesì— currentUser ì¶”ê°€
```

**Context ìˆ˜ì • (`src/backend/hono/context.ts`):**
```typescript
// AppVariablesì— ì¶”ê°€
currentUser?: {
  id: string;
  role: 'learner' | 'instructor' | 'operator';
};
```

**withAuth ë¯¸ë“¤ì›¨ì–´ ë™ì‘:**
1. `Authorization: Bearer <token>` í—¤ë” ë˜ëŠ” `sb-access-token` ì¿ í‚¤ì—ì„œ JWT ì¶”ì¶œ
2. `supabase.auth.getUser(token)` í˜¸ì¶œ
3. `profiles` í…Œì´ë¸”ì—ì„œ ì—­í• (role) ì¡°íšŒ
4. `c.set('currentUser', { id, role })` ì£¼ì…
5. ì¸ì¦ ì‹¤íŒ¨ ì‹œ 401 ë°˜í™˜

**requireRole ë™ì‘:**
```typescript
// ì‚¬ìš© ì˜ˆ: app.post('/api/courses', requireRole('instructor'), handler)
export const requireRole = (role: UserRole) => createMiddleware(...)
```

**Unit Tests (auth.ts):**
```
describe('withAuth')
  âœ“ ìœ íš¨í•œ JWT â†’ currentUser ì£¼ì…
  âœ— í† í° ì—†ìŒ â†’ 401 UNAUTHORIZED
  âœ— ë§Œë£Œëœ í† í° â†’ 401 UNAUTHORIZED
  âœ— í”„ë¡œí•„ ë¯¸ì¡´ì¬ â†’ 403 PROFILE_REQUIRED (ì˜¨ë³´ë”© ìœ ë„)

describe('requireRole')
  âœ“ ì¼ì¹˜í•˜ëŠ” ì—­í•  â†’ next() ì§„í–‰
  âœ— ì—­í•  ë¶ˆì¼ì¹˜ â†’ 403 FORBIDDEN
  âœ— currentUser ì—†ìŒ (withAuth ë¯¸ì ìš©) â†’ 500
```

**QA Sheet (src/hooks/useRoleGuard.ts):**
| ì‹œë‚˜ë¦¬ì˜¤ | ì‚¬ì „ ì¡°ê±´ | ë‹¨ê³„ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|---|---|
| Learnerê°€ ê°•ì‚¬ ê²½ë¡œ ì ‘ê·¼ | role=learner ë¡œê·¸ì¸ | /instructor/dashboard ì§ì ‘ ì ‘ê·¼ | /courses/my ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |
| ë¹„ë¡œê·¸ì¸ ë³´í˜¸ ê²½ë¡œ ì ‘ê·¼ | ë¹„ë¡œê·¸ì¸ ìƒíƒœ | /courses/my ì ‘ê·¼ | /login?redirectedFrom=/courses/my |
| ì˜¨ë³´ë”© ë¯¸ì™„ë£Œ ì ‘ê·¼ | ë¡œê·¸ì¸, í”„ë¡œí•„ ì—†ìŒ | ì–´ëŠ ê²½ë¡œë“  ì ‘ê·¼ | /onboarding ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |

---

### [Feature] profiles

> ìœ ì €í”Œë¡œìš° Â§1 ì—­í•  ì„ íƒ & ì˜¨ë³´ë”©

**íŒŒì¼ êµ¬ì¡°:**
```
src/features/profiles/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ route.ts    â† POST /api/profiles/onboarding, GET /api/profiles/me
â”‚   â”œâ”€â”€ service.ts  â† createProfile(), getMyProfile()
â”‚   â”œâ”€â”€ schema.ts   â† OnboardingRequestSchema, ProfileResponseSchema
â”‚   â””â”€â”€ error.ts    â† PROFILE_ALREADY_EXISTS, INVALID_ROLE
â”œâ”€â”€ components/
â”‚   â””â”€â”€ onboarding-form.tsx   â† ì—­í•  ì„ íƒ + ì´ë¦„Â·íœ´ëŒ€í° ì…ë ¥ + ì•½ê´€ ë™ì˜
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useOnboardingMutation.ts
â””â”€â”€ lib/
    â””â”€â”€ dto.ts
```

**API ì—”ë“œí¬ì¸íŠ¸:**
| Method | Path | ì„¤ëª… | ê¶Œí•œ |
|---|---|---|---|
| `POST` | `/api/profiles/onboarding` | í”„ë¡œí•„ ìƒì„± + ì•½ê´€ ì´ë ¥ ì €ì¥ | ë¡œê·¸ì¸(withAuth, í”„ë¡œí•„ ì—†ìŒ) |
| `GET` | `/api/profiles/me` | ë‚´ í”„ë¡œí•„ ì¡°íšŒ | withAuth |

**Backend Unit Tests:**
```
describe('createProfile')
  âœ“ ì‹ ê·œ ìœ ì €: profiles INSERT + terms_agreements INSERT
  âœ“ role=learner â†’ ì¹´íƒˆë¡œê·¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²½ë¡œ ë°˜í™˜
  âœ“ role=instructor â†’ ëŒ€ì‹œë³´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ê²½ë¡œ ë°˜í™˜
  âœ— ì´ë¯¸ í”„ë¡œí•„ ì¡´ì¬ â†’ failure(409, PROFILE_ALREADY_EXISTS)
  âœ— role ê°’ ì—†ìŒ â†’ failure(400, INVALID_ROLE)
  âœ— name ë¹ˆ ê°’ â†’ failure(400, VALIDATION_ERROR)

describe('getMyProfile')
  âœ“ ì¡´ì¬í•˜ëŠ” í”„ë¡œí•„ ë°˜í™˜
  âœ— í”„ë¡œí•„ ì—†ìŒ â†’ failure(404, PROFILE_NOT_FOUND)
```

**Frontend QA Sheet:**
| ì‹œë‚˜ë¦¬ì˜¤ | ì‚¬ì „ ì¡°ê±´ | ë‹¨ê³„ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|---|---|
| Learner ì˜¨ë³´ë”© ì™„ë£Œ | íšŒì›ê°€ì… í›„ /onboarding ì§„ì… | Learner ì„ íƒ â†’ ì´ë¦„Â·ì „í™”ë²ˆí˜¸ ì…ë ¥ â†’ ì•½ê´€ ë™ì˜ â†’ ì œì¶œ | /courses ë¡œ ì´ë™ |
| Instructor ì˜¨ë³´ë”© ì™„ë£Œ | íšŒì›ê°€ì… í›„ /onboarding ì§„ì… | Instructor ì„ íƒ â†’ ì…ë ¥ â†’ ì œì¶œ | /instructor/dashboard ë¡œ ì´ë™ |
| í•„ìˆ˜ í•­ëª© ëˆ„ë½ | /onboarding | ì´ë¦„ ì—†ì´ ì œì¶œ | ì´ë¦„ í•„ë“œì— ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ, ì œì¶œ ì°¨ë‹¨ |
| ì•½ê´€ ë¯¸ë™ì˜ | /onboarding | ì•½ê´€ ë¯¸ì²´í¬ í›„ ì œì¶œ | ì•½ê´€ ë™ì˜ ì—ëŸ¬ í‘œì‹œ, ì œì¶œ ì°¨ë‹¨ |
| ì¤‘ë³µ ì˜¨ë³´ë”© ì‹œë„ | ì´ë¯¸ í”„ë¡œí•„ ì¡´ì¬ | /onboarding ì¬ì ‘ê·¼ | /courses ë˜ëŠ” /instructor/dashboard ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ |

---

### [Feature] courses

> ìœ ì €í”Œë¡œìš° Â§2 ì½”ìŠ¤ íƒìƒ‰, Â§8 ì½”ìŠ¤ ê´€ë¦¬

**íŒŒì¼ êµ¬ì¡°:**
```
src/features/courses/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ route.ts    â† GET /api/courses, GET /api/courses/:id, POST, PUT, PATCH status
â”‚   â”œâ”€â”€ service.ts  â† getCourseCatalog(), getCourseDetail(), createCourse(), updateCourse(), updateCourseStatus()
â”‚   â”œâ”€â”€ schema.ts   â† CourseCatalogQuerySchema, CourseResponseSchema, CreateCourseSchema
â”‚   â””â”€â”€ error.ts    â† COURSE_NOT_FOUND, NOT_COURSE_OWNER, INVALID_STATUS_TRANSITION
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ course-catalog.tsx        â† ê²€ìƒ‰/í•„í„°/ì •ë ¬ + ì¹´ë“œ ëª©ë¡
â”‚   â”œâ”€â”€ course-filter-bar.tsx     â† ì¹´í…Œê³ ë¦¬Â·ë‚œì´ë„Â·ì •ë ¬ ì…€ë ‰í„°
â”‚   â”œâ”€â”€ course-card.tsx           â† ê°œë³„ ì½”ìŠ¤ ì¹´ë“œ
â”‚   â”œâ”€â”€ course-detail.tsx         â† ì†Œê°œÂ·ì»¤ë¦¬í˜ëŸ¼Â·ê°•ì‚¬ ì •ë³´
â”‚   â”œâ”€â”€ course-form.tsx           â† ê°•ì‚¬ ìƒì„±/ìˆ˜ì • í¼
â”‚   â””â”€â”€ course-status-control.tsx â† ê°•ì‚¬ ìƒíƒœ ì „í™˜ ë²„íŠ¼
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useCourseCatalogQuery.ts
â”‚   â”œâ”€â”€ useCourseDetailQuery.ts
â”‚   â”œâ”€â”€ useCreateCourseMutation.ts
â”‚   â”œâ”€â”€ useUpdateCourseMutation.ts
â”‚   â””â”€â”€ useUpdateCourseStatusMutation.ts
â””â”€â”€ lib/
    â””â”€â”€ dto.ts
```

**API ì—”ë“œí¬ì¸íŠ¸:**
| Method | Path | ì„¤ëª… | ê¶Œí•œ |
|---|---|---|---|
| `GET` | `/api/courses` | ì¹´íƒˆë¡œê·¸ ëª©ë¡ (ê²€ìƒ‰Â·í•„í„°Â·ì •ë ¬) | public |
| `GET` | `/api/courses/:id` | ì½”ìŠ¤ ìƒì„¸ | public |
| `POST` | `/api/courses` | ì½”ìŠ¤ ìƒì„± (draft) | instructor |
| `PUT` | `/api/courses/:id` | ì½”ìŠ¤ ìˆ˜ì • | instructor + owner |
| `PATCH` | `/api/courses/:id/status` | ìƒíƒœ ì „í™˜ | instructor + owner |

**Backend Unit Tests:**
```
describe('getCourseCatalog')
  âœ“ status=publishedì¸ ì½”ìŠ¤ë§Œ ë°˜í™˜
  âœ“ ê²€ìƒ‰ì–´ë¡œ title ILIKE í•„í„°
  âœ“ category_id í•„í„°
  âœ“ difficulty_id í•„í„°
  âœ“ ìµœì‹ ìˆœ(created_at DESC) ì •ë ¬
  âœ“ ì¸ê¸°ìˆœ(enrollments count DESC) ì •ë ¬
  âœ“ ê²°ê³¼ ì—†ì„ ì‹œ ë¹ˆ ë°°ì—´ ë°˜í™˜

describe('createCourse')
  âœ“ ì •ìƒ ìƒì„± â†’ status=draft, instructor_id=currentUser.id
  âœ— roleâ‰ instructor â†’ failure(403, FORBIDDEN)

describe('updateCourseStatus')
  âœ“ draft â†’ published
  âœ“ published â†’ archived
  âœ— archived â†’ published â†’ failure(400, INVALID_STATUS_TRANSITION)
  âœ— ì†Œìœ ì ì•„ë‹Œ ê²½ìš° â†’ failure(403, NOT_COURSE_OWNER)
```

**Frontend QA Sheet:**
| ì‹œë‚˜ë¦¬ì˜¤ | ì‚¬ì „ ì¡°ê±´ | ë‹¨ê³„ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|---|---|
| ì¹´íƒˆë¡œê·¸ ê¸°ë³¸ ì§„ì… | ë¡œê·¸ì¸, published ì½”ìŠ¤ 3ê°œ | /courses ì ‘ê·¼ | ì½”ìŠ¤ ì¹´ë“œ 3ê°œ í‘œì‹œ |
| í‚¤ì›Œë“œ ê²€ìƒ‰ | ì¹´íƒˆë¡œê·¸ í‘œì‹œ ì¤‘ | ê²€ìƒ‰ì°½ì— "React" ì…ë ¥ | "React" í¬í•¨ ì½”ìŠ¤ë§Œ í‘œì‹œ |
| ì¹´í…Œê³ ë¦¬ í•„í„° | ì¹´íƒˆë¡œê·¸ í‘œì‹œ ì¤‘ | ì¹´í…Œê³ ë¦¬ "ì›¹ê°œë°œ" ì„ íƒ | í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ì½”ìŠ¤ë§Œ í‘œì‹œ |
| ì½”ìŠ¤ ìƒì„¸ ì§„ì… | ì¹´íƒˆë¡œê·¸ í‘œì‹œ ì¤‘ | ì½”ìŠ¤ ì¹´ë“œ í´ë¦­ | about í˜ì´ì§€ ì§„ì…, ì†Œê°œÂ·ì»¤ë¦¬í˜ëŸ¼Â·ê°•ì‚¬ í‘œì‹œ |
| ê°•ì‚¬ ì½”ìŠ¤ ìƒì„± | role=instructor | /instructor/courses/new â†’ í¼ ì‘ì„± â†’ ì œì¶œ | ìƒì„± ì™„ë£Œ, ëª©ë¡ì— draft ìƒíƒœë¡œ í‘œì‹œ |
| ê°•ì‚¬ ì½”ìŠ¤ published ì „í™˜ | draft ì½”ìŠ¤ ì¡´ì¬ | ì½”ìŠ¤ í¸ì§‘ â†’ "ê²Œì‹œ" ë²„íŠ¼ í´ë¦­ | status=published, ì¹´íƒˆë¡œê·¸ì— ë…¸ì¶œ |
| ê°•ì‚¬ ì½”ìŠ¤ archived ì „í™˜ | published ì½”ìŠ¤ ì¡´ì¬ | "ì¢…ë£Œ" ë²„íŠ¼ í´ë¦­ | status=archived, ì¹´íƒˆë¡œê·¸ì—ì„œ ë¯¸í‘œì‹œ, ì‹ ê·œ ìˆ˜ê°• ë¶ˆê°€ |

---

### [Feature] enrollments

> ìœ ì €í”Œë¡œìš° Â§2 ìˆ˜ê°•ì‹ ì²­/ì·¨ì†Œ/ì¬ì‹ ì²­

**íŒŒì¼ êµ¬ì¡°:**
```
src/features/enrollments/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ route.ts    â† POST /api/enrollments, DELETE /api/enrollments/:courseId
â”‚   â”œâ”€â”€ service.ts  â† enrollCourse(), cancelEnrollment()
â”‚   â”œâ”€â”€ schema.ts   â† EnrollRequestSchema, EnrollmentResponseSchema
â”‚   â””â”€â”€ error.ts    â† ALREADY_ENROLLED, NOT_ENROLLED, COURSE_NOT_PUBLISHED
â”œâ”€â”€ components/
â”‚   â””â”€â”€ enroll-button.tsx   â† ì‹ ì²­/ì·¨ì†Œ/ì¬ì‹ ì²­ ìƒíƒœì— ë”°ë¥¸ ë²„íŠ¼ ë Œë”ë§
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useEnrollmentStatusQuery.ts    â† í˜„ì¬ ìˆ˜ê°• ìƒíƒœ ì¡°íšŒ
â”‚   â”œâ”€â”€ useEnrollMutation.ts
â”‚   â””â”€â”€ useCancelEnrollmentMutation.ts
â””â”€â”€ lib/
    â””â”€â”€ dto.ts
```

**API ì—”ë“œí¬ì¸íŠ¸:**
| Method | Path | ì„¤ëª… | ê¶Œí•œ |
|---|---|---|---|
| `POST` | `/api/enrollments` | ìˆ˜ê°•ì‹ ì²­ (ì‹ ê·œ or ì¬ì‹ ì²­ UPSERT) | learner |
| `DELETE` | `/api/enrollments/:courseId` | ìˆ˜ê°•ì·¨ì†Œ | learner + ìˆ˜ê°• ì¤‘ |

**Backend Unit Tests:**
```
describe('enrollCourse')
  âœ“ ê¸°ë¡ ì—†ìŒ â†’ enrollments INSERT (ì‹ ê·œ ì‹ ì²­)
  âœ“ cancelled_at IS NOT NULL â†’ UPDATE(cancelled_at=NULL, enrolled_at=NOW()) (ì¬ì‹ ì²­)
  âœ— cancelled_at IS NULL (ì´ë¯¸ í™œì„±) â†’ failure(409, ALREADY_ENROLLED)
  âœ— course.status â‰  published â†’ failure(400, COURSE_NOT_PUBLISHED)
  âœ— roleâ‰ learner â†’ failure(403, FORBIDDEN)

describe('cancelEnrollment')
  âœ“ í™œì„± ìˆ˜ê°• â†’ UPDATE(cancelled_at=NOW())
  âœ— ìˆ˜ê°• ì´ë ¥ ì—†ìŒ â†’ failure(404, NOT_ENROLLED)
  âœ— ì´ë¯¸ ì·¨ì†Œëœ ìˆ˜ê°• â†’ failure(400, ALREADY_CANCELLED)
```

**Frontend QA Sheet:**
| ì‹œë‚˜ë¦¬ì˜¤ | ì‚¬ì „ ì¡°ê±´ | ë‹¨ê³„ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|---|---|
| ìµœì´ˆ ìˆ˜ê°•ì‹ ì²­ | role=learner, published ì½”ìŠ¤ | ì½”ìŠ¤ ìƒì„¸ â†’ "ìˆ˜ê°•ì‹ ì²­" í´ë¦­ | ë²„íŠ¼ "ìˆ˜ê°•ì·¨ì†Œ"ë¡œ ë³€ê²½, ë‚´ ì½”ìŠ¤ì— ì¶”ê°€ |
| ìˆ˜ê°•ì·¨ì†Œ | í™œì„± ìˆ˜ê°• ì¤‘ | "ìˆ˜ê°•ì·¨ì†Œ" í´ë¦­ | ë²„íŠ¼ "ì¬ì‹ ì²­"ìœ¼ë¡œ ë³€ê²½, ë‚´ ì½”ìŠ¤ì—ì„œ ì œê±° |
| ì¬ì‹ ì²­ | ì·¨ì†Œ ì´ë ¥ ì¡´ì¬ | "ì¬ì‹ ì²­" í´ë¦­ | ë²„íŠ¼ "ìˆ˜ê°•ì·¨ì†Œ"ë¡œ ë³€ê²½, ë‚´ ì½”ìŠ¤ì— ì¬ì¶”ê°€ |
| archived ì½”ìŠ¤ ì‹ ì²­ ì‹œë„ | archived ì½”ìŠ¤ | ìˆ˜ê°•ì‹ ì²­ ë²„íŠ¼ í´ë¦­ | ì—ëŸ¬ í† ìŠ¤íŠ¸ í‘œì‹œ, ì‹ ì²­ ì‹¤íŒ¨ |
| ê°•ì‚¬ ê³„ì • ì‹ ì²­ ì‹œë„ | role=instructor | ìˆ˜ê°•ì‹ ì²­ ë²„íŠ¼ í´ë¦­ | 403 ì—ëŸ¬ í† ìŠ¤íŠ¸ í‘œì‹œ |

---

### [Feature] assignments

> ìœ ì €í”Œë¡œìš° Â§4 ê³¼ì œ ì—´ëŒ, Â§9 ê³¼ì œ ê´€ë¦¬, Â§11 ê²Œì‹œ/ë§ˆê°

**íŒŒì¼ êµ¬ì¡°:**
```
src/features/assignments/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ route.ts    â† GET list, GET :id, POST, PUT :id, PATCH :id/status
â”‚   â”œâ”€â”€ service.ts  â† getAssignmentList(), getAssignmentDetail(), createAssignment(), updateAssignment(), updateAssignmentStatus()
â”‚   â”œâ”€â”€ schema.ts   â† AssignmentListQuerySchema, AssignmentResponseSchema, CreateAssignmentSchema
â”‚   â””â”€â”€ error.ts    â† ASSIGNMENT_NOT_FOUND, NOT_ASSIGNMENT_OWNER, INVALID_STATUS_TRANSITION, SUBMISSION_BLOCKED
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ assignment-list.tsx         â† ê³¼ì œ ëª©ë¡ (í•™ìŠµì/ê°•ì‚¬ ê³µí†µ)
â”‚   â”œâ”€â”€ assignment-detail.tsx       â† ê³¼ì œ ìƒì„¸ (ì„¤ëª…Â·ë§ˆê°Â·ë¹„ì¤‘Â·ì •ì±…)
â”‚   â”œâ”€â”€ assignment-form.tsx         â† ê°•ì‚¬ ìƒì„±/ìˆ˜ì • í¼
â”‚   â”œâ”€â”€ assignment-status-badge.tsx â† draft/published/closed ë°°ì§€
â”‚   â””â”€â”€ assignment-status-control.tsx â† ê°•ì‚¬ ìƒíƒœ ì „í™˜ ë²„íŠ¼
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useAssignmentListQuery.ts
â”‚   â”œâ”€â”€ useAssignmentDetailQuery.ts
â”‚   â”œâ”€â”€ useCreateAssignmentMutation.ts
â”‚   â”œâ”€â”€ useUpdateAssignmentMutation.ts
â”‚   â””â”€â”€ useUpdateAssignmentStatusMutation.ts
â””â”€â”€ lib/
    â””â”€â”€ dto.ts
```

**API ì—”ë“œí¬ì¸íŠ¸:**
| Method | Path | ì„¤ëª… | ê¶Œí•œ |
|---|---|---|---|
| `GET` | `/api/assignments?courseId=` | ê³¼ì œ ëª©ë¡ ì¡°íšŒ | withAuth + ìˆ˜ê°• ì—¬ë¶€ ê²€ì¦ |
| `GET` | `/api/assignments/:id` | ê³¼ì œ ìƒì„¸ | withAuth + ìˆ˜ê°• ì—¬ë¶€ ê²€ì¦ |
| `POST` | `/api/assignments` | ê³¼ì œ ìƒì„± | instructor + owner |
| `PUT` | `/api/assignments/:id` | ê³¼ì œ ìˆ˜ì • | instructor + owner |
| `PATCH` | `/api/assignments/:id/status` | ìƒíƒœ ì „í™˜ | instructor + owner |

**Backend Unit Tests:**
```
describe('getAssignmentList')
  âœ“ learner: status=published ê³¼ì œë§Œ ë°˜í™˜
  âœ“ instructor(ì†Œìœ ì): ì „ì²´ ìƒíƒœ(draft/published/closed) ë°˜í™˜
  âœ— ìˆ˜ê°• ì¤‘ì´ ì•„ë‹Œ learner â†’ failure(403, NOT_ENROLLED)

describe('getAssignmentDetail')
  âœ“ published ê³¼ì œ ë°˜í™˜
  âœ— draft ê³¼ì œë¥¼ learner ì¡°íšŒ â†’ failure(403, ASSIGNMENT_NOT_PUBLISHED)
  âœ— ìˆ˜ê°• ì¤‘ì´ ì•„ë‹Œ learner â†’ failure(403, NOT_ENROLLED)

describe('createAssignment')
  âœ“ ì •ìƒ ìƒì„± â†’ status=draft
  âœ— ì†Œìœ í•˜ì§€ ì•Šì€ courseId â†’ failure(403, NOT_COURSE_OWNER)

describe('updateAssignmentStatus')
  âœ“ draft â†’ published
  âœ“ published â†’ closed (ìˆ˜ë™ ê°•ì œ ë§ˆê°)
  âœ— closed â†’ published â†’ failure(400, INVALID_STATUS_TRANSITION)
  âœ— ì†Œìœ ì ì•„ë‹Œ ê²½ìš° â†’ failure(403, NOT_ASSIGNMENT_OWNER)
```

**Frontend QA Sheet:**
| ì‹œë‚˜ë¦¬ì˜¤ | ì‚¬ì „ ì¡°ê±´ | ë‹¨ê³„ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|---|---|
| ê³¼ì œ ëª©ë¡ ì§„ì… | ìˆ˜ê°• ì¤‘, published ê³¼ì œ 2ê°œ | /courses/my/[id]/assignments | ê³¼ì œ ì¹´ë“œ 2ê°œ í‘œì‹œ |
| closed ê³¼ì œ ì§„ì… | status=closed (ë˜ëŠ” due_at ê²½ê³¼) | ê³¼ì œ í´ë¦­ | "ì œì¶œ ë§ˆê°" í‘œì‹œ, ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™” |
| ê°•ì‚¬ ê³¼ì œ ìƒì„± | role=instructor | /instructor/assignments/new â†’ í¼ ì‘ì„± â†’ ì œì¶œ | ëª©ë¡ì— draft ìƒíƒœ í‘œì‹œ |
| ê°•ì‚¬ ê³¼ì œ ê²Œì‹œ | draft ê³¼ì œ ì¡´ì¬ | "ê²Œì‹œ" í´ë¦­ | status=published, í•™ìŠµì í™”ë©´ì— ë…¸ì¶œ |
| ê°•ì‚¬ ìˆ˜ë™ ë§ˆê° | published ê³¼ì œ ì¡´ì¬ | "ë§ˆê°" í´ë¦­ | status=closed, í•™ìŠµì ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™” |

---

### [Feature] submissions

> ìœ ì €í”Œë¡œìš° Â§5 ì œì¶œ/ì¬ì œì¶œ, Â§10 ì±„ì /í”¼ë“œë°±

**íŒŒì¼ êµ¬ì¡°:**
```
src/features/submissions/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ route.ts    â† POST, PUT :id (ì¬ì œì¶œ), PATCH :id/grade, GET assignments/:id/submissions
â”‚   â”œâ”€â”€ service.ts  â† submitAssignment(), resubmitAssignment(), gradeSubmission(), getSubmissionList()
â”‚   â”œâ”€â”€ schema.ts   â† SubmitRequestSchema, GradeRequestSchema, SubmissionResponseSchema
â”‚   â””â”€â”€ error.ts    â† SUBMISSION_NOT_FOUND, LATE_SUBMISSION_BLOCKED, RESUBMIT_NOT_ALLOWED, INVALID_SCORE
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ submission-form.tsx        â† text + link ì…ë ¥ í¼ (ì œì¶œ/ì¬ì œì¶œ ê³µí†µ)
â”‚   â”œâ”€â”€ submission-status.tsx      â† submitted/graded/resubmission_required ìƒíƒœ í‘œì‹œ
â”‚   â”œâ”€â”€ feedback-view.tsx          â† í•™ìŠµì: ì ìˆ˜Â·í”¼ë“œë°±Â·is_late í‘œì‹œ
â”‚   â”œâ”€â”€ grade-form.tsx             â† ê°•ì‚¬: ì ìˆ˜Â·í”¼ë“œë°±Â·ì¬ì œì¶œìš”ì²­ í¼
â”‚   â””â”€â”€ submission-table.tsx       â† ê°•ì‚¬: ì œì¶œë¬¼ í…Œì´ë¸” (í•„í„°: ë¯¸ì±„ì /ì§€ê°/ì¬ì œì¶œìš”ì²­)
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useSubmitMutation.ts
â”‚   â”œâ”€â”€ useResubmitMutation.ts
â”‚   â”œâ”€â”€ useGradeMutation.ts
â”‚   â”œâ”€â”€ useMySubmissionQuery.ts        â† í•™ìŠµì: ë‚´ ì œì¶œ ìƒíƒœ ì¡°íšŒ
â”‚   â””â”€â”€ useSubmissionListQuery.ts      â† ê°•ì‚¬: ì œì¶œë¬¼ ëª©ë¡ ì¡°íšŒ
â””â”€â”€ lib/
    â””â”€â”€ dto.ts
```

**API ì—”ë“œí¬ì¸íŠ¸:**
| Method | Path | ì„¤ëª… | ê¶Œí•œ |
|---|---|---|---|
| `POST` | `/api/submissions` | ê³¼ì œ ì œì¶œ | learner + ìˆ˜ê°• ì¤‘ |
| `PUT` | `/api/submissions/:id` | ì¬ì œì¶œ | learner + allow_resubmit=true |
| `PATCH` | `/api/submissions/:id/grade` | ì±„ì /í”¼ë“œë°±/ì¬ì œì¶œìš”ì²­ | instructor + owner |
| `GET` | `/api/assignments/:id/submissions` | ì œì¶œë¬¼ ëª©ë¡ (ê°•ì‚¬) | instructor + owner |

**Backend Unit Tests:**
```
describe('submitAssignment')
  âœ“ ë§ˆê° ì „ â†’ status=submitted, is_late=false
  âœ“ ë§ˆê° í›„ + allow_late=true â†’ status=submitted, is_late=true
  âœ— ë§ˆê° í›„ + allow_late=false â†’ failure(400, LATE_SUBMISSION_BLOCKED)
  âœ— assignment.status=closed â†’ failure(400, SUBMISSION_BLOCKED)
  âœ— ì´ë¯¸ ì œì¶œ + allow_resubmit=false â†’ failure(409, ALREADY_SUBMITTED)
  âœ— content_text ë¹ˆ ê°’ â†’ failure(400, VALIDATION_ERROR)
  âœ— ìˆ˜ê°• ì¤‘ì´ ì•„ë‹Œ learner â†’ failure(403, NOT_ENROLLED)

describe('resubmitAssignment')
  âœ“ allow_resubmit=true + status=resubmission_required â†’ UPDATE(content, submitted_at, status=submitted)
  âœ— allow_resubmit=false â†’ failure(400, RESUBMIT_NOT_ALLOWED)
  âœ— statusâ‰ resubmission_required â†’ failure(400, RESUBMIT_NOT_REQUESTED)
  âœ— assignment ë§ˆê° ìƒíƒœ â†’ failure(400, SUBMISSION_BLOCKED)

describe('gradeSubmission')
  âœ“ ì ìˆ˜ ì…ë ¥ â†’ status=graded, graded_at=NOW()
  âœ“ ì¬ì œì¶œ ìš”ì²­ â†’ status=resubmission_required, feedback ì €ì¥
  âœ— score > 100 ë˜ëŠ” < 0 â†’ failure(400, INVALID_SCORE)
  âœ— feedback ì—†ìŒ â†’ failure(400, FEEDBACK_REQUIRED)
  âœ— ì†Œìœ í•˜ì§€ ì•Šì€ ê³¼ì œ â†’ failure(403, NOT_ASSIGNMENT_OWNER)
```

**Frontend QA Sheet:**
| ì‹œë‚˜ë¦¬ì˜¤ | ì‚¬ì „ ì¡°ê±´ | ë‹¨ê³„ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|---|---|
| ì •ìƒ ì œì¶œ | ìˆ˜ê°• ì¤‘, ë§ˆê° ì „, ë¯¸ì œì¶œ | submit í˜ì´ì§€ â†’ í…ìŠ¤íŠ¸ ì…ë ¥ â†’ ì œì¶œ | ìƒíƒœ "ì œì¶œë¨"ìœ¼ë¡œ ë³€ê²½ |
| ì§€ê° ì œì¶œ (í—ˆìš©) | allow_late=true, ë§ˆê° í›„ | í…ìŠ¤íŠ¸ ì…ë ¥ â†’ ì œì¶œ | ìƒíƒœ "ì œì¶œë¨ (ì§€ê°)" í‘œì‹œ |
| ì§€ê° ì œì¶œ (ì°¨ë‹¨) | allow_late=false, ë§ˆê° í›„ | submit í˜ì´ì§€ ì ‘ê·¼ | ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”, ë§ˆê° ì•ˆë‚´ ë©”ì‹œì§€ |
| ì¬ì œì¶œ ìš”ì²­ ìˆ˜ì‹  | ê°•ì‚¬ê°€ resubmission_required ì„¤ì • | feedback í˜ì´ì§€ ì ‘ê·¼ | "ì¬ì œì¶œ ìš”ì²­" ìƒíƒœ + í”¼ë“œë°± í‘œì‹œ, ì¬ì œì¶œ ë²„íŠ¼ í™œì„±í™” |
| ì¬ì œì¶œ ì™„ë£Œ | resubmission_required ìƒíƒœ | submit í˜ì´ì§€ â†’ ì¬ì œì¶œ | ìƒíƒœ "ì œì¶œë¨"ìœ¼ë¡œ ë³€ê²½ |
| ê°•ì‚¬ ì±„ì  | role=instructor | submissions í…Œì´ë¸” â†’ ì œì¶œë¬¼ ì„ íƒ â†’ ì ìˆ˜Â·í”¼ë“œë°± ì…ë ¥ â†’ ì±„ì  | ìƒíƒœ "ì±„ì ì™„ë£Œ", í•™ìŠµì feedback í˜ì´ì§€ì— ë°˜ì˜ |
| ê°•ì‚¬ ì¬ì œì¶œ ìš”ì²­ | role=instructor | ì ìˆ˜ ë¯¸ì…ë ¥ â†’ "ì¬ì œì¶œ ìš”ì²­" í´ë¦­ + í”¼ë“œë°± ì…ë ¥ | ìƒíƒœ "ì¬ì œì¶œìš”ì²­", í•™ìŠµìì—ê²Œ ë°˜ì˜ |
| í”¼ë“œë°± ì—†ëŠ” ì±„ì  ì‹œë„ | role=instructor | í”¼ë“œë°± ë¹ˆì¹¸ìœ¼ë¡œ ì±„ì  ì œì¶œ | í”¼ë“œë°± í•„ìˆ˜ ì—ëŸ¬ í‘œì‹œ, ì œì¶œ ì°¨ë‹¨ |

---

### [Feature] learner

> ìœ ì €í”Œë¡œìš° Â§3 ëŒ€ì‹œë³´ë“œ, Â§6 ì„±ì /í”¼ë“œë°±

**íŒŒì¼ êµ¬ì¡°:**
```
src/features/learner/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ route.ts    â† GET /api/learner/dashboard, GET /api/learner/courses/:id/grades
â”‚   â”œâ”€â”€ service.ts  â† getLearnerDashboard(), getCourseGrades()
â”‚   â”œâ”€â”€ schema.ts   â† DashboardResponseSchema, GradesResponseSchema
â”‚   â””â”€â”€ error.ts    â† LEARNER_NOT_FOUND
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ learner-dashboard.tsx      â† ë‚´ ì½”ìŠ¤ + ì§„í–‰ë¥  + ë§ˆê° ì„ë°• + ìµœê·¼ í”¼ë“œë°±
â”‚   â”œâ”€â”€ course-progress-card.tsx   â† ì½”ìŠ¤ë³„ ì§„í–‰ë¥  ì¹´ë“œ
â”‚   â”œâ”€â”€ upcoming-assignments.tsx   â† ë§ˆê° ì„ë°• ê³¼ì œ ëª©ë¡
â”‚   â”œâ”€â”€ recent-feedback.tsx        â† ìµœê·¼ í”¼ë“œë°± ìš”ì•½
â”‚   â””â”€â”€ grades-view.tsx            â† ê³¼ì œë³„ ì ìˆ˜ + í˜„ì¬ ì„±ì (ê°€ì¤‘ í‰ê· )
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useLearnerDashboardQuery.ts
â”‚   â””â”€â”€ useCourseGradesQuery.ts
â””â”€â”€ lib/
    â””â”€â”€ dto.ts
```

**API ì—”ë“œí¬ì¸íŠ¸:**
| Method | Path | ì„¤ëª… | ê¶Œí•œ |
|---|---|---|---|
| `GET` | `/api/learner/dashboard` | ë‚´ ì½”ìŠ¤Â·ì§„í–‰ë¥ Â·ë§ˆê°ì„ë°•Â·ìµœê·¼í”¼ë“œë°± | learner |
| `GET` | `/api/learner/courses/:id/grades` | ì½”ìŠ¤ë³„ í˜„ì¬ ì„±ì  (ì±„ì ëœ ê³¼ì œ ê¸°ì¤€) | learner + ìˆ˜ê°• ì¤‘ |

**Backend Unit Tests:**
```
describe('getLearnerDashboard')
  âœ“ cancelled_at IS NULLì¸ ìˆ˜ê°• ì½”ìŠ¤ë§Œ ë°˜í™˜
  âœ“ ì§„í–‰ë¥ : COUNT(statusâ‰ resubmission_required) / COUNT(status=published assignments)
  âœ“ ë§ˆê° ì„ë°•: due_at ì˜¤ë¦„ì°¨ìˆœ, status=published, NOW() < due_at
  âœ“ ìµœê·¼ í”¼ë“œë°±: status=graded, graded_at ë‚´ë¦¼ì°¨ìˆœ
  âœ“ ìˆ˜ê°• ì½”ìŠ¤ ì—†ì„ ì‹œ ë¹ˆ ìƒíƒœ ë°˜í™˜

describe('getCourseGrades')
  âœ“ ì±„ì ëœ(graded) ê³¼ì œì˜ score Ã— weight í•©ì‚°
  âœ“ í˜„ì¬ ì„±ì : SUM(scoreÃ—weight) / SUM(weight) (gradedë§Œ)
  âœ“ ë¯¸ì±„ì  ê³¼ì œ ì§‘ê³„ ì œì™¸ (0ì  ì²˜ë¦¬ ì•ˆ í•¨)
  âœ“ ì±„ì ëœ ê³¼ì œ ì—†ì„ ì‹œ null ë°˜í™˜
  âœ— ìˆ˜ê°• ì¤‘ì´ ì•„ë‹Œ ê²½ìš° â†’ failure(403, NOT_ENROLLED)
```

**Frontend QA Sheet:**
| ì‹œë‚˜ë¦¬ì˜¤ | ì‚¬ì „ ì¡°ê±´ | ë‹¨ê³„ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|---|---|
| ëŒ€ì‹œë³´ë“œ ê¸°ë³¸ í‘œì‹œ | ìˆ˜ê°• ì½”ìŠ¤ 2ê°œ, ê° ê³¼ì œ ìˆìŒ | /courses/my ì ‘ê·¼ | ì½”ìŠ¤ ì¹´ë“œ 2ê°œ + ì§„í–‰ë¥  í‘œì‹œ |
| ì§„í–‰ë¥  ê³„ì‚° | ê³¼ì œ 4ê°œ ì¤‘ 2ê°œ graded | ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ | ì§„í–‰ë¥  50% í‘œì‹œ |
| ë§ˆê° ì„ë°• ê³¼ì œ | 24ì‹œê°„ ë‚´ ë§ˆê° ê³¼ì œ ì¡´ì¬ | ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ | "ë§ˆê° ì„ë°•" ì„¹ì…˜ì— í•´ë‹¹ ê³¼ì œ í‘œì‹œ |
| ì„±ì  í˜ì´ì§€ | ì±„ì ëœ ê³¼ì œ 2ê°œ | /courses/my/[id]/grades | ê³¼ì œë³„ ì ìˆ˜ + í˜„ì¬ ì„±ì (ê°€ì¤‘ í‰ê· ) í‘œì‹œ |
| ë¯¸ì±„ì  ê³¼ì œ ì„±ì  í‘œì‹œ | ê³¼ì œ 3ê°œ, ì±„ì  1ê°œ | grades í˜ì´ì§€ | ë¯¸ì±„ì  ê³¼ì œëŠ” "-" í‘œì‹œ, í˜„ì¬ ì„±ì ì€ ì±„ì ëœ 1ê°œ ê¸°ì¤€ ê³„ì‚° |
| ìˆ˜ê°• ì—†ëŠ” ëŒ€ì‹œë³´ë“œ | ìˆ˜ê°• ì½”ìŠ¤ 0ê°œ | /courses/my ì ‘ê·¼ | ë¹ˆ ìƒíƒœ + "ì½”ìŠ¤ íƒìƒ‰" ë²„íŠ¼ í‘œì‹œ |

---

### [Feature] instructor

> ìœ ì €í”Œë¡œìš° Â§7 ê°•ì‚¬ ëŒ€ì‹œë³´ë“œ

**íŒŒì¼ êµ¬ì¡°:**
```
src/features/instructor/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ route.ts    â† GET /api/instructor/dashboard
â”‚   â”œâ”€â”€ service.ts  â† getInstructorDashboard()
â”‚   â”œâ”€â”€ schema.ts   â† InstructorDashboardResponseSchema
â”‚   â””â”€â”€ error.ts    â† INSTRUCTOR_NOT_FOUND
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ instructor-dashboard.tsx   â† ë‚´ ì½”ìŠ¤ ëª©ë¡ + ì±„ì  ëŒ€ê¸° ìˆ˜ + ìµœê·¼ ì œì¶œë¬¼
â”‚   â”œâ”€â”€ pending-grade-summary.tsx  â† ì±„ì  ëŒ€ê¸° ìˆ˜ ìš”ì•½
â”‚   â””â”€â”€ recent-submissions-list.tsx â† ìµœê·¼ ì œì¶œë¬¼ ëª©ë¡
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useInstructorDashboardQuery.ts
â””â”€â”€ lib/
    â””â”€â”€ dto.ts
```

**API ì—”ë“œí¬ì¸íŠ¸:**
| Method | Path | ì„¤ëª… | ê¶Œí•œ |
|---|---|---|---|
| `GET` | `/api/instructor/dashboard` | ë‚´ ì½”ìŠ¤Â·ì±„ì ëŒ€ê¸°ìˆ˜Â·ìµœê·¼ì œì¶œë¬¼ | instructor |

**Backend Unit Tests:**
```
describe('getInstructorDashboard')
  âœ“ instructor_idë¡œ ë‚´ ì½”ìŠ¤ ëª©ë¡ ë°˜í™˜ (ëª¨ë“  status)
  âœ“ ì±„ì  ëŒ€ê¸° ìˆ˜: submissions.status=submitted COUNT
  âœ“ ìµœê·¼ ì œì¶œë¬¼: submitted_at DESC ìƒìœ„ 10ê±´
  âœ“ ì½”ìŠ¤ ì—†ì„ ì‹œ ë¹ˆ ìƒíƒœ ë°˜í™˜
  âœ— roleâ‰ instructor â†’ failure(403, FORBIDDEN)
```

**Frontend QA Sheet:**
| ì‹œë‚˜ë¦¬ì˜¤ | ì‚¬ì „ ì¡°ê±´ | ë‹¨ê³„ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|---|---|
| ëŒ€ì‹œë³´ë“œ ê¸°ë³¸ í‘œì‹œ | ì½”ìŠ¤ 3ê°œ, ì œì¶œë¬¼ 5ê°œ(ë¯¸ì±„ì  2ê°œ) | /instructor/dashboard | ì½”ìŠ¤ ëª©ë¡ + ì±„ì  ëŒ€ê¸° 2ê±´ + ìµœê·¼ ì œì¶œë¬¼ 5ê°œ í‘œì‹œ |
| ì±„ì  ëŒ€ê¸° í´ë¦­ | ì±„ì  ëŒ€ê¸° ì¹´ìš´íŠ¸ í‘œì‹œ ì¤‘ | ì¹´ìš´íŠ¸ í´ë¦­ | ë¯¸ì±„ì  ì œì¶œë¬¼ë§Œ í•„í„°ëœ ì œì¶œë¬¼ í…Œì´ë¸”ë¡œ ì´ë™ |
| ì½”ìŠ¤ ì—†ëŠ” ê°•ì‚¬ | ì½”ìŠ¤ 0ê°œ | /instructor/dashboard | "ì½”ìŠ¤ ë§Œë“¤ê¸°" ë¹ˆ ìƒíƒœ í‘œì‹œ |

---

### [Feature] reports

> ìœ ì €í”Œë¡œìš° Â§12 ì‹ ê³  ì ‘ìˆ˜Â·ì²˜ë¦¬

**íŒŒì¼ êµ¬ì¡°:**
```
src/features/reports/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ route.ts    â† POST /api/reports, GET /api/reports, PATCH /api/reports/:id
â”‚   â”œâ”€â”€ service.ts  â† createReport(), getReportList(), updateReport()
â”‚   â”œâ”€â”€ schema.ts   â† CreateReportSchema, UpdateReportSchema, ReportResponseSchema
â”‚   â””â”€â”€ error.ts    â† REPORT_NOT_FOUND, INVALID_STATUS_TRANSITION
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ report-form.tsx        â† ì‹ ê³  ì ‘ìˆ˜ í¼ (target_type, reason, content)
â”‚   â””â”€â”€ report-table.tsx       â† ìš´ì˜ì: ì‹ ê³  ëª©ë¡ + ìƒíƒœ í•„í„°
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useCreateReportMutation.ts
â”‚   â”œâ”€â”€ useReportListQuery.ts
â”‚   â””â”€â”€ useUpdateReportMutation.ts
â””â”€â”€ lib/
    â””â”€â”€ dto.ts
```

**API ì—”ë“œí¬ì¸íŠ¸:**
| Method | Path | ì„¤ëª… | ê¶Œí•œ |
|---|---|---|---|
| `POST` | `/api/reports` | ì‹ ê³  ì ‘ìˆ˜ | withAuth |
| `GET` | `/api/reports` | ì‹ ê³  ëª©ë¡ ì¡°íšŒ | operator |
| `PATCH` | `/api/reports/:id` | ìƒíƒœÂ·ì•¡ì…˜ ì²˜ë¦¬ | operator |

**Backend Unit Tests:**
```
describe('createReport')
  âœ“ ì •ìƒ ì‹ ê³  ì ‘ìˆ˜ â†’ status=received
  âœ— ìœ íš¨í•˜ì§€ ì•Šì€ target_type â†’ failure(400, VALIDATION_ERROR)
  âœ— reason ë¹ˆ ê°’ â†’ failure(400, VALIDATION_ERROR)

describe('updateReport')
  âœ“ received â†’ investigating
  âœ“ investigating â†’ resolved + action ì§€ì •
  âœ— resolved â†’ received (ì—­ë°©í–¥) â†’ failure(400, INVALID_STATUS_TRANSITION)
  âœ— roleâ‰ operator â†’ failure(403, FORBIDDEN)
```

**Frontend QA Sheet:**
| ì‹œë‚˜ë¦¬ì˜¤ | ì‚¬ì „ ì¡°ê±´ | ë‹¨ê³„ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|---|---|
| ì½”ìŠ¤ ì‹ ê³  | ë¡œê·¸ì¸, ì½”ìŠ¤ ìƒì„¸ í˜ì´ì§€ | "ì‹ ê³ " í´ë¦­ â†’ ì‚¬ìœ Â·ë‚´ìš© ì‘ì„± â†’ ì œì¶œ | "ì‹ ê³  ì ‘ìˆ˜ë¨" í† ìŠ¤íŠ¸ í‘œì‹œ |
| ìš´ì˜ì ì‹ ê³  ëª©ë¡ | role=operator | /operator/reports | ì „ì²´ ì‹ ê³  ëª©ë¡ í‘œì‹œ |
| ìš´ì˜ì ìƒíƒœ ì²˜ë¦¬ | received ì‹ ê³  ì¡´ì¬ | ì‹ ê³  ì„ íƒ â†’ "ì¡°ì‚¬ ì¤‘"ìœ¼ë¡œ ë³€ê²½ | ìƒíƒœ investigating ì—…ë°ì´íŠ¸ |

---

### [Feature] metadata

> ìœ ì €í”Œë¡œìš° Â§12 ì¹´í…Œê³ ë¦¬Â·ë‚œì´ë„ ê´€ë¦¬

**íŒŒì¼ êµ¬ì¡°:**
```
src/features/metadata/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ route.ts    â† CRUD for /api/metadata/categories, /api/metadata/difficulties
â”‚   â”œâ”€â”€ service.ts  â† getCategoryList(), createCategory(), updateCategory(), getDifficultyList(), createDifficulty(), updateDifficulty()
â”‚   â”œâ”€â”€ schema.ts   â† CategorySchema, DifficultySchema
â”‚   â””â”€â”€ error.ts    â† DUPLICATE_NAME, METADATA_IN_USE
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ category-manager.tsx     â† ì¹´í…Œê³ ë¦¬ ëª©ë¡ + ì¶”ê°€/ë¹„í™œì„±í™”
â”‚   â””â”€â”€ difficulty-manager.tsx   â† ë‚œì´ë„ ëª©ë¡ + ì¶”ê°€/ë¹„í™œì„±í™”
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useCategoryListQuery.ts
â”‚   â”œâ”€â”€ useCreateCategoryMutation.ts
â”‚   â”œâ”€â”€ useUpdateCategoryMutation.ts
â”‚   â”œâ”€â”€ useDifficultyListQuery.ts
â”‚   â”œâ”€â”€ useCreateDifficultyMutation.ts
â”‚   â””â”€â”€ useUpdateDifficultyMutation.ts
â””â”€â”€ lib/
    â””â”€â”€ dto.ts
```

**API ì—”ë“œí¬ì¸íŠ¸:**
| Method | Path | ì„¤ëª… | ê¶Œí•œ |
|---|---|---|---|
| `GET` | `/api/metadata/categories` | ì¹´í…Œê³ ë¦¬ ëª©ë¡ | public (is_active=true) / operator (ì „ì²´) |
| `POST` | `/api/metadata/categories` | ì¹´í…Œê³ ë¦¬ ìƒì„± | operator |
| `PATCH` | `/api/metadata/categories/:id` | ë¹„í™œì„±í™”/í™œì„±í™” | operator |
| `GET` | `/api/metadata/difficulties` | ë‚œì´ë„ ëª©ë¡ | public / operator |
| `POST` | `/api/metadata/difficulties` | ë‚œì´ë„ ìƒì„± | operator |
| `PATCH` | `/api/metadata/difficulties/:id` | ë¹„í™œì„±í™”/í™œì„±í™” | operator |

**Backend Unit Tests:**
```
describe('createCategory')
  âœ“ ì •ìƒ ìƒì„± â†’ is_active=true
  âœ— ì¤‘ë³µ ì´ë¦„ â†’ failure(409, DUPLICATE_NAME)
  âœ— roleâ‰ operator â†’ failure(403, FORBIDDEN)

describe('updateCategory (is_active)')
  âœ“ ì‚¬ìš© ì¤‘ì¸ ì¹´í…Œê³ ë¦¬ ë¹„í™œì„±í™” â†’ is_active=false (ì½”ìŠ¤ì—ëŠ” ìœ ì§€, ì‹ ê·œ ì„ íƒ ë¶ˆê°€)
  âœ“ ë¹„í™œì„± ì¹´í…Œê³ ë¦¬ ì¬í™œì„±í™” â†’ is_active=true
  âœ— roleâ‰ operator â†’ failure(403, FORBIDDEN)
```

**Frontend QA Sheet:**
| ì‹œë‚˜ë¦¬ì˜¤ | ì‚¬ì „ ì¡°ê±´ | ë‹¨ê³„ | ê¸°ëŒ€ ê²°ê³¼ |
|---|---|---|---|
| ì¹´í…Œê³ ë¦¬ ìƒì„± | role=operator | "ì¹´í…Œê³ ë¦¬ ì¶”ê°€" â†’ ì´ë¦„ ì…ë ¥ â†’ ì €ì¥ | ëª©ë¡ì— ì‹ ê·œ í•­ëª© í‘œì‹œ |
| ì¤‘ë³µ ì´ë¦„ ì…ë ¥ | ë™ì¼ ì´ë¦„ ì¹´í…Œê³ ë¦¬ ì¡´ì¬ | ë™ì¼ ì´ë¦„ìœ¼ë¡œ ìƒì„± ì‹œë„ | ì¤‘ë³µ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ |
| ì¹´í…Œê³ ë¦¬ ë¹„í™œì„±í™” | ì‚¬ìš© ì¤‘ì¸ ì¹´í…Œê³ ë¦¬ | "ë¹„í™œì„±í™”" í´ë¦­ | is_active=false, ì½”ìŠ¤ ìƒì„± í¼ì—ì„œ ë¯¸í‘œì‹œ |
| ì½”ìŠ¤ í•„í„°ì—ì„œ í™œì„± ì¹´í…Œê³ ë¦¬ë§Œ í‘œì‹œ | ë¹„í™œì„± ì¹´í…Œê³ ë¦¬ ì¡´ì¬ | /courses í•„í„° ë°” í™•ì¸ | is_active=trueì¸ ì¹´í…Œê³ ë¦¬ë§Œ í‘œì‹œ |

---

## 4. êµ¬í˜„ ìˆœì„œ ê¶Œì¥

```
1ë‹¨ê³„ (ì¸í”„ë¼)
  withAuth middleware
  requireRole guard
  useRoleGuard hook
  src/constants/auth.ts ê²½ë¡œ ìƒìˆ˜ ì¶”ê°€ (onboarding, instructor/*, courses/my/*)

2ë‹¨ê³„ (ì‚¬ìš©ì ê¸°ë°˜)
  profiles feature (ì˜¨ë³´ë”©)

3ë‹¨ê³„ (í•µì‹¬ ë©”íƒ€ë°ì´í„°)
  metadata feature (ì¹´í…Œê³ ë¦¬Â·ë‚œì´ë„: courses í¼ì—ì„œ í•„ìš”)

4ë‹¨ê³„ (ì½”ìŠ¤ ë„ë©”ì¸)
  courses feature
  enrollments feature

5ë‹¨ê³„ (ê³¼ì œÂ·ì œì¶œ ë„ë©”ì¸)
  assignments feature
  submissions feature

6ë‹¨ê³„ (ì§‘ê³„ ë·°)
  learner feature (dashboard + grades)
  instructor feature (dashboard)

7ë‹¨ê³„ (ìš´ì˜)
  reports feature
```
</file>

<file path="prd.md">
# PRD

## 1. ì œí’ˆ ê°œìš”

ê°•ì‚¬ê°€ ì½”ìŠ¤ë¥¼ ê°œì„¤Â·ìš´ì˜í•˜ê³ , í•™ìŠµìê°€ ìˆ˜ê°•Â·ê³¼ì œ ì œì¶œÂ·í”¼ë“œë°± ìˆ˜ë ¹ê¹Œì§€ í•  ìˆ˜ ìˆëŠ” ê²½ëŸ‰ LMS í˜•íƒœì˜ ì›¹ ì•±.
**í•µì‹¬ ëª©í‘œ**ëŠ” (1) ì—­í•  ê¸°ë°˜ í”Œë¡œìš°ì˜ ì •í™•í•œ ê°€ë“œ, (2) ë§ˆê°/ì§€ê°/ì¬ì œì¶œ ë“± **ìƒíƒœ ê¸°ë°˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë£°** êµ¬í˜„, (3) ë¬¸ì„œ ì£¼ë„(Usecase) ê°œë°œ í”„ë¡œì„¸ìŠ¤ì˜ ì‹¤ì „ ì ìš©ì´ë‹¤. ì¸ì¦ì€ **Supabase Auth** ê¸°ë°˜ìœ¼ë¡œ ìš´ì˜.

## 2. Stakeholders

* **Learner**: ì½”ìŠ¤ íƒìƒ‰/ìˆ˜ê°•/ê³¼ì œ ì œì¶œ/ì ìˆ˜Â·í”¼ë“œë°± í™•ì¸
* **Instructor**: ì½”ìŠ¤Â·ê³¼ì œ ê°œì„¤/ê²Œì‹œ, ì œì¶œë¬¼ ì±„ì /í”¼ë“œë°±/ì¬ì œì¶œ ê´€ë¦¬
* **ìš´ì˜(ì˜µì…˜)**: ë¶€ì •í–‰ìœ„/ì‹ ê³  ì²˜ë¦¬, ë©”íƒ€ë°ì´í„° ê´€ë¦¬

## 3. í¬í•¨ í˜ì´ì§€

1. **í™ˆ/ì¹´íƒˆë¡œê·¸**

   * ì½”ìŠ¤ ë¦¬ìŠ¤íŠ¸(ê²€ìƒ‰/í•„í„°: ì¹´í…Œê³ ë¦¬, ë‚œì´ë„, ìµœì‹ /ì¸ê¸° ì •ë ¬)
   
2. **ì¸ì¦ & ì˜¨ë³´ë”©**

   * ì´ë©”ì¼ íšŒì›ê°€ì…/ë¡œê·¸ì¸
   * ì—­í•  ì„ íƒ(ê°•ì‚¬/í•™ìŠµì) ë° ìµœì†Œ í”„ë¡œí•„
   
3. **ì½”ìŠ¤ ìƒì„¸**

   * ì†Œê°œ/ì»¤ë¦¬í˜ëŸ¼/ê°•ì‚¬ ì •ë³´/ìˆ˜ê°•ìƒ ìˆ˜/í‰ê·  í‰ì (ëª¨ì˜)
   * ìˆ˜ê°•ì‹ ì²­/ì·¨ì†Œ/**ì¬ì‹ ì²­** (ì·¨ì†Œ ì´ë ¥ì´ ìˆëŠ” ê²½ìš° ìƒíƒœë§Œ í™œì„±í™”, ì¤‘ë³µ ë°ì´í„° ìƒì„± ë°©ì§€)
   
4. **Learner ëŒ€ì‹œë³´ë“œ**

   * ë‚´ ì½”ìŠ¤, ì§„í–‰ë¥ , ë§ˆê° ì„ë°• ê³¼ì œ, ìµœê·¼ í”¼ë“œë°±
   
5. **Assignment ìƒì„¸(í•™ìŠµì)**

   * ìš”êµ¬ì‚¬í•­/ë§ˆê°/ì ìˆ˜ ë¹„ì¤‘/ì§€ê° ì •ì±…
   * ì œì¶œ/ì¬ì œì¶œ, ìƒíƒœ í‘œì‹œ(ì œì¶œë¨/ì§€ê°/ì±„ì ì™„ë£Œ/ì¬ì œì¶œìš”ì²­)
   
6. **ì„±ì /í”¼ë“œë°±(í•™ìŠµì)**

   * ê³¼ì œë³„ ì ìˆ˜, **í˜„ì¬ ì„±ì (ì±„ì  ì™„ë£Œëœ ê³¼ì œ ê¸°ì¤€ ê°€ì¤‘ í‰ê· )** í‘œì‹œ
   
7. **Instructor ëŒ€ì‹œë³´ë“œ**

   * ë‚´ ì½”ìŠ¤, ì±„ì  ëŒ€ê¸° ìˆ˜, ìµœê·¼ ì œì¶œë¬¼
   
8. **ì½”ìŠ¤ ê´€ë¦¬(ê°•ì‚¬)**

   * ìƒì„±/ìˆ˜ì •/ìƒíƒœ ì „í™˜(draft/published/archived)
   
9. **ê³¼ì œ ê´€ë¦¬(ê°•ì‚¬)**

   * ìƒì„±/ìˆ˜ì •/ê²Œì‹œ(draft/published/**manually_closed**). â€» ë‚ ì§œì— ë”°ë¥¸ ìë™ ë§ˆê°ì€ ì‹œìŠ¤í…œ ìƒíƒœ(due_at ê²½ê³¼)ë¡œ ì²˜ë¦¬
   * ì œì¶œë¬¼ í…Œì´ë¸”(í•„í„°: ë¯¸ì±„ì /ì§€ê°/ì¬ì œì¶œìš”ì²­)
   * ì±„ì /í”¼ë“œë°±/ì¬ì œì¶œ ìš”ì²­

## 4. ì‚¬ìš©ì ì—¬ì • (User Journey)

### 4.1 Learner ì—¬ì •

1. íšŒì›ê°€ì…/ë¡œê·¸ì¸ â†’ ì—­í• =Learner ì„ íƒ/í”„ë¡œí•„
2. ì½”ìŠ¤ ì¹´íƒˆë¡œê·¸ íƒìƒ‰ â†’ ì½”ìŠ¤ ìƒì„¸ â†’ ìˆ˜ê°•ì‹ ì²­
3. ëŒ€ì‹œë³´ë“œì—ì„œ ë§ˆê° ì„ë°• ê³¼ì œ í™•ì¸ â†’ ê³¼ì œ ìƒì„¸
4. ì œì¶œ(í…ìŠ¤íŠ¸/ë§í¬/íŒŒì¼ ëª¨ì˜) â†’ ìƒíƒœ ë³€í™”(ì œì¶œë¨/ì§€ê°)
5. ì„±ì /í”¼ë“œë°± í™•ì¸ â†’ í•„ìš” ì‹œ ì¬ì œì¶œ

### 4.2 Instructor ì—¬ì •

1. íšŒì›ê°€ì…/ë¡œê·¸ì¸ â†’ ì—­í• =Instructor ì„ íƒ/í”„ë¡œí•„
2. ì½”ìŠ¤ ìƒì„±(draft) â†’ published ì „í™˜
3. ê³¼ì œ ìƒì„±(draft) â†’ published(ê²Œì‹œ) â†’ ì œì¶œë¬¼ ìˆ˜ì§‘
4. ì œì¶œë¬¼ ê²€í† /ì±„ì  â†’ í”¼ë“œë°±/ì¬ì œì¶œ ìš”ì²­
5. ë§ˆê° ì‹œ closed â†’ ì„±ì  ì •ë¦¬

## 5. IA (Tree)

```
/ (Home)
â”œâ”€ /auth/(signin|signup)
â”œâ”€ /onboarding (role=learner|instructor)
â”œâ”€ /courses
â”‚  â”œâ”€ /[courseId]
â”‚  â”‚  â”œâ”€ /about
â”‚  â”‚  â”œâ”€ /curriculum
â”‚  â”‚  â””â”€ /enroll
â”‚  â””â”€ /my (learner)
â”‚     â””â”€ /[courseId]
â”‚        â”œâ”€ /assignments
â”‚        â”‚  â””â”€ /[assignmentId]
â”‚        â”‚     â”œâ”€ /submit
â”‚        â”‚     â””â”€ /feedback
â”‚        â””â”€ /grades
â””â”€ /instructor
   â”œâ”€ /dashboard
   â”œâ”€ /courses
   â”‚  â”œâ”€ /new
   â”‚  â””â”€ /[courseId]/edit
   â””â”€ /assignments
      â”œâ”€ /new
      â””â”€ /[assignmentId]/submissions
```
</file>

<file path="workflow.md">
# Userflow

## 1. ì—­í•  ì„ íƒ & ì˜¨ë³´ë”©

**ì…ë ¥**

* ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸
* ì—­í•  ì„ íƒ (Learner / Instructor)
* ê³µí†µ í”„ë¡œí•„ ìµœì†Œ ì…ë ¥: ì´ë¦„, íœ´ëŒ€í°ë²ˆí˜¸, ì•½ê´€ë™ì˜

**ì²˜ë¦¬**

* Auth ê³„ì • ìƒì„± (Supabase)
* ì—­í•  ì €ì¥ (`role=learner | instructor`)
* í”„ë¡œí•„ ë ˆì½”ë“œ ìƒì„±
* ì•½ê´€ ì´ë ¥ ì €ì¥
* ê¸°ë³¸ ê¶Œí•œ í† í° ë°œê¸‰

**ì¶œë ¥**

* Learner â†’ ì½”ìŠ¤ ì¹´íƒˆë¡œê·¸ ì²« ì§„ì…
* Instructor â†’ ëŒ€ì‹œë³´ë“œ ì²« ì§„ì…

---

## 2. ì½”ìŠ¤ íƒìƒ‰ & ìˆ˜ê°•ì‹ ì²­/ì·¨ì†Œ (Learner)

**ì…ë ¥**

* ê²€ìƒ‰ì–´, í•„í„°(ì¹´í…Œê³ ë¦¬, ë‚œì´ë„), ì •ë ¬(ìµœì‹ ìˆœ/ì¸ê¸°ìˆœ)
* ì½”ìŠ¤ ìƒì„¸ ì§„ì…
* â€œìˆ˜ê°•ì‹ ì²­â€ / â€œìˆ˜ê°•ì·¨ì†Œâ€ ë²„íŠ¼ í´ë¦­

**ì²˜ë¦¬ (ì •ì±…)**

* ì½”ìŠ¤ ìƒíƒœ `published`ë§Œ ì‹ ì²­ ê°€ëŠ¥
* `enrollments` í…Œì´ë¸” ì¡°íšŒ:
  * ê¸°ë¡ ì—†ìŒ â†’ INSERT (ì‹ ê·œ ì‹ ì²­)
  * ê¸°ë¡ ìˆìŒ(`cancelled_at IS NOT NULL`) â†’ UPDATE (`cancelled_at = NULL, enrolled_at = NOW()`) (ì¬ì‹ ì²­)
  * ê¸°ë¡ ìˆìŒ(`cancelled_at IS NULL`) â†’ ì—ëŸ¬ (ì´ë¯¸ ìˆ˜ê°• ì¤‘)
* ìˆ˜ê°•ì·¨ì†Œ ì‹œ ëŒ€ì‹œë³´ë“œ/ë‚´ ì½”ìŠ¤ì—ì„œ ì œê±°, ì„±ì  ì§‘ê³„ ì œì™¸

**ì¶œë ¥**

* ì‹ ì²­/ì·¨ì†Œ ì„±ê³µ/ì‹¤íŒ¨ í”¼ë“œë°±
* Learner ëŒ€ì‹œë³´ë“œ ë°˜ì˜

---

## 3. Learner ëŒ€ì‹œë³´ë“œ

**ì…ë ¥**

* ëŒ€ì‹œë³´ë“œ ì ‘ê·¼

**ì²˜ë¦¬ (ì •ì±…)**

* ë‚´ ì½”ìŠ¤ ëª©ë¡ í‘œì‹œ
* ì§„í–‰ë¥  ê³„ì‚°(ì™„ë£Œ ê³¼ì œ ìˆ˜/ì „ì²´ ê³¼ì œ ìˆ˜)
* ë§ˆê° ì„ë°• ê³¼ì œ í‘œì‹œ
* ìµœê·¼ í”¼ë“œë°± ìš”ì•½ í‘œì‹œ

**ì¶œë ¥**

* ë‚´ ì½”ìŠ¤, ì§„í–‰ë¥ , ë§ˆê° ì„ë°• ê³¼ì œ, ìµœê·¼ í”¼ë“œë°±

---

## 4. ê³¼ì œ ìƒì„¸ ì—´ëŒ (Learner)

**ì…ë ¥**

* ë‚´ ì½”ìŠ¤ â†’ Assignment ëª©ë¡ â†’ Assignment ìƒì„¸ í´ë¦­

**ì²˜ë¦¬ (ì •ì±…)**

* Assignment ìƒíƒœ `published`ë§Œ ì—´ëŒ ê°€ëŠ¥
* `closed` ìƒíƒœë©´ ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”
* ë³¸ì¸ ì½”ìŠ¤ ë“±ë¡ ì—¬ë¶€ ê²€ì¦

**ì¶œë ¥**

* ê³¼ì œ ì„¤ëª…, ë§ˆê°ì¼, ì ìˆ˜ ë¹„ì¤‘, ì •ì±…(ì§€ê° í—ˆìš© ì—¬ë¶€/ì¬ì œì¶œ í—ˆìš© ì—¬ë¶€)
* ì œì¶œ UI(text+link ì…ë ¥ë€)

---

## 5. ê³¼ì œ ì œì¶œ/ì¬ì œì¶œ (Learner)

**ì…ë ¥**

* Text í•„ë“œ(í•„ìˆ˜) + Link í•„ë“œ(ì„ íƒ, URL í˜•ì‹)
* ì œì¶œ ë²„íŠ¼ í´ë¦­

**ì²˜ë¦¬ (ì •ì±…)**

* ë§ˆê°ì¼ ì „: ì •ìƒ ì œì¶œ (`status=submitted`)
* ë§ˆê°ì¼ í›„:

  * `ì§€ê° í—ˆìš© = true` â†’ `status=submitted`, `late=true`
  * `ì§€ê° í—ˆìš© = false` â†’ ì œì¶œ ì°¨ë‹¨
* ì¬ì œì¶œ í—ˆìš© ì—¬ë¶€ ê²€ì¦
* í…ìŠ¤íŠ¸/ë§í¬ ìœ íš¨ì„± ê²€ì‚¬

**ì¶œë ¥**

* ì œì¶œ ì„±ê³µ/ì‹¤íŒ¨ ë©”ì‹œì§€
* Learner í™”ë©´ì—ì„œ ìƒíƒœ ì—…ë°ì´íŠ¸

---

## 6. ì„±ì  & í”¼ë“œë°± ì—´ëŒ (Learner)

**ì…ë ¥**

* ì„±ì  í˜ì´ì§€ ì ‘ê·¼

**ì²˜ë¦¬ (ì •ì±…)**

* ë³¸ì¸ ì œì¶œë¬¼ë§Œ ì¡°íšŒ ê°€ëŠ¥
* ê³¼ì œë³„ ì ìˆ˜, ì§€ê° ì—¬ë¶€, ì¬ì œì¶œ ì—¬ë¶€, í”¼ë“œë°± í‘œì‹œ
* ì½”ìŠ¤ë³„ í˜„ì¬ ì„±ì  ê³„ì‚° (ì±„ì ëœ ê³¼ì œë§Œ ì§‘ê³„)
  * ë¶„ì: SUM(score Ã— weight) (status = 'graded'ì¸ ê³¼ì œë§Œ)
  * ë¶„ëª¨: SUM(weight) (status = 'graded'ì¸ ê³¼ì œë§Œ)
  * â€» ë¯¸ì œì¶œ/ë¯¸ì±„ì  ê³¼ì œëŠ” 0ì  ì²˜ë¦¬í•˜ì§€ ì•Šê³  ì§‘ê³„ì—ì„œ ì œì™¸

**ì¶œë ¥**

* ê³¼ì œë³„ ì ìˆ˜/ìƒíƒœ
* ì½”ìŠ¤ ì´ì  ìš”ì•½

---

## 7. Instructor ëŒ€ì‹œë³´ë“œ

**ì…ë ¥**

* ëŒ€ì‹œë³´ë“œ ì ‘ê·¼

**ì²˜ë¦¬ (ì •ì±…)**

* ë‚´ ì½”ìŠ¤ ëª©ë¡ í‘œì‹œ(draft/published/archived)
* ì±„ì  ëŒ€ê¸° ìˆ˜ í‘œì‹œ
* ìµœê·¼ ì œì¶œë¬¼ í‘œì‹œ

**ì¶œë ¥**

* ë‚´ ì½”ìŠ¤, ì±„ì  ëŒ€ê¸°, ìµœê·¼ ì œì¶œë¬¼

---

## 8. ì½”ìŠ¤ ê´€ë¦¬ (Instructor)

**ì…ë ¥**

* ì½”ìŠ¤ ìƒì„±/ìˆ˜ì • (ì œëª©, ì†Œê°œ, ì¹´í…Œê³ ë¦¬, ë‚œì´ë„, ì»¤ë¦¬í˜ëŸ¼)
* ìƒíƒœ ì „í™˜(draft/published/archived)

**ì²˜ë¦¬ (ì •ì±…)**

* ì†Œìœ ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
* `draft â†’ published` ì „í™˜ ì‹œ ê³µê°œ
* `published â†’ archived` ì „í™˜ ì‹œ ì‹ ê·œ ìˆ˜ê°• ì°¨ë‹¨

**ì¶œë ¥**

* ìƒì„±/ìˆ˜ì •/ìƒíƒœ ì „í™˜ ê²°ê³¼ ë°˜ì˜

---

## 9. ê³¼ì œ ê´€ë¦¬ (Instructor)

**ì…ë ¥**

* ê³¼ì œ ìƒì„±/ìˆ˜ì • (ì œëª©, ì„¤ëª…, ë§ˆê°ì¼, ì ìˆ˜ ë¹„ì¤‘, ì§€ê°/ì¬ì œì¶œ ì •ì±…)
* ìƒíƒœ ì „í™˜(draft/published/closed)

**ì²˜ë¦¬ (ì •ì±…)**

* ì†Œìœ  ì½”ìŠ¤ë§Œ ì ‘ê·¼ ê°€ëŠ¥
* ê²Œì‹œ ì‹œ í•™ìŠµì ë…¸ì¶œ
* ë§ˆê°ì¼ ì´í›„ ìë™ `closed`
* ì œì¶œë¬¼ í…Œì´ë¸”: í•„í„°(ë¯¸ì±„ì /ì§€ê°/ì¬ì œì¶œìš”ì²­)

**ì¶œë ¥**

* Assignment ëª©ë¡ ê°±ì‹ 
* Learner í™”ë©´ ë°˜ì˜

---

## 10. ì œì¶œë¬¼ ì±„ì  & í”¼ë“œë°± (Instructor)

**ì…ë ¥**

* ì œì¶œë¬¼ ì„ íƒ
* ì ìˆ˜(0~100), í”¼ë“œë°± ì‘ì„±
* â€œì¬ì œì¶œ ìš”ì²­â€ ë²„íŠ¼ ì„ íƒ ê°€ëŠ¥

**ì²˜ë¦¬ (ì •ì±…)**

* ì ìˆ˜ ë²”ìœ„ ì œí•œ
* í”¼ë“œë°± í•„ìˆ˜
* ì ìˆ˜ ì…ë ¥ â†’ `graded`
* ì¬ì œì¶œ ìš”ì²­ â†’ `resubmission_required`

**ì¶œë ¥**

* Learnerì—ê²Œ í”¼ë“œë°± í‘œì‹œ
* Learner ëŒ€ì‹œë³´ë“œ ê³¼ì œ ìƒíƒœ ë°˜ì˜

---

## 11. Assignment ê²Œì‹œ/ë§ˆê° (Instructor)

**ì…ë ¥**

* ê³¼ì œ ê²Œì‹œ/ë§ˆê°

**ì²˜ë¦¬ (ì •ì±…)**

* `draft â†’ published` ì „í™˜ ì‹œ í•™ìŠµì ë…¸ì¶œ
* ìœ íš¨ ìƒíƒœ(Effective Status) íŒë³„:
  * DB `status = 'closed'` â†’ ë§ˆê° (ê°•ì‚¬ ìˆ˜ë™ ê°•ì œ ë§ˆê°)
  * DB `status = 'published'` AND `NOW() > due_at` â†’ ë§ˆê° (ìë™ ë§ˆê°)
  * ê·¸ ì™¸ â†’ ì§„í–‰ ì¤‘
* ë§ˆê° í›„ ì œì¶œ ë¶ˆê°€, ì±„ì ë§Œ ê°€ëŠ¥

**ì¶œë ¥**

* Assignment ìƒíƒœ ê°±ì‹ 
* Learner í™”ë©´ ë°˜ì˜

---

## 12. ìš´ì˜ (Operator)

**ì…ë ¥**

* ì‹ ê³  ì ‘ìˆ˜(ì½”ìŠ¤/ê³¼ì œ/ì œì¶œë¬¼/ì‚¬ìš©ì, ì‚¬ìœ , ë‚´ìš©)
* ë©”íƒ€ë°ì´í„° ê´€ë¦¬(ì¹´í…Œê³ ë¦¬, ë‚œì´ë„)

**ì²˜ë¦¬ (ì •ì±…)**

* ìš´ì˜ì ê¶Œí•œ ê°€ë“œ
* ì‹ ê³  ì²˜ë¦¬ ìƒíƒœ: received â†’ investigating â†’ resolved
* ì•¡ì…˜: ê²½ê³ , ì œì¶œë¬¼ ë¬´íš¨í™”, ê³„ì • ì œí•œ
* ë©”íƒ€ë°ì´í„° CRUD (ì‚¬ìš© ì¤‘ ê°’ì€ ë¹„í™œì„±í™” ì²˜ë¦¬ ê¶Œì¥)

**ì¶œë ¥**

* ì²˜ë¦¬ ê²°ê³¼ ì•Œë¦¼
* ë©”íƒ€ë°ì´í„° ê°±ì‹ 
</file>

</files>
