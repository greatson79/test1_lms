-- Migration: UC-002 테스트용 샘플 데이터 시드
-- categories, difficulties, 샘플 코스(기존 강사 계정 활용)

begin;

-- ============================================================
-- 1. 카테고리
-- ============================================================
insert into public.categories (id, name, is_active) values
  ('00000000-0000-0000-0000-000000000101', '프로그래밍',    true),
  ('00000000-0000-0000-0000-000000000102', '디자인',        true),
  ('00000000-0000-0000-0000-000000000103', '데이터 사이언스', true),
  ('00000000-0000-0000-0000-000000000104', '마케팅',        true),
  ('00000000-0000-0000-0000-000000000105', '비즈니스',      true)
on conflict (name) do nothing;

-- ============================================================
-- 2. 난이도
-- ============================================================
insert into public.difficulties (id, name, is_active) values
  ('00000000-0000-0000-0000-000000000201', '입문', true),
  ('00000000-0000-0000-0000-000000000202', '초급', true),
  ('00000000-0000-0000-0000-000000000203', '중급', true),
  ('00000000-0000-0000-0000-000000000204', '고급', true)
on conflict (name) do nothing;

-- ============================================================
-- 3. 샘플 코스 (기존 강사 계정의 id를 자동으로 사용)
--    profiles 테이블에서 role = 'instructor' 인 첫 번째 계정을 사용.
--    강사 계정이 없으면 코스 삽입을 건너뜀.
-- ============================================================
do $$
declare
  v_instructor_id uuid;
begin
  select id into v_instructor_id
  from public.profiles
  where role = 'instructor'
  order by created_at
  limit 1;

  if v_instructor_id is null then
    raise notice '강사 계정이 없어 샘플 코스를 삽입하지 않습니다. 먼저 강사로 회원가입을 완료해주세요.';
    return;
  end if;

  raise notice '강사 계정 발견: %', v_instructor_id;

  insert into public.courses (
    id, instructor_id, title, description,
    category_id, difficulty_id, curriculum, status
  ) values
    (
      '00000000-0000-0000-0001-000000000001',
      v_instructor_id,
      'Next.js 완전 정복',
      'React 기반의 풀스택 프레임워크 Next.js를 처음부터 배워봅니다. App Router, Server Components, API Routes까지 실전 프로젝트와 함께 학습합니다.',
      '00000000-0000-0000-0000-000000000101',
      '00000000-0000-0000-0000-000000000203',
      '1주차: Next.js 소개 및 환경 설정
2주차: App Router 심화
3주차: Server Components
4주차: 데이터 페칭 패턴
5주차: 인증 구현
6주차: 배포 및 최적화',
      'published'
    ),
    (
      '00000000-0000-0000-0001-000000000002',
      v_instructor_id,
      'TypeScript 실전 입문',
      '자바스크립트 개발자를 위한 TypeScript 핵심 가이드. 타입 시스템부터 제네릭, 유틸리티 타입까지 실무에서 바로 쓰는 내용을 다룹니다.',
      '00000000-0000-0000-0000-000000000101',
      '00000000-0000-0000-0000-000000000202',
      '1주차: TypeScript 기본 타입
2주차: 인터페이스와 타입 별칭
3주차: 제네릭
4주차: 유틸리티 타입
5주차: 실전 패턴',
      'published'
    ),
    (
      '00000000-0000-0000-0001-000000000003',
      v_instructor_id,
      'Figma로 배우는 UI/UX 디자인',
      '비개발자도 따라할 수 있는 Figma 실전 강의. 와이어프레임부터 프로토타입, 디자인 시스템 구축까지 커버합니다.',
      '00000000-0000-0000-0000-000000000102',
      '00000000-0000-0000-0000-000000000201',
      '1주차: Figma 기초
2주차: 컴포넌트 만들기
3주차: 오토 레이아웃
4주차: 프로토타이핑
5주차: 디자인 시스템 구축',
      'published'
    ),
    (
      '00000000-0000-0000-0001-000000000004',
      v_instructor_id,
      'Python 데이터 분석 A to Z',
      'pandas, numpy, matplotlib을 활용한 데이터 분석 실전 강의. 실제 데이터셋으로 분석 파이프라인을 구축합니다.',
      '00000000-0000-0000-0000-000000000103',
      '00000000-0000-0000-0000-000000000202',
      '1주차: Python 기초 복습
2주차: pandas 데이터 처리
3주차: numpy 수치 계산
4주차: matplotlib 시각화
5주차: 실전 프로젝트',
      'published'
    ),
    (
      '00000000-0000-0000-0001-000000000005',
      v_instructor_id,
      '그로스 마케팅 실전',
      '스타트업에서 검증된 그로스 해킹 전략과 데이터 기반 마케팅을 배웁니다. GA4, Meta Ads, A/B 테스트 실습 포함.',
      '00000000-0000-0000-0000-000000000104',
      '00000000-0000-0000-0000-000000000203',
      '1주차: 그로스 마케팅 개요
2주차: GA4 설정 및 분석
3주차: Meta Ads 캠페인
4주차: A/B 테스트
5주차: 퍼널 최적화',
      'published'
    ),
    (
      '00000000-0000-0000-0001-000000000006',
      v_instructor_id,
      'React Native 앱 개발',
      'React 지식을 활용해 iOS/Android 앱을 동시에 개발합니다. Expo 기반으로 빠르게 앱을 출시하는 방법을 배웁니다.',
      '00000000-0000-0000-0000-000000000101',
      '00000000-0000-0000-0000-000000000203',
      '1주차: React Native 소개
2주차: 네비게이션
3주차: 상태 관리
4주차: 네이티브 기능 활용
5주차: 앱 스토어 배포',
      'published'
    ),
    (
      '00000000-0000-0000-0001-000000000007',
      v_instructor_id,
      'SQL 기초부터 고급까지',
      '데이터베이스를 처음 배우는 분부터 복잡한 쿼리를 작성해야 하는 분까지. PostgreSQL 기준으로 실무 쿼리를 마스터합니다.',
      '00000000-0000-0000-0000-000000000103',
      '00000000-0000-0000-0000-000000000201',
      '1주차: SQL 기초 문법
2주차: JOIN 완전 이해
3주차: 서브쿼리
4주차: 인덱스와 성능
5주차: 실전 쿼리 패턴',
      'published'
    ),
    (
      '00000000-0000-0000-0001-000000000008',
      v_instructor_id,
      '스타트업 창업 MBA',
      '아이디어 검증부터 BM 설계, 투자 유치까지. 실제 창업자들의 경험을 바탕으로 한 실전 창업 커리큘럼.',
      '00000000-0000-0000-0000-000000000105',
      '00000000-0000-0000-0000-000000000202',
      '1주차: 아이디어 검증
2주차: 비즈니스 모델 설계
3주차: MVP 개발
4주차: 고객 인터뷰
5주차: 투자 유치 전략',
      'published'
    ),
    (
      '00000000-0000-0000-0001-000000000009',
      v_instructor_id,
      'Supabase 백엔드 완성 가이드',
      'PostgreSQL, Auth, Storage, Edge Functions까지 Supabase의 모든 기능을 실전 프로젝트로 마스터합니다.',
      '00000000-0000-0000-0000-000000000101',
      '00000000-0000-0000-0000-000000000204',
      '1주차: Supabase 시작하기
2주차: 데이터베이스 설계
3주차: Auth 연동
4주차: Storage 활용
5주차: Edge Functions
6주차: 실전 프로젝트',
      'published'
    ),
    (
      '00000000-0000-0000-0001-000000000010',
      v_instructor_id,
      '브랜드 디자인 입문',
      '로고, 컬러 시스템, 타이포그래피로 브랜드 아이덴티티를 구축하는 방법을 배웁니다. Illustrator 사용 경험 불필요.',
      '00000000-0000-0000-0000-000000000102',
      '00000000-0000-0000-0000-000000000201',
      '1주차: 브랜드 아이덴티티 이해
2주차: 로고 디자인 원칙
3주차: 컬러 시스템
4주차: 타이포그래피
5주차: 브랜드 가이드라인 제작',
      'published'
    )
  on conflict (id) do nothing;

  raise notice '샘플 코스 10개 삽입 완료';
end $$;

commit;
