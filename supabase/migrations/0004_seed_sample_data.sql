-- Migration: UC-002 테스트용 샘플 데이터 시드
-- ON CONFLICT DO NOTHING (target 생략) → 모든 unique 제약 위반 무시 (idempotent)
-- DO $$ 블록 없이 INSERT ... SELECT 로 강사 계정 자동 참조

-- ============================================================
-- 1. 카테고리
-- ============================================================
insert into public.categories (id, name, is_active) values
  ('00000000-0000-0000-0000-000000000101', '프로그래밍',     true),
  ('00000000-0000-0000-0000-000000000102', '디자인',         true),
  ('00000000-0000-0000-0000-000000000103', '데이터 사이언스', true),
  ('00000000-0000-0000-0000-000000000104', '마케팅',         true),
  ('00000000-0000-0000-0000-000000000105', '비즈니스',       true)
on conflict do nothing;

-- ============================================================
-- 2. 난이도
-- ============================================================
insert into public.difficulties (id, name, is_active) values
  ('00000000-0000-0000-0000-000000000201', '입문', true),
  ('00000000-0000-0000-0000-000000000202', '초급', true),
  ('00000000-0000-0000-0000-000000000203', '중급', true),
  ('00000000-0000-0000-0000-000000000204', '고급', true)
on conflict do nothing;

-- ============================================================
-- 3. 샘플 코스
--    profiles 에서 role='instructor' 첫 번째 계정을 CROSS JOIN 으로 참조.
--    강사가 없으면 INSERT 행이 0개 → 에러 없이 종료.
-- ============================================================
insert into public.courses (
  id, instructor_id, title, description,
  category_id, difficulty_id, curriculum, status
)
select
  v.id::uuid,
  p.id,
  v.title,
  v.description,
  v.category_id::uuid,
  v.difficulty_id::uuid,
  v.curriculum,
  'published'
from (
  values
    (
      '00000000-0000-0000-0001-000000000001',
      'Next.js 완전 정복',
      'React 기반의 풀스택 프레임워크 Next.js를 처음부터 배워봅니다. App Router, Server Components, API Routes까지 실전 프로젝트와 함께 학습합니다.',
      '00000000-0000-0000-0000-000000000101',
      '00000000-0000-0000-0000-000000000203',
      '1주차: Next.js 소개 및 환경 설정 / 2주차: App Router 심화 / 3주차: Server Components / 4주차: 데이터 페칭 패턴 / 5주차: 인증 구현 / 6주차: 배포 및 최적화'
    ),
    (
      '00000000-0000-0000-0001-000000000002',
      'TypeScript 실전 입문',
      '자바스크립트 개발자를 위한 TypeScript 핵심 가이드. 타입 시스템부터 제네릭, 유틸리티 타입까지 실무에서 바로 쓰는 내용을 다룹니다.',
      '00000000-0000-0000-0000-000000000101',
      '00000000-0000-0000-0000-000000000202',
      '1주차: 기본 타입 / 2주차: 인터페이스와 타입 별칭 / 3주차: 제네릭 / 4주차: 유틸리티 타입 / 5주차: 실전 패턴'
    ),
    (
      '00000000-0000-0000-0001-000000000003',
      'Figma로 배우는 UI/UX 디자인',
      '비개발자도 따라할 수 있는 Figma 실전 강의. 와이어프레임부터 프로토타입, 디자인 시스템 구축까지 커버합니다.',
      '00000000-0000-0000-0000-000000000102',
      '00000000-0000-0000-0000-000000000201',
      '1주차: Figma 기초 / 2주차: 컴포넌트 / 3주차: 오토 레이아웃 / 4주차: 프로토타이핑 / 5주차: 디자인 시스템 구축'
    ),
    (
      '00000000-0000-0000-0001-000000000004',
      'Python 데이터 분석 A to Z',
      'pandas, numpy, matplotlib을 활용한 데이터 분석 실전 강의. 실제 데이터셋으로 분석 파이프라인을 구축합니다.',
      '00000000-0000-0000-0000-000000000103',
      '00000000-0000-0000-0000-000000000202',
      '1주차: Python 기초 복습 / 2주차: pandas / 3주차: numpy / 4주차: matplotlib / 5주차: 실전 프로젝트'
    ),
    (
      '00000000-0000-0000-0001-000000000005',
      '그로스 마케팅 실전',
      '스타트업에서 검증된 그로스 해킹 전략과 데이터 기반 마케팅을 배웁니다. GA4, Meta Ads, A/B 테스트 실습 포함.',
      '00000000-0000-0000-0000-000000000104',
      '00000000-0000-0000-0000-000000000203',
      '1주차: 그로스 마케팅 개요 / 2주차: GA4 / 3주차: Meta Ads / 4주차: A/B 테스트 / 5주차: 퍼널 최적화'
    ),
    (
      '00000000-0000-0000-0001-000000000006',
      'React Native 앱 개발',
      'React 지식을 활용해 iOS/Android 앱을 동시에 개발합니다. Expo 기반으로 빠르게 앱을 출시하는 방법을 배웁니다.',
      '00000000-0000-0000-0000-000000000101',
      '00000000-0000-0000-0000-000000000203',
      '1주차: React Native 소개 / 2주차: 네비게이션 / 3주차: 상태 관리 / 4주차: 네이티브 기능 / 5주차: 배포'
    ),
    (
      '00000000-0000-0000-0001-000000000007',
      'SQL 기초부터 고급까지',
      '데이터베이스를 처음 배우는 분부터 복잡한 쿼리를 작성해야 하는 분까지. PostgreSQL 기준으로 실무 쿼리를 마스터합니다.',
      '00000000-0000-0000-0000-000000000103',
      '00000000-0000-0000-0000-000000000201',
      '1주차: SQL 기초 / 2주차: JOIN / 3주차: 서브쿼리 / 4주차: 인덱스와 성능 / 5주차: 실전 쿼리 패턴'
    ),
    (
      '00000000-0000-0000-0001-000000000008',
      '스타트업 창업 MBA',
      '아이디어 검증부터 BM 설계, 투자 유치까지. 실제 창업자들의 경험을 바탕으로 한 실전 창업 커리큘럼.',
      '00000000-0000-0000-0000-000000000105',
      '00000000-0000-0000-0000-000000000202',
      '1주차: 아이디어 검증 / 2주차: BM 설계 / 3주차: MVP / 4주차: 고객 인터뷰 / 5주차: 투자 유치'
    ),
    (
      '00000000-0000-0000-0001-000000000009',
      'Supabase 백엔드 완성 가이드',
      'PostgreSQL, Auth, Storage, Edge Functions까지 Supabase의 모든 기능을 실전 프로젝트로 마스터합니다.',
      '00000000-0000-0000-0000-000000000101',
      '00000000-0000-0000-0000-000000000204',
      '1주차: Supabase 시작하기 / 2주차: DB 설계 / 3주차: Auth 연동 / 4주차: Storage / 5주차: Edge Functions'
    ),
    (
      '00000000-0000-0000-0001-000000000010',
      '브랜드 디자인 입문',
      '로고, 컬러 시스템, 타이포그래피로 브랜드 아이덴티티를 구축하는 방법을 배웁니다.',
      '00000000-0000-0000-0000-000000000102',
      '00000000-0000-0000-0000-000000000201',
      '1주차: 브랜드 아이덴티티 / 2주차: 로고 디자인 / 3주차: 컬러 시스템 / 4주차: 타이포그래피 / 5주차: 가이드라인'
    )
) as v (id, title, description, category_id, difficulty_id, curriculum)
cross join (
  select id
  from public.profiles
  where role = 'instructor'
  order by created_at
  limit 1
) as p
on conflict do nothing;
